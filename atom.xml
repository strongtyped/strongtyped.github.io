<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Strong[Typed]]]></title>
  <link href="http://www.strongtyped.io/atom.xml" rel="self"/>
  <link href="http://www.strongtyped.io/"/>
  <updated>2014-10-24T15:30:40+02:00</updated>
  <id>http://www.strongtyped.io/</id>
  <author>
    <name><![CDATA[StrongTyped.io]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[2014 JavaOne University: Functional Programming in Scala]]></title>
    <link href="http://www.strongtyped.io/blog/2014/10/23/javaone-university-2014/"/>
    <updated>2014-10-23T09:00:00+02:00</updated>
    <id>http://www.strongtyped.io/blog/2014/10/23/javaone-university-2014</id>
    <content type="html"><![CDATA[<p>This blog post correponds to my 2014 JavaOne University course.</p>

<p>The content of this blog post (deliberately) does not really go into all details.</p>

<!-- more -->


<h2>Course content</h2>

<p>This course is about <em>functional programming patterns</em> in general,
and functional programming patterns <em>related to datasources</em> in particular.</p>

<h2>Course approach</h2>

<p>The course describes a <em>Scala library</em> that formalizes functional datasource patterns.</p>

<h2>Back to school</h2>

<p>One of the main goals of this course is to illustrate that datasources are closely related to concepts you learned in school.</p>

<h2>Multiplication</h2>

<p>Most probably, you remember the <em>multiplication</em> operator</p>

<ul>
<li><code>*</code> for integers</li>
<li><code>and</code> for booleans</li>
<li>&hellip;</li>
</ul>


<p>Most probably, you also remember that the multiplication operators above have a <em>neutral</em> element</p>

<ul>
<li><code>1</code> for integers</li>
<li><code>true</code> for booleans</li>
<li>&hellip;</li>
</ul>


<h2>Multiplicative data</h2>

<p>At this moment we do a big (not to say gigantic) step forwards by, somehow, <em>adding data</em> to the multiplication operator above. An important question to answer is: what should be the <em>data semantics</em> associated with multiplication?</p>

<p><em>Multiplicative data</em> are formalized by the <code>trait</code>&rsquo;s below</p>

<figure class='code'><figcaption><span>HasOne  (HasOne.scala)</span> <a href='http://www.strongtyped.io/downloads/code/HasOne.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">trait</span> <span class="nc">HasOneModule</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">RunnableModule</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">&lt;:</span> <span class="nc">HasOne</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">one</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="k">trait</span> <span class="nc">HasOne</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="nc">extends</span> <span class="nc">Runnable</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span> <span class="n">da</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=&gt;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Multiplicative  (Multiplicative.scala)</span> <a href='http://www.strongtyped.io/downloads/code/Multiplicative.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">trait</span> <span class="nc">MultiplicativeModule</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">HasOneModule</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">&lt;:</span> <span class="nc">Multiplicative</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="k">trait</span> <span class="nc">Multiplicative</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="nc">extends</span> <span class="nc">HasOne</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span> <span class="n">da</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="k">def</span> <span class="n">and</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">d_a2b</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">A</span> <span class="k">=&gt;</span> <span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span>
</span><span class='line'>      <span class="k">def</span> <span class="n">end</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">a2b</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>        <span class="n">da</span> <span class="n">and</span> <span class="n">one</span><span class="o">(</span><span class="n">a2b</span><span class="o">)</span>
</span><span class='line'>      <span class="k">def</span> <span class="o">**[</span><span class="kt">B</span><span class="o">](</span><span class="n">db</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span> <span class="kt">**</span> <span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>        <span class="n">da</span> <span class="n">and</span> <span class="o">(</span>
</span><span class='line'>          <span class="n">db</span> <span class="n">end</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">b</span> <span class="k">=&gt;</span>
</span><span class='line'>              <span class="n">a</span> <span class="k">=&gt;</span>
</span><span class='line'>                <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span>
</span><span class='line'>          <span class="o">})</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>where <em>Runnable</em> is formalized by the <code>trait</code> below</p>

<figure class='code'><figcaption><span>Runnable  (Runnable.scala)</span> <a href='http://www.strongtyped.io/downloads/code/Runnable.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">trait</span> <span class="nc">RunnableModule</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">&lt;:</span> <span class="nc">Runnable</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">In</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">Out</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="k">trait</span> <span class="nc">Runnable</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span> <span class="n">da</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="k">def</span> <span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="k">:</span> <span class="kt">In</span><span class="o">)</span><span class="k">:</span> <span class="kt">Out</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>and the <em>Product Type</em> <code>Z ** Y</code> is defined as</p>

<figure class='code'><figcaption><span>Product  (Product.scala)</span> <a href='http://www.strongtyped.io/downloads/code/Product.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">type</span> <span class="kt">**</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">Y</span><span class="o">]</span> <span class="k">=</span> <span class="o">(</span><span class="n">Z</span><span class="o">,</span> <span class="n">Y</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>trait HasOneModule</code></p>

<ul>
<li>declares the type <code>D[Z]</code> as a subtype of <code>Multiplicative[Z]</code></li>
<li>declares the function <code>one</code>

<ul>
<li>given a value <code>z</code> of type <code>Z</code>, <code>one(z)</code> should produce <code>z</code></li>
</ul>
</li>
</ul>


<p><code>trait Multiplicative[A]</code></p>

<ul>
<li>declares the method <code>and</code>

<ul>
<li>given <code>da</code>, somehow producing values of type <code>A</code>, and <code>d_a2b</code>, somehow producing values of type <code>A =&gt; B</code>, <code>da and d_a2b</code> should, somehow, using the values produced by <code>da</code> and <code>d_a2b</code>, produce values of type <code>B</code></li>
</ul>
</li>
<li>defines the method <code>end</code> in terms of <code>and</code> and <code>one</code></li>
<li>defines the method <code>**</code> in terms of <code>and</code> and <code>end</code></li>
</ul>


<p><em>Note:</em> This &ldquo;declares the type <code>D[Z]</code> as a subtype of <code>Something[Z]</code>&rdquo; is such a common theme that we are not going to repeat it over and over again.</p>

<h2>Domain Specific Language</h2>

<p>The functions and methods of <code>MultiplicativeModule</code> constitute a <em>DSL</em>.</p>

<p><em>Note:</em> This &ldquo;the functions and methods of <code>SomethingModule</code> constitute a <em>DSL</em>&rdquo; is such a common theme that we are not going to repeat it over and over again.</p>

<h2>Multiplicative data usage</h2>

<p>The code below defines some examples that make use of the multiplicative data DSL</p>

<figure class='code'><figcaption><span>MultiplicativeUsage  (MultiplicativeUsage.scala)</span> <a href='http://www.strongtyped.io/downloads/code/MultiplicativeUsage.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">trait</span> <span class="nc">MultiplicativeUsage</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">import</span> <span class="nn">Lib.MultiplicativeModule</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">mm</span><span class="k">:</span> <span class="kt">MultiplicativeModule</span>
</span><span class='line'>    <span class="k">import</span> <span class="nn">mm._</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">multiplicative01</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="n">i</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">di</span> <span class="k">=&gt;</span>
</span><span class='line'>          <span class="n">one</span><span class="o">(</span><span class="n">i</span><span class="o">)</span> <span class="o">**</span> <span class="n">di</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">multiplicative02</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="o">(</span><span class="n">i1</span><span class="o">,</span> <span class="n">i2</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">di</span> <span class="k">=&gt;</span>
</span><span class='line'>          <span class="n">one</span><span class="o">(</span><span class="n">i1</span><span class="o">)</span> <span class="o">**</span> <span class="n">one</span><span class="o">(</span><span class="n">i2</span><span class="o">)</span> <span class="o">**</span> <span class="n">di</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">multiplicative03</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="o">((</span><span class="n">i1</span><span class="o">,</span> <span class="n">i2</span><span class="o">),</span> <span class="n">i3</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">di</span> <span class="k">=&gt;</span>
</span><span class='line'>          <span class="n">one</span><span class="o">(</span><span class="n">i1</span><span class="o">)</span> <span class="o">**</span> <span class="n">one</span><span class="o">(</span><span class="n">i2</span><span class="o">)</span> <span class="o">**</span> <span class="n">one</span><span class="o">(</span><span class="n">i3</span><span class="o">)</span> <span class="o">**</span> <span class="n">di</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">multiplicative04</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span> <span class="kt">**</span> <span class="o">(</span><span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span><span class="o">)]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="o">(</span><span class="n">i1</span><span class="o">,</span> <span class="n">i2</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">di</span> <span class="k">=&gt;</span>
</span><span class='line'>          <span class="n">one</span><span class="o">(</span><span class="n">i1</span><span class="o">)</span> <span class="o">**</span> <span class="o">(</span><span class="n">one</span><span class="o">(</span><span class="n">i2</span><span class="o">)</span> <span class="o">**</span> <span class="n">di</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">multiplicative05</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="o">(</span><span class="n">i1</span><span class="o">,</span> <span class="n">i2</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">one</span><span class="o">(</span><span class="n">i1</span><span class="o">)</span> <span class="n">and</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">one</span><span class="o">(</span><span class="n">i2</span><span class="o">)</span> <span class="n">end</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">i2</span> <span class="k">=&gt;</span>
</span><span class='line'>              <span class="n">i1</span> <span class="k">=&gt;</span>
</span><span class='line'>                <span class="n">i1</span> <span class="o">+</span> <span class="n">i2</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">multiplicative06</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="o">((</span><span class="n">i1</span><span class="o">,</span> <span class="n">i2</span><span class="o">),</span> <span class="n">i3</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">one</span><span class="o">(</span><span class="n">i1</span><span class="o">)</span> <span class="n">and</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">one</span><span class="o">(</span><span class="n">i2</span><span class="o">)</span> <span class="n">and</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">one</span><span class="o">(</span><span class="n">i3</span><span class="o">)</span> <span class="n">end</span> <span class="o">{</span>
</span><span class='line'>              <span class="n">i3</span> <span class="k">=&gt;</span>
</span><span class='line'>                <span class="n">i2</span> <span class="k">=&gt;</span>
</span><span class='line'>                  <span class="n">i1</span> <span class="k">=&gt;</span>
</span><span class='line'>                    <span class="n">i1</span> <span class="o">+</span> <span class="n">i2</span> <span class="o">+</span> <span class="n">i3</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">multiplicative07</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="o">(((</span><span class="n">i1</span><span class="o">,</span> <span class="n">i2</span><span class="o">),</span> <span class="n">i3</span><span class="o">),</span> <span class="n">i4</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">one</span><span class="o">(</span><span class="n">i1</span><span class="o">)</span> <span class="n">and</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">one</span><span class="o">(</span><span class="n">i2</span><span class="o">)</span> <span class="n">and</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">one</span><span class="o">(</span><span class="n">i3</span><span class="o">)</span> <span class="n">and</span> <span class="o">{</span>
</span><span class='line'>              <span class="n">one</span><span class="o">(</span><span class="n">i4</span><span class="o">)</span> <span class="n">end</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">i4</span> <span class="k">=&gt;</span>
</span><span class='line'>                  <span class="n">i3</span> <span class="k">=&gt;</span>
</span><span class='line'>                    <span class="n">i2</span> <span class="k">=&gt;</span>
</span><span class='line'>                      <span class="n">i1</span> <span class="k">=&gt;</span>
</span><span class='line'>                        <span class="n">i1</span> <span class="o">+</span> <span class="n">i2</span> <span class="o">+</span> <span class="n">i3</span> <span class="o">+</span> <span class="n">i4</span>
</span><span class='line'>              <span class="o">}</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example01</span> <span class="k">=</span> <span class="n">multiplicative01</span><span class="o">(</span><span class="mi">1</span><span class="o">)(</span><span class="n">one</span><span class="o">(</span><span class="mi">2</span><span class="o">))</span>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example02</span> <span class="k">=</span> <span class="n">multiplicative02</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">))(</span><span class="n">one</span><span class="o">(</span><span class="mi">3</span><span class="o">))</span>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example03</span> <span class="k">=</span> <span class="n">multiplicative03</span><span class="o">(((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span> <span class="mi">3</span><span class="o">))(</span><span class="n">one</span><span class="o">(</span><span class="mi">4</span><span class="o">))</span>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example04</span> <span class="k">=</span> <span class="n">multiplicative04</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">))(</span><span class="n">one</span><span class="o">(</span><span class="mi">3</span><span class="o">))</span>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example05</span> <span class="k">=</span> <span class="n">multiplicative05</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">))</span>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example06</span> <span class="k">=</span> <span class="n">multiplicative06</span><span class="o">(((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span> <span class="mi">3</span><span class="o">))</span>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example07</span> <span class="k">=</span> <span class="n">multiplicative07</span><span class="o">((((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span> <span class="mi">3</span><span class="o">),</span> <span class="mi">4</span><span class="o">))</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">in</span><span class="k">:</span> <span class="kt">In</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="n">multiplicative_usage</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">example01</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">example02</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">example03</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">example04</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">example05</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">example06</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">example07</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Think about expressions like <code>one(i1) ** one(i2) ** di</code>
as generalizations of expressions like <code>a * b * x</code>
that also <em>produce accumulated data</em>.</p>

<p>Above we defined <em>abstract</em> examples that make use of the multiplicative data DSL
before defining any <em>concrete</em> multiplicative data <em>instance</em>.
Think of it as <em>programming to an interface</em>.</p>

<p>Below is a trivial <code>Runnable</code> implementation</p>

<figure class='code'><figcaption><span>TrivialRunnableModule  (TrivialRunnableModule.scala)</span> <a href='http://www.strongtyped.io/downloads/code/TrivialRunnableModule.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">trait</span> <span class="nc">TrivialRunnableModule</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">RunnableModule</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">&lt;:</span> <span class="nc">TrivialRunnable</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">In</span> <span class="o">=</span> <span class="nc">Unit</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">Out</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span> <span class="n">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="k">trait</span> <span class="nc">TrivialRunnable</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="nc">extends</span> <span class="nc">Runnable</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span> <span class="n">da</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="k">override</span> <span class="k">def</span> <span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="k">:</span> <span class="kt">In</span><span class="o">)</span><span class="k">:</span> <span class="kt">Out</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>        <span class="n">da</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The simplest <code>MultiplicativeModule</code> instance one can think of is one along the following lines</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">object</span> <span class="nc">OneModule</span> <span class="o">{</span>
</span><span class='line'>  <span class="c1">// ...</span>
</span><span class='line'>  <span class="k">case</span> <span class="k">class</span> <span class="nc">One</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">a</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="c1">// ...</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Think of <code>One[Z]</code> as a data source that produces <em>one value</em>.</p>

<p>Given a <code>One[Z]</code> instance it is possible to define</p>

<figure class='code'><figcaption><span>OneMultiplicativeUsage  (OneMultiplicativeUsage.scala)</span> <a href='http://www.strongtyped.io/downloads/code/OneMultiplicativeUsage.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">object</span> <span class="nc">OneMultiplicativeUsage</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">MultiplicativeUsage</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">import</span> <span class="nn">Instances.OneModule</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">val</span> <span class="n">mm</span><span class="k">:</span> <span class="kt">OneModule.</span><span class="k">type</span> <span class="o">=</span> <span class="nc">OneModule</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">val</span> <span class="n">in</span> <span class="k">=</span> <span class="o">()</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>and use it as follows</p>

<figure class='code'><figcaption><span>OneMultiplicativeUsageInApp  (OneMultiplicativeUsageInApp.scala)</span> <a href='http://www.strongtyped.io/downloads/code/OneMultiplicativeUsageInApp.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>    <span class="o">{</span>
</span><span class='line'>      <span class="k">import</span> <span class="nn">Usage.OneMultiplicativeUsage._</span>
</span><span class='line'>      <span class="n">multiplicative_usage</span><span class="o">()</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Running the examples above would then result in something along the following lines</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="o">{</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="o">((</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">),</span><span class="mi">3</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="o">(((</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">),</span><span class="mi">3</span><span class="o">),</span><span class="mi">4</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="o">(</span><span class="mi">1</span><span class="o">,(</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">))</span> <span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="mi">3</span> <span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="mi">6</span> <span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="mi">10</span> <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Addition</h2>

<p>Most probably, you remember the <em>addition</em> operator</p>

<ul>
<li><code>+</code> for integers</li>
<li><code>or</code> for booleans</li>
<li>&hellip;</li>
</ul>


<p>Most probably, you also remember that the addition operators above have a <em>neutral</em> element</p>

<ul>
<li><code>0</code> for integers</li>
<li><code>false</code> for booleans</li>
<li>&hellip;</li>
</ul>


<h2>Additive data</h2>

<p>Again, an important question to answer is: what should be the data semantics associated with addition be?</p>

<p><em>Additive data</em> are formalized by the <code>trait</code>&rsquo;s below</p>

<figure class='code'><figcaption><span>HasZero  (HasZero.scala)</span> <a href='http://www.strongtyped.io/downloads/code/HasZero.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">trait</span> <span class="nc">HasZeroModule</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">RunnableModule</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">&lt;:</span> <span class="nc">HasZero</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">zero</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="k">trait</span> <span class="nc">HasZero</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="nc">extends</span> <span class="nc">Runnable</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span> <span class="n">da</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=&gt;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Additive  (Additive.scala)</span> <a href='http://www.strongtyped.io/downloads/code/Additive.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">trait</span> <span class="nc">AdditiveModule</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">HasZeroModule</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">&lt;:</span> <span class="nc">Additive</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="k">trait</span> <span class="nc">Additive</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="nc">extends</span> <span class="nc">HasZero</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span> <span class="n">da</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="k">def</span> <span class="n">take</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="k">def</span> <span class="n">or</span><span class="o">(</span><span class="n">da1</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="k">def</span> <span class="o">++[</span><span class="kt">B</span><span class="o">](</span><span class="n">db</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span> <span class="kt">++</span> <span class="kt">B</span><span class="o">]</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>where the <em>Sum Type</em> <code>Z ++ Y</code> is defined as</p>

<figure class='code'><figcaption><span>Sum  (Sum.scala)</span> <a href='http://www.strongtyped.io/downloads/code/Sum.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">type</span> <span class="kt">++</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">Y</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Either</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">Y</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>trait HasZeroModule</code></p>

<ul>
<li>declares the function <code>zero</code>

<ul>
<li><code>zero(())</code> should produce no values</li>
</ul>
</li>
</ul>


<p><code>trait Additive[A]</code></p>

<ul>
<li>declares the method <code>or</code>

<ul>
<li>given <code>da</code>, somehow producing values of type <code>A</code>, and <code>da1</code>, somehow producing values of type <code>A</code>, <code>da or da1</code> should, somehow, produce the values produced by <code>da</code> or produce the values produced by <code>da1</code></li>
</ul>
</li>
<li>declares the method <code>++</code>, defined later in terms of (among others) <code>or</code></li>
</ul>


<p><em>Note:</em>
Do not think of <code>or</code> as an <em>exclusive</em> one, think of <code>or</code> as an <em>inclusive</em> one.</p>

<p><em>Note:</em>
<code>Additive[A]</code> also has a method <code>take</code></p>

<ul>
<li>when making use of <em>recursion</em>, <em>infinitely many values</em> can be produced</li>
</ul>


<h2>Polynomial data</h2>

<p><em>Polynomial data</em> are formalized by the <code>trait</code> below
as a combination of Multiplicative data and Additive data</p>

<figure class='code'><figcaption><span>Polynomial  (Polynomial.scala)</span> <a href='http://www.strongtyped.io/downloads/code/Polynomial.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">trait</span> <span class="nc">PolynomialModule</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">MultiplicativeModule</span>
</span><span class='line'>    <span class="k">with</span> <span class="nc">AdditiveModule</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">&lt;:</span> <span class="nc">Polynomial</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="k">trait</span> <span class="nc">Polynomial</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="nc">extends</span> <span class="nc">Multiplicative</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="k">with</span> <span class="nc">Additive</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span> <span class="n">da</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="k">override</span> <span class="k">def</span> <span class="o">++[</span><span class="kt">B</span><span class="o">](</span><span class="n">db</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span> <span class="kt">++</span> <span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">dl</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span> <span class="kt">++</span> <span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>          <span class="n">da</span> <span class="n">end</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">a</span> <span class="k">=&gt;</span>
</span><span class='line'>              <span class="nc">Left</span><span class="o">(</span><span class="n">a</span><span class="o">)</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">dr</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span> <span class="kt">++</span> <span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>          <span class="n">db</span> <span class="n">end</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">b</span> <span class="k">=&gt;</span>
</span><span class='line'>              <span class="nc">Right</span><span class="o">(</span><span class="n">b</span><span class="o">)</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>        <span class="n">dl</span> <span class="n">or</span> <span class="n">dr</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>trait Polynomial[A]</code></p>

<ul>
<li>defines the method <code>++</code> in terms of <code>end</code> and <code>or</code></li>
</ul>


<h2>Polynomial data usage</h2>

<p>The code below defines some examples that make use of the polynomial data DSL</p>

<figure class='code'><figcaption><span>PolynomialUsage  (PolynomialUsage.scala)</span> <a href='http://www.strongtyped.io/downloads/code/PolynomialUsage.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">trait</span> <span class="nc">PolynomialUsage</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">import</span> <span class="nn">Lib.PolynomialModule</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">pm</span><span class="k">:</span> <span class="kt">PolynomialModule</span>
</span><span class='line'>    <span class="k">import</span> <span class="nn">pm._</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">polynomial01a</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="o">(</span><span class="n">i1</span><span class="o">,</span> <span class="n">i2</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">di</span> <span class="k">=&gt;</span>
</span><span class='line'>          <span class="n">one</span><span class="o">(</span><span class="n">i1</span><span class="o">)</span> <span class="o">**</span> <span class="n">one</span><span class="o">(</span><span class="n">i2</span><span class="o">)</span> <span class="n">or</span> <span class="o">(</span><span class="n">one</span><span class="o">(</span><span class="n">i1</span><span class="o">)</span> <span class="n">or</span> <span class="n">one</span><span class="o">(</span><span class="n">i2</span><span class="o">))</span> <span class="o">**</span> <span class="n">di</span> <span class="n">or</span> <span class="n">di</span> <span class="o">**</span> <span class="n">di</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">polynomial01b</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="o">(</span><span class="n">i1</span><span class="o">,</span> <span class="n">i2</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">di</span> <span class="k">=&gt;</span>
</span><span class='line'>          <span class="n">di</span> <span class="o">**</span> <span class="n">di</span> <span class="n">or</span> <span class="n">di</span> <span class="o">**</span> <span class="o">(</span><span class="n">one</span><span class="o">(</span><span class="n">i1</span><span class="o">)</span> <span class="n">or</span> <span class="n">one</span><span class="o">(</span><span class="n">i2</span><span class="o">))</span> <span class="n">or</span> <span class="n">one</span><span class="o">(</span><span class="n">i1</span><span class="o">)</span> <span class="o">**</span> <span class="n">one</span><span class="o">(</span><span class="n">i2</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">polynomial03a</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="o">(</span><span class="n">i1</span><span class="o">,</span> <span class="n">i2</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">di</span> <span class="k">=&gt;</span>
</span><span class='line'>          <span class="o">(</span><span class="n">one</span><span class="o">(</span><span class="n">i1</span><span class="o">)</span> <span class="n">or</span> <span class="n">di</span><span class="o">)</span> <span class="o">**</span> <span class="o">(</span><span class="n">one</span><span class="o">(</span><span class="n">i2</span><span class="o">)</span> <span class="n">or</span> <span class="n">di</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">polynomial03b</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="o">(</span><span class="n">i1</span><span class="o">,</span> <span class="n">i2</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">di</span> <span class="k">=&gt;</span>
</span><span class='line'>          <span class="o">(</span><span class="n">di</span> <span class="n">or</span> <span class="n">one</span><span class="o">(</span><span class="n">i1</span><span class="o">))</span> <span class="o">**</span> <span class="o">(</span><span class="n">di</span> <span class="n">or</span> <span class="n">one</span><span class="o">(</span><span class="n">i2</span><span class="o">))</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">polynomial02a</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="kt">++</span> <span class="o">((</span><span class="kt">Int</span> <span class="kt">++</span> <span class="kt">Int</span><span class="o">)</span> <span class="kt">**</span> <span class="kt">Int</span><span class="o">)</span> <span class="kt">++</span> <span class="o">(</span><span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span><span class="o">)]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="o">(</span><span class="n">i1</span><span class="o">,</span> <span class="n">i2</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">di</span> <span class="k">=&gt;</span>
</span><span class='line'>          <span class="o">(</span><span class="n">one</span><span class="o">(</span><span class="n">i1</span><span class="o">)</span> <span class="o">**</span> <span class="n">one</span><span class="o">(</span><span class="n">i2</span><span class="o">))</span> <span class="o">++</span> <span class="o">(</span><span class="n">one</span><span class="o">(</span><span class="n">i1</span><span class="o">)</span> <span class="o">++</span> <span class="n">one</span><span class="o">(</span><span class="n">i2</span><span class="o">))</span> <span class="o">**</span> <span class="n">di</span> <span class="o">++</span> <span class="n">di</span> <span class="o">**</span> <span class="n">di</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">polynomial02b</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="kt">++</span> <span class="o">(</span><span class="kt">Int</span> <span class="kt">**</span> <span class="o">(</span><span class="kt">Int</span> <span class="kt">++</span> <span class="kt">Int</span><span class="o">))</span> <span class="kt">++</span> <span class="o">(</span><span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span><span class="o">)]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="o">(</span><span class="n">i1</span><span class="o">,</span> <span class="n">i2</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">di</span> <span class="k">=&gt;</span>
</span><span class='line'>          <span class="n">di</span> <span class="o">**</span> <span class="n">di</span> <span class="o">++</span> <span class="n">di</span> <span class="o">**</span> <span class="o">(</span><span class="n">one</span><span class="o">(</span><span class="n">i1</span><span class="o">)</span> <span class="o">++</span> <span class="n">one</span><span class="o">(</span><span class="n">i2</span><span class="o">))</span> <span class="o">++</span> <span class="o">(</span><span class="n">one</span><span class="o">(</span><span class="n">i1</span><span class="o">)</span> <span class="o">**</span> <span class="n">one</span><span class="o">(</span><span class="n">i2</span><span class="o">))</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">polynomial04a</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="n">D</span><span class="o">[(</span><span class="kt">Int</span> <span class="kt">++</span> <span class="kt">Int</span><span class="o">)</span> <span class="kt">**</span> <span class="o">(</span><span class="kt">Int</span> <span class="kt">++</span> <span class="kt">Int</span><span class="o">)]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="o">(</span><span class="n">i1</span><span class="o">,</span> <span class="n">i2</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">di</span> <span class="k">=&gt;</span>
</span><span class='line'>          <span class="o">(</span><span class="n">one</span><span class="o">(</span><span class="n">i1</span><span class="o">)</span> <span class="o">++</span> <span class="n">di</span><span class="o">)</span> <span class="o">**</span> <span class="o">(</span><span class="n">one</span><span class="o">(</span><span class="n">i2</span><span class="o">)</span> <span class="o">++</span> <span class="n">di</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">polynomial04b</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="n">D</span><span class="o">[(</span><span class="kt">Int</span> <span class="kt">++</span> <span class="kt">Int</span><span class="o">)</span> <span class="kt">**</span> <span class="o">(</span><span class="kt">Int</span> <span class="kt">++</span> <span class="kt">Int</span><span class="o">)]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="o">(</span><span class="n">i1</span><span class="o">,</span> <span class="n">i2</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">di</span> <span class="k">=&gt;</span>
</span><span class='line'>          <span class="o">(</span><span class="n">di</span> <span class="o">++</span> <span class="n">one</span><span class="o">(</span><span class="n">i1</span><span class="o">))</span> <span class="o">**</span> <span class="o">(</span><span class="n">di</span> <span class="o">++</span> <span class="n">one</span><span class="o">(</span><span class="n">i2</span><span class="o">))</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example01</span> <span class="k">=</span> <span class="n">polynomial01a</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">))(</span><span class="n">zero</span><span class="o">(()))</span>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example02</span> <span class="k">=</span> <span class="n">polynomial01a</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">))(</span><span class="n">one</span><span class="o">(</span><span class="mi">3</span><span class="o">))</span>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example03</span> <span class="k">=</span> <span class="n">polynomial01b</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">))(</span><span class="n">zero</span><span class="o">(()))</span>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example04</span> <span class="k">=</span> <span class="n">polynomial01b</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">))(</span><span class="n">one</span><span class="o">(</span><span class="mi">3</span><span class="o">))</span>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example05</span> <span class="k">=</span> <span class="n">polynomial03a</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">))(</span><span class="n">zero</span><span class="o">(()))</span>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example06</span> <span class="k">=</span> <span class="n">polynomial03a</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">))(</span><span class="n">one</span><span class="o">(</span><span class="mi">3</span><span class="o">))</span>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example07</span> <span class="k">=</span> <span class="n">polynomial03b</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">))(</span><span class="n">zero</span><span class="o">(()))</span>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example08</span> <span class="k">=</span> <span class="n">polynomial03b</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">))(</span><span class="n">one</span><span class="o">(</span><span class="mi">3</span><span class="o">))</span>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example09</span> <span class="k">=</span> <span class="n">polynomial02a</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">))(</span><span class="n">zero</span><span class="o">(()))</span>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example10</span> <span class="k">=</span> <span class="n">polynomial02a</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">))(</span><span class="n">one</span><span class="o">(</span><span class="mi">3</span><span class="o">))</span>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example11</span> <span class="k">=</span> <span class="n">polynomial02b</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">))(</span><span class="n">zero</span><span class="o">(()))</span>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example12</span> <span class="k">=</span> <span class="n">polynomial02b</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">))(</span><span class="n">one</span><span class="o">(</span><span class="mi">3</span><span class="o">))</span>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example13</span> <span class="k">=</span> <span class="n">polynomial04a</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">))(</span><span class="n">zero</span><span class="o">(()))</span>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example14</span> <span class="k">=</span> <span class="n">polynomial04a</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">))(</span><span class="n">one</span><span class="o">(</span><span class="mi">3</span><span class="o">))</span>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example15</span> <span class="k">=</span> <span class="n">polynomial04b</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">))(</span><span class="n">zero</span><span class="o">(()))</span>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example16</span> <span class="k">=</span> <span class="n">polynomial04b</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">))(</span><span class="n">one</span><span class="o">(</span><span class="mi">3</span><span class="o">))</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">in</span><span class="k">:</span> <span class="kt">In</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="n">polynomial_usage</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">example01</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">example02</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">example03</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">example04</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">example05</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">example06</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">example07</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">example08</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">example09</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">example10</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">example11</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">example12</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">example13</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">example14</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">example15</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">example16</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">nats</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="n">i</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">one</span><span class="o">(</span><span class="n">i</span><span class="o">)</span> <span class="n">or</span> <span class="n">nats</span><span class="o">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">fibs</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="o">(</span><span class="n">i1</span><span class="o">,</span> <span class="n">i2</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">one</span><span class="o">(</span><span class="n">i1</span><span class="o">)</span> <span class="n">or</span> <span class="n">fibs</span><span class="o">((</span><span class="n">i2</span><span class="o">,</span> <span class="o">(</span><span class="n">i1</span> <span class="o">+</span> <span class="n">i2</span><span class="o">)))</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="n">recursion_and_take_usage</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">lazy</span> <span class="k">val</span> <span class="n">firstTenNats</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="n">nats</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="n">take</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
</span><span class='line'>      <span class="k">lazy</span> <span class="k">val</span> <span class="n">firstNineFibs</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="n">fibs</span><span class="o">((</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">)).</span><span class="n">take</span><span class="o">(</span><span class="mi">9</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">firstTenNats</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">firstNineFibs</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Again, think about expressions like <code>one(i1) ** one(i2) ++ (one(i1) ++ one(i2)) ** di ++ di ** di</code>, resp. <code>(one(i1) ++ di) ** (one(i2) ++ di)</code>
as generalizations of expressions like <code>a * b + (a + b) * x + x * x</code> resp. <code>(a + x) * (b + x)</code>
that also <em>produce accumulated data</em>.</p>

<p>The simplest <code>PolynomialModule</code> instance one can think of is one along the following lines</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">object</span> <span class="nc">ZeroOrOneModule</span> <span class="o">{</span>
</span><span class='line'>  <span class="c1">// ...</span>
</span><span class='line'>  <span class="k">sealed</span> <span class="k">trait</span> <span class="nc">ZeroOrOne</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span>
</span><span class='line'>  <span class="c1">// ...</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  <span class="k">private</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Zero</span><span class="o">[</span><span class="kt">A</span><span class="o">]()</span> <span class="k">extends</span> <span class="nc">ZeroOrOne</span><span class="o">[</span><span class="kt">A</span><span class="o">]()</span>
</span><span class='line'>  <span class="k">private</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">One</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">a</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">ZeroOrOne</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Think of <code>ZeroOrOne[Z]</code> as a data source that produces <em>zero or one values</em>.</p>

<p>Given a <code>ZeroOrOne[Z]</code> instance it is possible to define</p>

<figure class='code'><figcaption><span>ZeroOrOnePolynomialUsage  (ZeroOrOnePolynomialUsage.scala)</span> <a href='http://www.strongtyped.io/downloads/code/ZeroOrOnePolynomialUsage.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">object</span> <span class="nc">ZeroOrOnePolynomialUsage</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">PolynomialUsage</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">import</span> <span class="nn">Instances.ZeroOrOneModule</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">val</span> <span class="n">pm</span><span class="k">:</span> <span class="kt">ZeroOrOneModule.</span><span class="k">type</span> <span class="o">=</span> <span class="nc">ZeroOrOneModule</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">val</span> <span class="n">in</span> <span class="k">=</span> <span class="o">()</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>and use it as follows</p>

<figure class='code'><figcaption><span>ZeroOrOnePolynomialUsageInApp  (ZeroOrOnePolynomialUsageInApp.scala)</span> <a href='http://www.strongtyped.io/downloads/code/ZeroOrOnePolynomialUsageInApp.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>    <span class="o">{</span>
</span><span class='line'>      <span class="k">import</span> <span class="nn">Usage.ZeroOrOnePolynomialUsage._</span>
</span><span class='line'>      <span class="n">polynomial_usage</span><span class="o">()</span>
</span><span class='line'>      <span class="n">recursion_and_take_usage</span><span class="o">()</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Running the examples above would then result in something along the following lines</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="o">{</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span><span class="mi">3</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span><span class="mi">3</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="nc">Left</span><span class="o">(</span><span class="nc">Left</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">)))</span> <span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="nc">Left</span><span class="o">(</span><span class="nc">Left</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">)))</span> <span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="nc">Right</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">))</span> <span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="nc">Left</span><span class="o">(</span><span class="nc">Left</span><span class="o">((</span><span class="mi">3</span><span class="o">,</span><span class="mi">3</span><span class="o">)))</span> <span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="o">(</span><span class="nc">Left</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span><span class="nc">Left</span><span class="o">(</span><span class="mi">2</span><span class="o">))</span> <span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="o">(</span><span class="nc">Left</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span><span class="nc">Left</span><span class="o">(</span><span class="mi">2</span><span class="o">))</span> <span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="o">(</span><span class="nc">Right</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span><span class="nc">Right</span><span class="o">(</span><span class="mi">2</span><span class="o">))</span> <span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="o">(</span><span class="nc">Left</span><span class="o">(</span><span class="mi">3</span><span class="o">),</span><span class="nc">Left</span><span class="o">(</span><span class="mi">3</span><span class="o">))</span> <span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="mi">0</span> <span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="mi">0</span> <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>A more complex <code>PolynomialModule</code> instance is one along the following lines</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">object</span> <span class="nc">ZeroOrMoreModule</span> <span class="o">{</span>
</span><span class='line'>  <span class="c1">// ...</span>
</span><span class='line'>  <span class="k">sealed</span> <span class="k">trait</span> <span class="nc">ZeroOrMore</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span>
</span><span class='line'>  <span class="c1">// ...</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  <span class="k">private</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Zero</span><span class="o">[</span><span class="kt">A</span><span class="o">]()</span> <span class="k">extends</span> <span class="nc">ZeroOrMore</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>  <span class="k">private</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">More</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">a_n_u2da</span><span class="k">:</span> <span class="kt">A</span> <span class="kt">**</span> <span class="o">(</span><span class="kt">Unit</span> <span class="o">=&gt;</span> <span class="kt">ZeroOrMore</span><span class="o">[</span><span class="kt">A</span><span class="o">]))</span> <span class="k">extends</span> <span class="nc">ZeroOrMore</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Think of <code>ZeroOrMore[Z]</code> as a data source that produces <em>zero or more values</em>.</p>

<p>Given a <code>ZeroOrMore[Z]</code> instance it is possible to define</p>

<figure class='code'><figcaption><span>ZeroOrMorePolynomialUsage  (ZeroOrMorePolynomialUsage.scala)</span> <a href='http://www.strongtyped.io/downloads/code/ZeroOrMorePolynomialUsage.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">object</span> <span class="nc">ZeroOrMorePolynomialUsage</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">PolynomialUsage</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">import</span> <span class="nn">Instances.ZeroOrMoreModule</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">val</span> <span class="n">pm</span><span class="k">:</span> <span class="kt">ZeroOrMoreModule.</span><span class="k">type</span> <span class="o">=</span> <span class="nc">ZeroOrMoreModule</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">val</span> <span class="n">in</span> <span class="k">=</span> <span class="o">()</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>and use it as follows</p>

<figure class='code'><figcaption><span>ZeroOrMorePolynomialUsageInApp  (ZeroOrMorePolynomialUsageInApp.scala)</span> <a href='http://www.strongtyped.io/downloads/code/ZeroOrMorePolynomialUsageInApp.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>    <span class="o">{</span>
</span><span class='line'>      <span class="k">import</span> <span class="nn">Usage.ZeroOrMorePolynomialUsage._</span>
</span><span class='line'>      <span class="n">polynomial_usage</span><span class="o">()</span>
</span><span class='line'>      <span class="n">recursion_and_take_usage</span><span class="o">()</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Running the examples above would then result in something along the following lines</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="o">[</span> <span class="o">(</span><span class="err">1</span>,<span class="err">2</span><span class="o">)</span> <span class="o">]</span>
</span><span class='line'><span class="o">[</span> <span class="o">(</span><span class="err">1</span>,<span class="err">2</span><span class="o">)</span> <span class="o">(</span><span class="err">1</span>,<span class="err">3</span><span class="o">)</span> <span class="o">(</span><span class="err">2</span>,<span class="err">3</span><span class="o">)</span> <span class="o">(</span><span class="err">3</span>,<span class="err">3</span><span class="o">)</span> <span class="o">]</span>
</span><span class='line'><span class="o">[</span> <span class="o">(</span><span class="err">1</span>,<span class="err">2</span><span class="o">)</span> <span class="o">]</span>
</span><span class='line'><span class="o">[</span> <span class="o">(</span><span class="err">3</span>,<span class="err">3</span><span class="o">)</span> <span class="o">(</span><span class="err">3</span>,<span class="err">1</span><span class="o">)</span> <span class="o">(</span><span class="err">3</span>,<span class="err">2</span><span class="o">)</span> <span class="o">(</span><span class="err">1</span>,<span class="err">2</span><span class="o">)</span> <span class="o">]</span>
</span><span class='line'><span class="o">[</span> <span class="o">(</span><span class="err">1</span>,<span class="err">2</span><span class="o">)</span> <span class="o">]</span>
</span><span class='line'><span class="o">[</span> <span class="o">(</span><span class="err">1</span>,<span class="err">2</span><span class="o">)</span> <span class="o">(</span><span class="err">1</span>,<span class="err">3</span><span class="o">)</span> <span class="o">(</span><span class="err">3</span>,<span class="err">2</span><span class="o">)</span> <span class="o">(</span><span class="err">3</span>,<span class="err">3</span><span class="o">)</span> <span class="o">]</span>
</span><span class='line'><span class="o">[</span> <span class="o">(</span><span class="err">1</span>,<span class="err">2</span><span class="o">)</span> <span class="o">]</span>
</span><span class='line'><span class="o">[</span> <span class="o">(</span><span class="err">3</span>,<span class="err">3</span><span class="o">)</span> <span class="o">(</span><span class="err">3</span>,<span class="err">2</span><span class="o">)</span> <span class="o">(</span><span class="err">1</span>,<span class="err">3</span><span class="o">)</span> <span class="o">(</span><span class="err">1</span>,<span class="err">2</span><span class="o">)</span> <span class="o">]</span>
</span><span class='line'><span class="o">[</span> <span class="kt">Left</span><span class="o">(</span><span class="kt">Left</span><span class="o">((</span><span class="err">1</span>,<span class="err">2</span><span class="o">)))</span> <span class="o">]</span>
</span><span class='line'><span class="o">[</span> <span class="kt">Left</span><span class="o">(</span><span class="kt">Left</span><span class="o">((</span><span class="err">1</span>,<span class="err">2</span><span class="o">)))</span> <span class="kt">Left</span><span class="o">(</span><span class="kt">Right</span><span class="o">((</span><span class="kt">Left</span><span class="o">(</span><span class="err">1</span><span class="o">)</span>,<span class="err">3</span><span class="o">)))</span> <span class="kt">Left</span><span class="o">(</span><span class="kt">Right</span><span class="o">((</span><span class="kt">Right</span><span class="o">(</span><span class="err">2</span><span class="o">)</span>,<span class="err">3</span><span class="o">)))</span> <span class="kt">Right</span><span class="o">((</span><span class="err">3</span>,<span class="err">3</span><span class="o">))</span> <span class="o">]</span>
</span><span class='line'><span class="o">[</span> <span class="kt">Right</span><span class="o">((</span><span class="err">1</span>,<span class="err">2</span><span class="o">))</span> <span class="o">]</span>
</span><span class='line'><span class="o">[</span> <span class="kt">Left</span><span class="o">(</span><span class="kt">Left</span><span class="o">((</span><span class="err">3</span>,<span class="err">3</span><span class="o">)))</span> <span class="kt">Left</span><span class="o">(</span><span class="kt">Right</span><span class="o">((</span><span class="err">3</span>,<span class="kt">Left</span><span class="o">(</span><span class="err">1</span><span class="o">))))</span> <span class="kt">Left</span><span class="o">(</span><span class="kt">Right</span><span class="o">((</span><span class="err">3</span>,<span class="kt">Right</span><span class="o">(</span><span class="err">2</span><span class="o">))))</span> <span class="kt">Right</span><span class="o">((</span><span class="err">1</span>,<span class="err">2</span><span class="o">))</span> <span class="o">]</span>
</span><span class='line'><span class="o">[</span> <span class="o">(</span><span class="kt">Left</span><span class="o">(</span><span class="err">1</span><span class="o">)</span>,<span class="kt">Left</span><span class="o">(</span><span class="err">2</span><span class="o">))</span> <span class="o">]</span>
</span><span class='line'><span class="o">[</span> <span class="o">(</span><span class="kt">Left</span><span class="o">(</span><span class="err">1</span><span class="o">)</span>,<span class="kt">Left</span><span class="o">(</span><span class="err">2</span><span class="o">))</span> <span class="o">(</span><span class="kt">Left</span><span class="o">(</span><span class="err">1</span><span class="o">)</span>,<span class="kt">Right</span><span class="o">(</span><span class="err">3</span><span class="o">))</span> <span class="o">(</span><span class="kt">Right</span><span class="o">(</span><span class="err">3</span><span class="o">)</span>,<span class="kt">Left</span><span class="o">(</span><span class="err">2</span><span class="o">))</span> <span class="o">(</span><span class="kt">Right</span><span class="o">(</span><span class="err">3</span><span class="o">)</span>,<span class="kt">Right</span><span class="o">(</span><span class="err">3</span><span class="o">))</span> <span class="o">]</span>
</span><span class='line'><span class="o">[</span> <span class="o">(</span><span class="kt">Right</span><span class="o">(</span><span class="err">1</span><span class="o">)</span>,<span class="kt">Right</span><span class="o">(</span><span class="err">2</span><span class="o">))</span> <span class="o">]</span>
</span><span class='line'><span class="o">[</span> <span class="o">(</span><span class="kt">Left</span><span class="o">(</span><span class="err">3</span><span class="o">)</span>,<span class="kt">Left</span><span class="o">(</span><span class="err">3</span><span class="o">))</span> <span class="o">(</span><span class="kt">Left</span><span class="o">(</span><span class="err">3</span><span class="o">)</span>,<span class="kt">Right</span><span class="o">(</span><span class="err">2</span><span class="o">))</span> <span class="o">(</span><span class="kt">Right</span><span class="o">(</span><span class="err">1</span><span class="o">)</span>,<span class="kt">Left</span><span class="o">(</span><span class="err">3</span><span class="o">))</span> <span class="o">(</span><span class="kt">Right</span><span class="o">(</span><span class="err">1</span><span class="o">)</span>,<span class="kt">Right</span><span class="o">(</span><span class="err">2</span><span class="o">))</span> <span class="o">]</span>
</span><span class='line'><span class="o">[</span> <span class="err">0</span> <span class="err">1</span> <span class="err">2</span> <span class="err">3</span> <span class="err">4</span> <span class="err">5</span> <span class="err">6</span> <span class="err">7</span> <span class="err">8</span> <span class="err">9</span> <span class="o">]</span>
</span><span class='line'><span class="o">[</span> <span class="err">0</span> <span class="err">1</span> <span class="err">1</span> <span class="err">2</span> <span class="err">3</span> <span class="err">5</span> <span class="err">8</span> <span class="err">13</span> <span class="err">21</span> <span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Datasource</h2>

<p>You are, most probably, used to think of</p>

<ul>
<li><em>functions</em> in terms of <em>applying</em> them to <em>values</em> as in <code>a2b(a)</code> or, equivalently, <code>a2b apply a</code></li>
</ul>


<p>You can also think of</p>

<ul>
<li><em>values</em> in terms of <em>binding</em> them to <em>functions</em> as in <code>a bind a2b</code></li>
</ul>


<p>The method <code>bind</code> below, defined in terms of <code>apply</code>, formalizes binding</p>

<figure class='code'><figcaption><span>Bind  (Bind.scala)</span> <a href='http://www.strongtyped.io/downloads/code/Bind.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">implicit</span> <span class="k">class</span> <span class="nc">Bind</span><span class="o">[</span><span class="kt">Z</span><span class="o">](</span><span class="n">z</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">bind</span><span class="o">[</span><span class="kt">Y</span><span class="o">](</span><span class="n">z2y</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=&gt;</span> <span class="n">Y</span><span class="o">)</span><span class="k">:</span> <span class="kt">Y</span> <span class="o">=</span>
</span><span class='line'>      <span class="n">z2y</span> <span class="n">apply</span> <span class="n">z</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><em>Data sources</em>, formalized by the <code>trait</code> below, generalize binding</p>

<figure class='code'><figcaption><span>Source  (Source.scala)</span> <a href='http://www.strongtyped.io/downloads/code/Source.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">trait</span> <span class="nc">SourceModule</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">MultiplicativeModule</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">&lt;:</span> <span class="nc">Source</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">join</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]]</span> <span class="k">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>      <span class="n">d_dz</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">d_dz</span> <span class="n">bnd</span> <span class="n">identity</span>
</span><span class='line'>    <span class="k">trait</span> <span class="nc">Source</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="nc">extends</span> <span class="nc">Multiplicative</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span> <span class="n">da</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="k">def</span> <span class="n">bnd</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">a2db</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span>
</span><span class='line'>      <span class="k">override</span> <span class="k">def</span> <span class="n">and</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">d_a2b</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">A</span> <span class="k">=&gt;</span> <span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>        <span class="n">da</span> <span class="n">bnd</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">a</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="n">d_a2b</span> <span class="n">bnd</span> <span class="o">{</span>
</span><span class='line'>              <span class="n">a2b</span> <span class="k">=&gt;</span>
</span><span class='line'>                <span class="n">a</span> <span class="n">bind</span> <span class="n">a2b</span> <span class="n">bind</span> <span class="n">one</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>      <span class="k">def</span> <span class="n">switch</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">p_a</span><span class="k">:</span> <span class="kt">Predicate</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">t_a2db</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">B</span><span class="o">])(</span><span class="n">f_a2db</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>        <span class="n">da</span> <span class="n">bnd</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">a</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="o">(</span><span class="n">a</span> <span class="n">bind</span> <span class="n">p_a</span><span class="o">)</span> <span class="k">match</span> <span class="o">{</span>
</span><span class='line'>              <span class="k">case</span> <span class="kc">true</span> <span class="k">=&gt;</span>
</span><span class='line'>                <span class="n">a</span> <span class="n">bind</span> <span class="n">t_a2db</span>
</span><span class='line'>              <span class="k">case</span> <span class="kc">false</span> <span class="k">=&gt;</span>
</span><span class='line'>                <span class="n">a</span> <span class="n">bind</span> <span class="n">f_a2db</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>where the <em>Predicate Type</em> <code>Predicate[Z]</code> is defined as</p>

<figure class='code'><figcaption><span>Predicate  (Predicate.scala)</span> <a href='http://www.strongtyped.io/downloads/code/Predicate.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">type</span> <span class="kt">Predicate</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="n">A</span> <span class="k">=&gt;</span> <span class="nc">Boolean</span>
</span></code></pre></td></tr></table></div></figure>


<p><em>Note:</em> We made use of <code>bind</code> just to show that it is as simple to use as <code>apply</code>.</p>

<p><code>trait SourceModule</code></p>

<ul>
<li>defines the function <code>join</code> in terms of <code>bnd</code></li>
</ul>


<p><code>trait Source[A]</code></p>

<ul>
<li>declares the method <code>bnd</code>

<ul>
<li>given <code>da</code>, somehow producing values of type <code>A</code>, and <code>a2db</code> of type <code>A =&gt; D[B]</code>, <code>da bnd a2db</code> should, somehow, using <code>a2b</code> and the values produced by <code>da</code>, produce values of type <code>B</code></li>
</ul>
</li>
<li>defines the method <code>and</code> in terms of <code>bnd</code> and <code>one</code></li>
<li>defines the method <code>switch</code> in terms of <code>bnd</code></li>
</ul>


<p>The definitions of <code>join</code> and <code>and</code> are the most natural ones you can possibly come up with to get the types right.</p>

<h2>About abstraction, power of expression and implementation flexibility</h2>

<p><em>abstraction</em></p>

<p><code>and</code> is more abstract than <code>bnd</code></p>

<ul>
<li><code>and</code> is defined interms of <code>bnd</code></li>
</ul>


<p><em>power of expression</em></p>

<p><code>bnd</code>, being less abstract, has more power of expression than <code>and</code></p>

<ul>
<li>When making use of <code>bnd</code>, values are immediately in scope from the outermost scope all the way down to the innermost scope.</li>
<li>When making use of <code>and</code>, values are only in scope at the innermost scope.</li>
</ul>


<p>The method <code>switch</code> illustrates this power of expression: <code>a</code> can be used to decide how to proceed.</p>

<p><em>implementation flexibility</em></p>

<p><code>and</code>, being more abstract, has more implementation flexibility than <code>bnd</code></p>

<ul>
<li>The definition of <code>and</code> is a <em>default</em> definition that can be overridden for specific implementations.</li>
</ul>


<h2>Datasource usage</h2>

<p>The code below defines some examples that make use of the datasource DSL</p>

<figure class='code'><figcaption><span>SourceUsage  (SourceUsage.scala)</span> <a href='http://www.strongtyped.io/downloads/code/SourceUsage.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">trait</span> <span class="nc">SourceUsage</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">import</span> <span class="nn">Lib.SourceModule</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">sm</span><span class="k">:</span> <span class="kt">SourceModule</span>
</span><span class='line'>    <span class="k">import</span> <span class="nn">sm._</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">source01</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="o">(</span><span class="n">i1</span><span class="o">,</span> <span class="n">i2</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">one</span><span class="o">(</span><span class="n">i1</span><span class="o">)</span> <span class="n">bnd</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">z</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="n">one</span><span class="o">(</span><span class="n">i2</span><span class="o">)</span> <span class="n">end</span> <span class="o">{</span>
</span><span class='line'>              <span class="n">y</span> <span class="k">=&gt;</span>
</span><span class='line'>                <span class="o">(</span><span class="n">z</span><span class="o">,</span> <span class="n">y</span><span class="o">)</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">source02</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="o">((</span><span class="n">i1</span><span class="o">,</span> <span class="n">i2</span><span class="o">),</span> <span class="n">i3</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">one</span><span class="o">(</span><span class="n">i1</span><span class="o">)</span> <span class="n">bnd</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">z</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="n">one</span><span class="o">(</span><span class="n">i2</span><span class="o">)</span> <span class="n">bnd</span> <span class="o">{</span>
</span><span class='line'>              <span class="n">y</span> <span class="k">=&gt;</span>
</span><span class='line'>                <span class="n">one</span><span class="o">(</span><span class="n">i3</span><span class="o">)</span> <span class="n">end</span> <span class="o">{</span>
</span><span class='line'>                  <span class="n">x</span> <span class="k">=&gt;</span>
</span><span class='line'>                    <span class="o">((</span><span class="n">z</span><span class="o">,</span> <span class="n">y</span><span class="o">),</span> <span class="n">x</span><span class="o">)</span>
</span><span class='line'>                <span class="o">}</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">source03</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="o">(((</span><span class="n">i1</span><span class="o">,</span> <span class="n">i2</span><span class="o">),</span> <span class="n">i3</span><span class="o">),</span> <span class="n">i4</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">one</span><span class="o">(</span><span class="n">i1</span><span class="o">)</span> <span class="n">bnd</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">z</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="n">one</span><span class="o">(</span><span class="n">i2</span><span class="o">)</span> <span class="n">bnd</span> <span class="o">{</span>
</span><span class='line'>              <span class="n">y</span> <span class="k">=&gt;</span>
</span><span class='line'>                <span class="n">one</span><span class="o">(</span><span class="n">i3</span><span class="o">)</span> <span class="n">bnd</span> <span class="o">{</span>
</span><span class='line'>                  <span class="n">x</span> <span class="k">=&gt;</span>
</span><span class='line'>                    <span class="n">one</span><span class="o">(</span><span class="n">i4</span><span class="o">)</span> <span class="n">end</span> <span class="o">{</span>
</span><span class='line'>                      <span class="n">w</span> <span class="k">=&gt;</span>
</span><span class='line'>                        <span class="o">(((</span><span class="n">z</span><span class="o">,</span> <span class="n">y</span><span class="o">),</span> <span class="n">x</span><span class="o">),</span> <span class="n">w</span><span class="o">)</span>
</span><span class='line'>                    <span class="o">}</span>
</span><span class='line'>                <span class="o">}</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">source04</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="n">i</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">one</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="n">switch</span><span class="o">(</span><span class="k">_</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">_</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="n">one</span><span class="o">(</span><span class="n">i</span><span class="o">)</span>
</span><span class='line'>        <span class="o">}</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">_</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="n">one</span><span class="o">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">i</span><span class="o">)</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example01</span> <span class="k">=</span> <span class="n">source01</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">))</span>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example02</span> <span class="k">=</span> <span class="n">source02</span><span class="o">(((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span> <span class="mi">3</span><span class="o">))</span>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example03</span> <span class="k">=</span> <span class="n">source03</span><span class="o">((((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span> <span class="mi">3</span><span class="o">),</span> <span class="mi">4</span><span class="o">))</span>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example04</span> <span class="k">=</span> <span class="n">source04</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example05</span> <span class="k">=</span> <span class="n">source04</span><span class="o">(</span><span class="mi">11</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">in</span><span class="k">:</span> <span class="kt">In</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="n">source_usage</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">example01</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">example02</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">example03</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">example04</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">example05</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Given a <code>One</code> instance it is possible to define</p>

<figure class='code'><figcaption><span>OneSourceUsage  (OneSourceUsage.scala)</span> <a href='http://www.strongtyped.io/downloads/code/OneSourceUsage.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">object</span> <span class="nc">OneSourceUsage</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">SourceUsage</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">import</span> <span class="nn">Instances.OneModule</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">val</span> <span class="n">sm</span><span class="k">:</span> <span class="kt">OneModule.</span><span class="k">type</span> <span class="o">=</span> <span class="nc">OneModule</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">val</span> <span class="n">in</span> <span class="k">=</span> <span class="o">()</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>and use it as follows</p>

<figure class='code'><figcaption><span>OneSourceUsageInApp  (OneSourceUsageInApp.scala)</span> <a href='http://www.strongtyped.io/downloads/code/OneSourceUsageInApp.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>    <span class="o">{</span>
</span><span class='line'>      <span class="k">import</span> <span class="nn">Usage.OneSourceUsage._</span>
</span><span class='line'>      <span class="n">source_usage</span><span class="o">()</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Running the examples above would then result in something along the following lines</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="o">{</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="o">((</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">),</span><span class="mi">3</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="o">(((</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">),</span><span class="mi">3</span><span class="o">),</span><span class="mi">4</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="mi">5</span> <span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="mi">121</span> <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Polynomial datasource</h2>

<p><em>Polynomial datasources</em> are formalized by the <code>trait</code> below
as a combination of Datasources and Polynomial data</p>

<figure class='code'><figcaption><span>PolynomialSource  (PolynomialSource.scala)</span> <a href='http://www.strongtyped.io/downloads/code/PolynomialSource.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">trait</span> <span class="nc">PolynomialSourceModule</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">SourceModule</span>
</span><span class='line'>    <span class="k">with</span> <span class="nc">PolynomialModule</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">&lt;:</span> <span class="nc">PolynomialSource</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="k">trait</span> <span class="nc">PolynomialSource</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="nc">extends</span> <span class="nc">Source</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="k">with</span> <span class="nc">Polynomial</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span> <span class="n">da</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="k">def</span> <span class="n">filter</span><span class="o">(</span><span class="n">pa</span><span class="k">:</span> <span class="kt">Predicate</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>        <span class="n">da</span><span class="o">.</span><span class="n">switch</span><span class="o">(</span><span class="n">pa</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">a</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="n">a</span> <span class="n">bind</span> <span class="n">one</span>
</span><span class='line'>        <span class="o">}</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">a</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="o">()</span> <span class="n">bind</span> <span class="n">zero</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>trait PolynomialSource[A]</code></p>

<ul>
<li>defines the method <code>filter</code> in terms of <code>switch</code>, <code>one</code> and <code>zero</code></li>
</ul>


<p>Again, the definition of <code>filter</code> is the most natural one you can possibly come up with to get the type right.</p>

<h2>Polynomial datasource usage</h2>

<p>The code below defines some examples that make use of the polynomial datasource DSL</p>

<figure class='code'><figcaption><span>PolynomialSourceUsage  (PolynomialSourceUsage.scala)</span> <a href='http://www.strongtyped.io/downloads/code/PolynomialSourceUsage.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">trait</span> <span class="nc">PolynomialSourceUsage</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">import</span> <span class="nn">Lib.PolynomialSourceModule</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">psm</span><span class="k">:</span> <span class="kt">PolynomialSourceModule</span>
</span><span class='line'>    <span class="k">import</span> <span class="nn">psm._</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">ps01</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="o">(</span><span class="n">i1</span><span class="o">,</span> <span class="n">i2</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">di</span> <span class="k">=&gt;</span>
</span><span class='line'>          <span class="o">(</span><span class="n">di</span> <span class="n">bnd</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">i</span> <span class="k">=&gt;</span>
</span><span class='line'>              <span class="n">di</span> <span class="n">end</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">j</span> <span class="k">=&gt;</span>
</span><span class='line'>                  <span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">j</span><span class="o">)</span>
</span><span class='line'>              <span class="o">}</span>
</span><span class='line'>          <span class="o">})</span> <span class="n">or</span>
</span><span class='line'>            <span class="o">(</span><span class="n">di</span> <span class="n">bnd</span> <span class="o">{</span>
</span><span class='line'>              <span class="n">i</span> <span class="k">=&gt;</span>
</span><span class='line'>                <span class="o">(</span><span class="n">one</span><span class="o">(</span><span class="n">i1</span><span class="o">)</span> <span class="n">or</span> <span class="n">one</span><span class="o">(</span><span class="n">i2</span><span class="o">))</span> <span class="n">end</span> <span class="o">{</span>
</span><span class='line'>                  <span class="n">j</span> <span class="k">=&gt;</span>
</span><span class='line'>                    <span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">j</span><span class="o">)</span>
</span><span class='line'>                <span class="o">}</span>
</span><span class='line'>            <span class="o">})</span> <span class="n">or</span>
</span><span class='line'>            <span class="o">(</span><span class="n">one</span><span class="o">(</span><span class="n">i1</span><span class="o">)</span> <span class="n">bnd</span> <span class="o">{</span>
</span><span class='line'>              <span class="n">i</span> <span class="k">=&gt;</span>
</span><span class='line'>                <span class="n">one</span><span class="o">(</span><span class="n">i2</span><span class="o">)</span> <span class="n">end</span> <span class="o">{</span>
</span><span class='line'>                  <span class="n">j</span> <span class="k">=&gt;</span>
</span><span class='line'>                    <span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">j</span><span class="o">)</span>
</span><span class='line'>                <span class="o">}</span>
</span><span class='line'>            <span class="o">})</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">ps02</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="kt">++</span> <span class="o">(</span><span class="kt">Int</span> <span class="kt">**</span> <span class="o">(</span><span class="kt">Int</span> <span class="kt">++</span> <span class="kt">Int</span><span class="o">))</span> <span class="kt">++</span> <span class="o">(</span><span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span><span class="o">)]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="o">(</span><span class="n">i1</span><span class="o">,</span> <span class="n">i2</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">di</span> <span class="k">=&gt;</span>
</span><span class='line'>          <span class="o">(</span><span class="n">di</span> <span class="n">bnd</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">i</span> <span class="k">=&gt;</span>
</span><span class='line'>              <span class="n">di</span> <span class="n">end</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">j</span> <span class="k">=&gt;</span>
</span><span class='line'>                  <span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">j</span><span class="o">)</span>
</span><span class='line'>              <span class="o">}</span>
</span><span class='line'>          <span class="o">})</span> <span class="o">++</span>
</span><span class='line'>            <span class="o">(</span><span class="n">di</span> <span class="n">bnd</span> <span class="o">{</span>
</span><span class='line'>              <span class="n">i</span> <span class="k">=&gt;</span>
</span><span class='line'>                <span class="o">(</span><span class="n">one</span><span class="o">(</span><span class="n">i1</span><span class="o">)</span> <span class="o">++</span> <span class="n">one</span><span class="o">(</span><span class="n">i2</span><span class="o">))</span> <span class="n">end</span> <span class="o">{</span>
</span><span class='line'>                  <span class="n">j</span> <span class="k">=&gt;</span>
</span><span class='line'>                    <span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">j</span><span class="o">)</span>
</span><span class='line'>                <span class="o">}</span>
</span><span class='line'>            <span class="o">})</span> <span class="o">++</span>
</span><span class='line'>            <span class="o">(</span><span class="n">one</span><span class="o">(</span><span class="n">i1</span><span class="o">)</span> <span class="n">bnd</span> <span class="o">{</span>
</span><span class='line'>              <span class="n">i</span> <span class="k">=&gt;</span>
</span><span class='line'>                <span class="n">one</span><span class="o">(</span><span class="n">i2</span><span class="o">)</span> <span class="n">end</span> <span class="o">{</span>
</span><span class='line'>                  <span class="n">j</span> <span class="k">=&gt;</span>
</span><span class='line'>                    <span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">j</span><span class="o">)</span>
</span><span class='line'>                <span class="o">}</span>
</span><span class='line'>            <span class="o">})</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">fps01</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="o">(</span><span class="n">i1</span><span class="o">,</span> <span class="n">i2</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">di</span> <span class="k">=&gt;</span>
</span><span class='line'>          <span class="n">ps01</span><span class="o">((</span><span class="n">i1</span><span class="o">,</span> <span class="n">i2</span><span class="o">))(</span><span class="n">di</span><span class="o">).</span><span class="n">filter</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">case</span> <span class="o">(</span><span class="n">i1</span><span class="o">,</span> <span class="n">i2</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>              <span class="n">i1</span> <span class="o">==</span> <span class="n">i2</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">fps02</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span> <span class="kt">++</span> <span class="o">(</span><span class="kt">Int</span> <span class="kt">**</span> <span class="o">(</span><span class="kt">Int</span> <span class="kt">++</span> <span class="kt">Int</span><span class="o">))</span> <span class="kt">++</span> <span class="o">(</span><span class="kt">Int</span> <span class="kt">**</span> <span class="kt">Int</span><span class="o">)]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="o">(</span><span class="n">i1</span><span class="o">,</span> <span class="n">i2</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">di</span> <span class="k">=&gt;</span>
</span><span class='line'>          <span class="n">ps02</span><span class="o">((</span><span class="n">i1</span><span class="o">,</span> <span class="n">i2</span><span class="o">))(</span><span class="n">di</span><span class="o">).</span><span class="n">filter</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">case</span> <span class="nc">Right</span><span class="o">(</span><span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>              <span class="kc">true</span>
</span><span class='line'>            <span class="k">case</span> <span class="k">_</span> <span class="k">=&gt;</span>
</span><span class='line'>              <span class="kc">false</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example01</span> <span class="k">=</span> <span class="n">ps01</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">))(</span><span class="n">zero</span><span class="o">(()))</span>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example02</span> <span class="k">=</span> <span class="n">ps01</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">))(</span><span class="n">one</span><span class="o">(</span><span class="mi">3</span><span class="o">))</span>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example03</span> <span class="k">=</span> <span class="n">ps02</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">))(</span><span class="n">zero</span><span class="o">(()))</span>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example04</span> <span class="k">=</span> <span class="n">ps02</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">))(</span><span class="n">one</span><span class="o">(</span><span class="mi">3</span><span class="o">))</span>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example05</span> <span class="k">=</span> <span class="n">fps01</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">))(</span><span class="n">zero</span><span class="o">(()))</span>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example06</span> <span class="k">=</span> <span class="n">fps01</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">))(</span><span class="n">one</span><span class="o">(</span><span class="mi">3</span><span class="o">))</span>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example07</span> <span class="k">=</span> <span class="n">fps02</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">))(</span><span class="n">zero</span><span class="o">(()))</span>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example08</span> <span class="k">=</span> <span class="n">fps02</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">))(</span><span class="n">one</span><span class="o">(</span><span class="mi">3</span><span class="o">))</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">in</span><span class="k">:</span> <span class="kt">In</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="n">polynomial_source_usage</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">example01</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">example02</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">example03</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">example04</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">example05</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">example06</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">example07</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">example08</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Given a <code>ZeroOrOne</code> instance it is possible to define</p>

<figure class='code'><figcaption><span>ZeroOrOnePolynomialSourceUsage  (ZeroOrOnePolynomialSourceUsage.scala)</span> <a href='http://www.strongtyped.io/downloads/code/ZeroOrOnePolynomialSourceUsage.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">object</span> <span class="nc">ZeroOrOnePolynomialSourceUsage</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">PolynomialSourceUsage</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">import</span> <span class="nn">Instances.ZeroOrOneModule</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">val</span> <span class="n">psm</span><span class="k">:</span> <span class="kt">ZeroOrOneModule.</span><span class="k">type</span> <span class="o">=</span> <span class="nc">ZeroOrOneModule</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">val</span> <span class="n">in</span> <span class="k">=</span> <span class="o">()</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>and use it as follows</p>

<figure class='code'><figcaption><span>ZeroOrOnePolynomialSourceUsageInApp  (ZeroOrOnePolynomialSourceUsageInApp.scala)</span> <a href='http://www.strongtyped.io/downloads/code/ZeroOrOnePolynomialSourceUsageInApp.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>    <span class="o">{</span>
</span><span class='line'>      <span class="k">import</span> <span class="nn">Usage.ZeroOrOnePolynomialSourceUsage._</span>
</span><span class='line'>      <span class="n">polynomial_source_usage</span><span class="o">()</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Running the examples above would then result in something along the following lines</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="o">{</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span><span class="mi">3</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="nc">Right</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">))</span> <span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="nc">Left</span><span class="o">(</span><span class="nc">Left</span><span class="o">((</span><span class="mi">3</span><span class="o">,</span><span class="mi">3</span><span class="o">)))</span> <span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span><span class="mi">3</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="nc">Right</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">))</span> <span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Given a <code>ZeroOrMore</code> instance it is possible to define</p>

<figure class='code'><figcaption><span>ZeroOrMorePolynomialSourceUsage  (ZeroOrMorePolynomialSourceUsage.scala)</span> <a href='http://www.strongtyped.io/downloads/code/ZeroOrMorePolynomialSourceUsage.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">object</span> <span class="nc">ZeroOrMorePolynomialSourceUsage</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">PolynomialSourceUsage</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">import</span> <span class="nn">Instances.ZeroOrMoreModule</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">val</span> <span class="n">psm</span><span class="k">:</span> <span class="kt">ZeroOrMoreModule.</span><span class="k">type</span> <span class="o">=</span> <span class="nc">ZeroOrMoreModule</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">val</span> <span class="n">in</span> <span class="k">=</span> <span class="o">()</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>and use it as follows</p>

<figure class='code'><figcaption><span>ZeroOrMorePolynomialSourceUsageInApp  (ZeroOrMorePolynomialSourceUsageInApp.scala)</span> <a href='http://www.strongtyped.io/downloads/code/ZeroOrMorePolynomialSourceUsageInApp.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>    <span class="o">{</span>
</span><span class='line'>      <span class="k">import</span> <span class="nn">Usage.ZeroOrMorePolynomialSourceUsage._</span>
</span><span class='line'>      <span class="n">polynomial_source_usage</span><span class="o">()</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Running the examples above would then result in something along the following lines</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="o">[</span> <span class="o">(</span><span class="err">1</span>,<span class="err">2</span><span class="o">)</span> <span class="o">]</span>
</span><span class='line'><span class="o">[</span> <span class="o">(</span><span class="err">3</span>,<span class="err">3</span><span class="o">)</span> <span class="o">(</span><span class="err">3</span>,<span class="err">1</span><span class="o">)</span> <span class="o">(</span><span class="err">3</span>,<span class="err">2</span><span class="o">)</span> <span class="o">(</span><span class="err">1</span>,<span class="err">2</span><span class="o">)</span> <span class="o">]</span>
</span><span class='line'><span class="o">[</span> <span class="kt">Right</span><span class="o">((</span><span class="err">1</span>,<span class="err">2</span><span class="o">))</span> <span class="o">]</span>
</span><span class='line'><span class="o">[</span> <span class="kt">Left</span><span class="o">(</span><span class="kt">Left</span><span class="o">((</span><span class="err">3</span>,<span class="err">3</span><span class="o">)))</span> <span class="kt">Left</span><span class="o">(</span><span class="kt">Right</span><span class="o">((</span><span class="err">3</span>,<span class="kt">Left</span><span class="o">(</span><span class="err">1</span><span class="o">))))</span> <span class="kt">Left</span><span class="o">(</span><span class="kt">Right</span><span class="o">((</span><span class="err">3</span>,<span class="kt">Right</span><span class="o">(</span><span class="err">2</span><span class="o">))))</span> <span class="kt">Right</span><span class="o">((</span><span class="err">1</span>,<span class="err">2</span><span class="o">))</span> <span class="o">]</span>
</span><span class='line'><span class="o">[</span> <span class="o">]</span>
</span><span class='line'><span class="o">[</span> <span class="o">(</span><span class="err">3</span>,<span class="err">3</span><span class="o">)</span> <span class="o">]</span>
</span><span class='line'><span class="o">[</span> <span class="kt">Right</span><span class="o">((</span><span class="err">1</span>,<span class="err">2</span><span class="o">))</span> <span class="o">]</span>
</span><span class='line'><span class="o">[</span> <span class="kt">Right</span><span class="o">((</span><span class="err">1</span>,<span class="err">2</span><span class="o">))</span> <span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Reducible data</h2>

<p><em>Reducible data</em> are formalized by the <code>trait</code> below</p>

<figure class='code'><figcaption><span>Reducible  (Reducible.scala)</span> <a href='http://www.strongtyped.io/downloads/code/Reducible.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">trait</span> <span class="nc">ReducibleModule</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">&lt;:</span> <span class="nc">Reducible</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">Reducer</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">R</span><span class="o">]</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">identityReducer</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span><span class="k">:</span> <span class="kt">Reducer</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]]</span>
</span><span class='line'>    <span class="k">trait</span> <span class="nc">Reducible</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span> <span class="n">da</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="k">def</span> <span class="n">reducedBy</span><span class="o">[</span><span class="kt">R</span><span class="o">](</span><span class="n">a_r2_r</span><span class="k">:</span> <span class="kt">Reducer</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">R</span><span class="o">])</span><span class="k">:</span> <span class="kt">R</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>trait ReducibleModule</code></p>

<ul>
<li>declares the type <code>Reducer[Z, R]</code></li>
<li>declares the reducer <code>identityReducer</code>

<ul>
<li>given <code>dz</code>, <code>dz reducedBy identityReducer</code> should reduce to <code>dz</code></li>
</ul>
</li>
</ul>


<p><code>trait Reducible[A]</code></p>

<ul>
<li>declares the method <code>reducedBy</code>

<ul>
<li>given <code>da</code>, somehow producing values of type <code>A</code>, and <code>a_r2_r</code>, somehow reducing those values to a result of type <code>R</code>, <code>da reducedBy a_r2_r</code> should reduce those values to that result</li>
</ul>
</li>
</ul>


<h2>Traversable data</h2>

<p><em>Traversable data</em> are formalized by the <code>trait</code> below</p>

<figure class='code'><figcaption><span>Traversable  (Traversable.scala)</span> <a href='http://www.strongtyped.io/downloads/code/Traversable.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">trait</span> <span class="nc">TraversableModule</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">ReducibleModule</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">&lt;:</span> <span class="nc">Traversable</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">MM</span> <span class="o">=</span> <span class="nc">MultiplicativeModule</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">lift</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">Y</span>, <span class="kt">R</span><span class="o">](</span><span class="n">mm</span><span class="k">:</span> <span class="kt">MM</span><span class="o">)(</span><span class="n">z2mmy</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=&gt;</span> <span class="n">mm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">Y</span><span class="o">])</span><span class="k">:</span> <span class="kt">Reducer</span><span class="o">[</span><span class="kt">Y</span>, <span class="kt">R</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="nc">Reducer</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">mm.D</span><span class="o">[</span><span class="kt">R</span><span class="o">]]</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">swap</span><span class="o">[</span><span class="kt">Z</span><span class="o">](</span><span class="n">mm</span><span class="k">:</span> <span class="kt">MM</span><span class="o">)</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">mm.D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]]</span> <span class="k">=&gt;</span> <span class="n">mm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]]</span> <span class="k">=</span>
</span><span class='line'>      <span class="k">_</span><span class="o">.</span><span class="n">foreach</span><span class="o">(</span><span class="n">mm</span><span class="o">)(</span><span class="n">identity</span><span class="o">)(</span><span class="n">identityReducer</span><span class="o">)</span>
</span><span class='line'>    <span class="k">trait</span> <span class="nc">Traversable</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="nc">extends</span> <span class="nc">Reducible</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span> <span class="n">da</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="k">def</span> <span class="n">foreach</span><span class="o">[</span><span class="kt">B</span>, <span class="kt">R</span><span class="o">](</span><span class="n">mm</span><span class="k">:</span> <span class="kt">MM</span><span class="o">)(</span><span class="n">a2mmdb</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">mm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">Reducer</span><span class="o">[</span><span class="kt">B</span>, <span class="kt">R</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="n">mm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">R</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>        <span class="n">lift</span><span class="o">(</span><span class="n">mm</span><span class="o">)(</span><span class="n">a2mmdb</span><span class="o">)</span> <span class="n">andThen</span> <span class="n">da</span><span class="o">.</span><span class="n">reducedBy</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>trait TraversableModule</code></p>

<ul>
<li>defines the type <code>MM</code> as an alias of the type <code>MultiplicativeModule</code></li>
<li>declares the function <code>lift</code>

<ul>
<li>given an <code>mm</code> of type <code>MM</code> and a function <code>z2mmy</code> of type <code>Z =&gt; mm.D[Y]</code>, <code>lift</code> should <em>lift</em> a reducer of type <code>Reducer[Y, R]</code> to a reducer of type <code>Reducer[Z, mm.D[R]]</code></li>
</ul>
</li>
<li>defines the function <code>swap</code>, in terms of <code>foreach</code>, <code>identity</code> and <code>identityReducer</code></li>
</ul>


<p><code>trait Traversable[A]</code></p>

<ul>
<li>defines the method <code>foreach</code> in terms of <code>lift</code> and <code>reducedBy</code></li>
</ul>


<p>Again, the definitions of <code>swap</code> and <code>foreach</code> are the most natural ones you can possibly come up with to get the type right.</p>

<p><em>Traversable polynomial data</em> are formalized by the <code>trait</code> below</p>

<figure class='code'><figcaption><span>TraversablePolynomial  (TraversablePolynomial.scala)</span> <a href='http://www.strongtyped.io/downloads/code/TraversablePolynomial.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">trait</span> <span class="nc">TraversablePolynomialModule</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">PolynomialModule</span>
</span><span class='line'>    <span class="k">with</span> <span class="nc">TraversableModule</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">&lt;:</span> <span class="nc">TraversablePolynomial</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="k">trait</span> <span class="nc">TraversablePolynomial</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="nc">extends</span> <span class="nc">Polynomial</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="k">with</span> <span class="nc">Traversable</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span> <span class="n">da</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=&gt;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><em>Traversable datasources</em> are formalized by the <code>trait</code> below</p>

<figure class='code'><figcaption><span>TraversableSource  (TraversableSource.scala)</span> <a href='http://www.strongtyped.io/downloads/code/TraversableSource.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">trait</span> <span class="nc">TraversableSourceModule</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">SourceModule</span>
</span><span class='line'>    <span class="k">with</span> <span class="nc">TraversableModule</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">&lt;:</span> <span class="nc">TraversableSource</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="k">trait</span> <span class="nc">TraversableSource</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="nc">extends</span> <span class="nc">Source</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="k">with</span> <span class="nc">Traversable</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span> <span class="n">da</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=&gt;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><em>Traversable polynomial datasources</em> are formalized by the <code>trait</code> below</p>

<figure class='code'><figcaption><span>TraversablePolynomialSource  (TraversablePolynomialSource.scala)</span> <a href='http://www.strongtyped.io/downloads/code/TraversablePolynomialSource.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">trait</span> <span class="nc">TraversablePolynomialSourceModule</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">TraversablePolynomialModule</span>
</span><span class='line'>    <span class="k">with</span> <span class="nc">PolynomialSourceModule</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">&lt;:</span> <span class="nc">TraversablePolynomialSource</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="k">trait</span> <span class="nc">TraversablePolynomialSource</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="nc">extends</span> <span class="nc">TraversablePolynomial</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="k">with</span> <span class="nc">PolynomialSource</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span> <span class="n">da</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=&gt;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Traversable polynomial data (and polynomial data) usage</h2>

<p>The code below defines some examples that make use of the traversable polynomial data (and polynomial data) DSL</p>

<figure class='code'><figcaption><span>TraversablePolynomialAndPolynomialUsage  (TraversablePolynomialAndPolynomialUsage.scala)</span> <a href='http://www.strongtyped.io/downloads/code/TraversablePolynomialAndPolynomialUsage.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">trait</span> <span class="nc">TraversablePolynomialAndPolynomialUsage</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">import</span> <span class="nn">Lib.TraversablePolynomialModule</span>
</span><span class='line'>    <span class="k">import</span> <span class="nn">Lib.PolynomialModule</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">tpm</span><span class="k">:</span> <span class="kt">TraversablePolynomialModule</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">pm</span><span class="k">:</span> <span class="kt">PolynomialModule</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">tp_p</span><span class="k">:</span> <span class="kt">pm.D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">**</span> <span class="n">pm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">**</span> <span class="n">pm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="n">tpm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">pm.D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="o">((</span><span class="n">pmd01</span><span class="o">,</span> <span class="n">pmd02</span><span class="o">),</span> <span class="n">pmd03</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">tpm</span><span class="o">.</span><span class="n">one</span><span class="o">(</span><span class="n">pmd01</span><span class="o">)</span> <span class="n">or</span> <span class="n">tpm</span><span class="o">.</span><span class="n">one</span><span class="o">(</span><span class="n">pmd02</span><span class="o">)</span> <span class="n">or</span> <span class="n">tpm</span><span class="o">.</span><span class="n">one</span><span class="o">(</span><span class="n">pmd03</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">p_tp</span><span class="k">:</span> <span class="kt">pm.D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">**</span> <span class="n">pm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">**</span> <span class="n">pm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="n">pm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">tpm.D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]]</span> <span class="k">=</span>
</span><span class='line'>      <span class="n">tp_p</span> <span class="n">andThen</span> <span class="n">tpm</span><span class="o">.</span><span class="n">swap</span><span class="o">(</span><span class="n">pm</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example01</span><span class="k">:</span> <span class="kt">pm.D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">**</span> <span class="n">pm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">**</span> <span class="n">pm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>      <span class="o">((</span><span class="n">pm</span><span class="o">.</span><span class="n">one</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="n">pm</span><span class="o">.</span><span class="n">one</span><span class="o">(</span><span class="mi">2</span><span class="o">)),</span> <span class="n">pm</span><span class="o">.</span><span class="n">one</span><span class="o">(</span><span class="mi">3</span><span class="o">))</span>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example02</span><span class="k">:</span> <span class="kt">pm.D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">**</span> <span class="n">pm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">**</span> <span class="n">pm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>      <span class="o">((</span><span class="n">pm</span><span class="o">.</span><span class="n">zero</span><span class="o">(()),</span> <span class="n">pm</span><span class="o">.</span><span class="n">one</span><span class="o">(</span><span class="mi">2</span><span class="o">)),</span> <span class="n">pm</span><span class="o">.</span><span class="n">one</span><span class="o">(</span><span class="mi">3</span><span class="o">))</span>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example03</span><span class="k">:</span> <span class="kt">pm.D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">**</span> <span class="n">pm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">**</span> <span class="n">pm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>      <span class="o">((</span><span class="n">pm</span><span class="o">.</span><span class="n">one</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="n">pm</span><span class="o">.</span><span class="n">zero</span><span class="o">(())),</span> <span class="n">pm</span><span class="o">.</span><span class="n">zero</span><span class="o">(()))</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">tpm_in</span><span class="k">:</span> <span class="kt">tpm.In</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">pm_in</span><span class="k">:</span> <span class="kt">pm.In</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="n">traversablePolynomial_and_polynomial_usage</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">tp_p</span><span class="o">(</span><span class="n">example01</span><span class="o">).</span><span class="n">run</span><span class="o">(</span><span class="n">tpm_in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">p_tp</span><span class="o">(</span><span class="n">example01</span><span class="o">).</span><span class="n">run</span><span class="o">(</span><span class="n">pm_in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">tp_p</span><span class="o">(</span><span class="n">example02</span><span class="o">).</span><span class="n">run</span><span class="o">(</span><span class="n">tpm_in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">p_tp</span><span class="o">(</span><span class="n">example02</span><span class="o">).</span><span class="n">run</span><span class="o">(</span><span class="n">pm_in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">tp_p</span><span class="o">(</span><span class="n">example03</span><span class="o">).</span><span class="n">run</span><span class="o">(</span><span class="n">tpm_in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">p_tp</span><span class="o">(</span><span class="n">example03</span><span class="o">).</span><span class="n">run</span><span class="o">(</span><span class="n">pm_in</span><span class="o">))</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Given <code>ZeroOrMore</code> and <code>ZeroOrOne</code> instances it is possible to define</p>

<figure class='code'><figcaption><span>ZeroOrMoreAndZeroOrOneUsage  (ZeroOrMoreAndZeroOrOneUsage.scala)</span> <a href='http://www.strongtyped.io/downloads/code/ZeroOrMoreAndZeroOrOneUsage.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">object</span> <span class="nc">ZeroOrMoreAndZeroOrOneUsage</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">TraversablePolynomialAndPolynomialUsage</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">import</span> <span class="nn">Instances.ZeroOrMoreModule</span>
</span><span class='line'>    <span class="k">import</span> <span class="nn">Instances.ZeroOrOneModule</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">override</span> <span class="k">val</span> <span class="n">tpm</span><span class="k">:</span> <span class="kt">ZeroOrMoreModule.</span><span class="k">type</span> <span class="o">=</span> <span class="nc">ZeroOrMoreModule</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">val</span> <span class="n">pm</span><span class="k">:</span> <span class="kt">ZeroOrOneModule.</span><span class="k">type</span> <span class="o">=</span> <span class="nc">ZeroOrOneModule</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">override</span> <span class="k">val</span> <span class="n">tpm_in</span> <span class="k">=</span> <span class="o">()</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">val</span> <span class="n">pm_in</span> <span class="k">=</span> <span class="o">()</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>and use it as follows</p>

<figure class='code'><figcaption><span>ZeroOrMoreAndZeroOrOneUsageInApp  (ZeroOrMoreAndZeroOrOneUsageInApp.scala)</span> <a href='http://www.strongtyped.io/downloads/code/ZeroOrMoreAndZeroOrOneUsageInApp.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>    <span class="o">{</span>
</span><span class='line'>      <span class="k">import</span> <span class="nn">Usage.ZeroOrMoreAndZeroOrOneUsage._</span>
</span><span class='line'>      <span class="n">traversablePolynomial_and_polynomial_usage</span><span class="o">()</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Running the examples above would then result in something along the following lines</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="o">[</span> <span class="o">{</span> <span class="err">1</span> <span class="o">}</span> <span class="o">{</span> <span class="err">2</span> <span class="o">}</span> <span class="o">{</span> <span class="err">3</span> <span class="o">}</span> <span class="o">]</span>
</span><span class='line'><span class="o">{</span> <span class="o">[</span> <span class="err">1</span> <span class="err">2</span> <span class="err">3</span> <span class="o">]</span> <span class="o">}</span>
</span><span class='line'><span class="o">[</span> <span class="o">{</span> <span class="o">}</span> <span class="o">{</span> <span class="err">2</span> <span class="o">}</span> <span class="o">{</span> <span class="err">3</span> <span class="o">}</span> <span class="o">]</span>
</span><span class='line'><span class="o">{</span> <span class="o">}</span>
</span><span class='line'><span class="o">[</span> <span class="o">{</span> <span class="err">1</span> <span class="o">}</span> <span class="o">{</span> <span class="o">}</span> <span class="o">{</span> <span class="o">}</span> <span class="o">]</span>
</span><span class='line'><span class="o">{</span> <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><em>Note</em> We swapped to a non-zero result if and only if all values are non-zero.</p>

<p>as such</p>

<ul>
<li><code>ZeroOrOne</code> could be used as a <em>success or failure</em> mechanism</li>
</ul>


<p>but</p>

<ul>
<li><code>ZeroOrOne</code> should be used for what it is meant for: <em>zero</em> or <em>one</em> values</li>
</ul>


<h2>Failure handling strategies</h2>

<p>Below are two failure handling strategies</p>

<ul>
<li><em>fail fast</em></li>
<li><em>fail slow</em> and <em>accumulate</em> failure information</li>
</ul>


<h2>Monoids</h2>

<p>Accumulation is modeled by the <em>monoid</em> concept.</p>

<p><em>Monoids</em> are formalized by the <code>trait</code> below</p>

<figure class='code'><figcaption><span>Monoid  (Monoid.scala)</span> <a href='http://www.strongtyped.io/downloads/code/Monoid.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">trait</span> <span class="nc">MonoidModule</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">M</span> <span class="k">&lt;:</span> <span class="kt">Monoid</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">neutral</span><span class="k">:</span> <span class="kt">M</span>
</span><span class='line'>    <span class="k">trait</span> <span class="nc">Monoid</span> <span class="o">{</span> <span class="n">m</span><span class="k">:</span> <span class="kt">M</span> <span class="o">=&gt;</span>
</span><span class='line'>      <span class="k">def</span> <span class="n">operator</span><span class="o">(</span><span class="n">m1</span><span class="k">:</span> <span class="kt">M</span><span class="o">)</span><span class="k">:</span> <span class="kt">M</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>trait MonoidModule</code></p>

<ul>
<li>declares the type <code>M</code> as a subtype of <code>Monoid</code></li>
<li>declares the <code>neutral</code> element of type <code>M</code></li>
</ul>


<p><code>trait Monoid</code></p>

<ul>
<li>declares the method <code>operator</code>

<ul>
<li>given an element <code>m</code> of type <code>M</code> and an element <code>m1</code> of type <code>M</code>, <code>m operator m1</code> should be an element of type <code>M</code></li>
</ul>
</li>
</ul>


<p><em>Strings as monoids</em> are formalized by the instance below</p>

<figure class='code'><figcaption><span>StringMonoid  (StringMonoid.scala)</span> <a href='http://www.strongtyped.io/downloads/code/StringMonoid.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">object</span> <span class="nc">StringMonoidModule</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">MonoidModule</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">M</span> <span class="o">=</span> <span class="nc">StringMonoid</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">def</span> <span class="n">neutral</span> <span class="k">=</span>
</span><span class='line'>      <span class="nc">StringMonoid</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">)</span>
</span><span class='line'>    <span class="k">case</span> <span class="k">class</span> <span class="nc">StringMonoid</span><span class="o">(</span><span class="n">s</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>
</span><span class='line'>      <span class="k">extends</span> <span class="nc">Monoid</span> <span class="o">{</span> <span class="n">m</span><span class="k">:</span> <span class="kt">M</span> <span class="o">=&gt;</span>
</span><span class='line'>      <span class="k">override</span> <span class="k">def</span> <span class="n">operator</span><span class="o">(</span><span class="n">m1</span><span class="k">:</span> <span class="kt">M</span><span class="o">)</span> <span class="k">=</span>
</span><span class='line'>        <span class="nc">StringMonoid</span><span class="o">(</span><span class="n">s</span><span class="s">&quot;${m.s} ${m1.s}&quot;</span><span class="o">)</span>
</span><span class='line'>      <span class="k">override</span> <span class="k">def</span> <span class="n">toString</span> <span class="k">=</span>
</span><span class='line'>        <span class="n">s</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Failing data</h2>

<p><em>Failing data</em> are formalized by the <code>trait</code> below</p>

<figure class='code'><figcaption><span>Failing  (Failing.scala)</span> <a href='http://www.strongtyped.io/downloads/code/Failing.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">trait</span> <span class="nc">FailingModule</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">HasZeroModule</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">mm</span><span class="k">:</span> <span class="kt">MonoidModule</span>
</span><span class='line'>    <span class="k">import</span> <span class="nn">mm._</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">&lt;:</span> <span class="nc">Failing</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">fail</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span><span class="k">:</span> <span class="kt">M</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">def</span> <span class="n">zero</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>      <span class="k">_</span> <span class="k">=&gt;</span> <span class="n">fail</span><span class="o">(</span><span class="n">neutral</span><span class="o">)</span>
</span><span class='line'>    <span class="k">trait</span> <span class="nc">Failing</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="nc">extends</span> <span class="nc">HasZero</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span> <span class="n">da</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=&gt;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>trait FailingModule</code></p>

<ul>
<li>declares a <code>mm</code> of type <code>MonoidModule</code> and does an appropriate import</li>
<li>declares the function <code>fail</code>

<ul>
<li>given an element <code>m</code> of type <code>M</code>, <code>fail(m)</code> should, somehow, not yield any values, but fail instead with failure information <code>m</code></li>
</ul>
</li>
<li>defines the function <code>zero</code> in terms of <code>fail</code> and <code>neutral</code></li>
</ul>


<p><em>Polynomial failing data</em> are formalized by the <code>trait</code> below</p>

<figure class='code'><figcaption><span>PolynomialFailing  (PolynomialFailing.scala)</span> <a href='http://www.strongtyped.io/downloads/code/PolynomialFailing.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">trait</span> <span class="nc">PolynomialFailingModule</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">PolynomialModule</span>
</span><span class='line'>    <span class="k">with</span> <span class="nc">FailingModule</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">&lt;:</span> <span class="nc">PolynomialFailing</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="k">trait</span> <span class="nc">PolynomialFailing</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="nc">extends</span> <span class="nc">Polynomial</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="k">with</span> <span class="nc">Failing</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span> <span class="n">da</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=&gt;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The simplest <code>PolynomialFailingModule</code> instance one can think of is one along the following lines</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">trait</span> <span class="nc">SuccessOrFailureModule</span> <span class="o">{</span>
</span><span class='line'>  <span class="c1">// ...</span>
</span><span class='line'>  <span class="k">sealed</span> <span class="k">trait</span> <span class="nc">SuccessOrFailure</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span>
</span><span class='line'>  <span class="c1">// ...</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  <span class="k">private</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Failure</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">m</span><span class="k">:</span> <span class="kt">M</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">SuccessOrFailure</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>  <span class="k">private</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Success</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">a</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">SuccessOrFailure</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Think of <code>SuccessOrFailure[Z]</code> as a data source that produces <em>one value</em> or <em>fails</em>.</p>

<p><em>Note:</em> <code>SuccessOrFailureModule</code> is a <code>trait</code> (<code>mm</code> still needs to be defined).</p>

<p>The simplest <code>SuccessOrFailureModule</code> instance one can think of is the following</p>

<figure class='code'><figcaption><span>StringSuccessOrFailureModule  (StringSuccessOrFailureModule.scala)</span> <a href='http://www.strongtyped.io/downloads/code/StringSuccessOrFailureModule.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">object</span> <span class="nc">StringSuccessOrFailureModule</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">SuccessOrFailureModule</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">mm</span><span class="k">:</span> <span class="kt">StringMonoidModule.</span><span class="k">type</span> <span class="o">=</span> <span class="nc">StringMonoidModule</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Traversable polynomial data (and polynomial failing data) usage</h2>

<p>The code below defines some examples that make use of the traversable polynomial data (and polynomial failing data) DSL</p>

<figure class='code'><figcaption><span>TraversablePolynomialAndPolynomialFailingUsage  (TraversablePolynomialAndPolynomialFailingUsage.scala)</span> <a href='http://www.strongtyped.io/downloads/code/TraversablePolynomialAndPolynomialFailingUsage.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">trait</span> <span class="nc">TraversablePolynomialAndPolynomialFailingUsage</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">import</span> <span class="nn">Lib.TraversablePolynomialModule</span>
</span><span class='line'>    <span class="k">import</span> <span class="nn">Lib.PolynomialFailingModule</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">tpm</span><span class="k">:</span> <span class="kt">TraversablePolynomialModule</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">pfm</span><span class="k">:</span> <span class="kt">PolynomialFailingModule</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">tp_pf</span><span class="k">:</span> <span class="kt">pfm.D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">**</span> <span class="n">pfm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">**</span> <span class="n">pfm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="n">tpm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">pfm.D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="o">((</span><span class="n">mfmd01</span><span class="o">,</span> <span class="n">mfmd02</span><span class="o">),</span> <span class="n">mfmd03</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">tpm</span><span class="o">.</span><span class="n">one</span><span class="o">(</span><span class="n">mfmd01</span><span class="o">)</span> <span class="n">or</span> <span class="n">tpm</span><span class="o">.</span><span class="n">one</span><span class="o">(</span><span class="n">mfmd02</span><span class="o">)</span> <span class="n">or</span> <span class="n">tpm</span><span class="o">.</span><span class="n">one</span><span class="o">(</span><span class="n">mfmd03</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">pf_tp</span><span class="k">:</span> <span class="kt">pfm.D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">**</span> <span class="n">pfm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">**</span> <span class="n">pfm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="n">pfm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">tpm.D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]]</span> <span class="k">=</span>
</span><span class='line'>      <span class="n">tp_pf</span> <span class="n">andThen</span> <span class="n">tpm</span><span class="o">.</span><span class="n">swap</span><span class="o">(</span><span class="n">pfm</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">m1</span><span class="k">:</span> <span class="kt">pfm.mm.M</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">m2</span><span class="k">:</span> <span class="kt">pfm.mm.M</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example01</span><span class="k">:</span> <span class="kt">pfm.D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">**</span> <span class="n">pfm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">**</span> <span class="n">pfm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>      <span class="o">((</span><span class="n">pfm</span><span class="o">.</span><span class="n">one</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="n">pfm</span><span class="o">.</span><span class="n">one</span><span class="o">(</span><span class="mi">2</span><span class="o">)),</span> <span class="n">pfm</span><span class="o">.</span><span class="n">one</span><span class="o">(</span><span class="mi">3</span><span class="o">))</span>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example02</span><span class="k">:</span> <span class="kt">pfm.D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">**</span> <span class="n">pfm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">**</span> <span class="n">pfm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>      <span class="o">((</span><span class="n">pfm</span><span class="o">.</span><span class="n">fail</span><span class="o">(</span><span class="n">m1</span><span class="o">),</span> <span class="n">pfm</span><span class="o">.</span><span class="n">one</span><span class="o">(</span><span class="mi">2</span><span class="o">)),</span> <span class="n">pfm</span><span class="o">.</span><span class="n">one</span><span class="o">(</span><span class="mi">3</span><span class="o">))</span>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">example03</span><span class="k">:</span> <span class="kt">pfm.D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">**</span> <span class="n">pfm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">**</span> <span class="n">pfm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>      <span class="o">((</span><span class="n">pfm</span><span class="o">.</span><span class="n">one</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="n">pfm</span><span class="o">.</span><span class="n">fail</span><span class="o">(</span><span class="n">m1</span><span class="o">)),</span> <span class="n">pfm</span><span class="o">.</span><span class="n">fail</span><span class="o">(</span><span class="n">m2</span><span class="o">))</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">tpm_in</span><span class="k">:</span> <span class="kt">tpm.In</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">mfm_in</span><span class="k">:</span> <span class="kt">pfm.In</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="n">traversablePolynomial_and_multiplicativeFailing_usage</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">tp_pf</span><span class="o">(</span><span class="n">example01</span><span class="o">).</span><span class="n">run</span><span class="o">(</span><span class="n">tpm_in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">pf_tp</span><span class="o">(</span><span class="n">example01</span><span class="o">).</span><span class="n">run</span><span class="o">(</span><span class="n">mfm_in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">tp_pf</span><span class="o">(</span><span class="n">example02</span><span class="o">).</span><span class="n">run</span><span class="o">(</span><span class="n">tpm_in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">pf_tp</span><span class="o">(</span><span class="n">example02</span><span class="o">).</span><span class="n">run</span><span class="o">(</span><span class="n">mfm_in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">tp_pf</span><span class="o">(</span><span class="n">example03</span><span class="o">).</span><span class="n">run</span><span class="o">(</span><span class="n">tpm_in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">pf_tp</span><span class="o">(</span><span class="n">example03</span><span class="o">).</span><span class="n">run</span><span class="o">(</span><span class="n">mfm_in</span><span class="o">))</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Given <code>ZeroOrMore</code> and <code>StringSuccessOrFailure</code> instances it is possible to define</p>

<figure class='code'><figcaption><span>ZeroOrMoreAndStringSuccessOrFailureUsage  (ZeroOrMoreAndStringSuccessOrFailureUsage.scala)</span> <a href='http://www.strongtyped.io/downloads/code/ZeroOrMoreAndStringSuccessOrFailureUsage.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">object</span> <span class="nc">ZeroOrMoreAndStringSuccessOrFailureUsage</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">TraversablePolynomialAndPolynomialFailingUsage</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">import</span> <span class="nn">Instances.ZeroOrMoreModule</span>
</span><span class='line'>    <span class="k">import</span> <span class="nn">Instances.StringSuccessOrFailureModule</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">override</span> <span class="k">val</span> <span class="n">tpm</span><span class="k">:</span> <span class="kt">ZeroOrMoreModule.</span><span class="k">type</span> <span class="o">=</span> <span class="nc">ZeroOrMoreModule</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">val</span> <span class="n">pfm</span><span class="k">:</span> <span class="kt">StringSuccessOrFailureModule.</span><span class="k">type</span> <span class="o">=</span> <span class="nc">StringSuccessOrFailureModule</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">import</span> <span class="nn">pfm.mm._</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">override</span> <span class="k">val</span> <span class="n">m1</span> <span class="k">=</span> <span class="nc">StringMonoid</span><span class="o">(</span><span class="s">&quot;failure1&quot;</span><span class="o">)</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">val</span> <span class="n">m2</span> <span class="k">=</span> <span class="nc">StringMonoid</span><span class="o">(</span><span class="s">&quot;failure2&quot;</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">override</span> <span class="k">val</span> <span class="n">tpm_in</span> <span class="k">=</span> <span class="o">()</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">val</span> <span class="n">mfm_in</span> <span class="k">=</span> <span class="o">()</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>and use it as follows</p>

<figure class='code'><figcaption><span>ZeroOrMoreAndStringSuccessOrFailureUsageInApp  (ZeroOrMoreAndStringSuccessOrFailureUsageInApp.scala)</span> <a href='http://www.strongtyped.io/downloads/code/ZeroOrMoreAndStringSuccessOrFailureUsageInApp.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>    <span class="o">{</span>
</span><span class='line'>      <span class="k">import</span> <span class="nn">Usage.ZeroOrMoreAndStringSuccessOrFailureUsage._</span>
</span><span class='line'>      <span class="n">traversablePolynomial_and_multiplicativeFailing_usage</span><span class="o">()</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Running the examples above would then result in something along the following lines</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="o">[</span> <span class="o">{</span> <span class="err">1</span> <span class="o">}</span> <span class="o">{</span> <span class="err">2</span> <span class="o">}</span> <span class="o">{</span> <span class="err">3</span> <span class="o">}</span> <span class="o">]</span>
</span><span class='line'><span class="o">{</span> <span class="o">[</span> <span class="err">1</span> <span class="err">2</span> <span class="err">3</span> <span class="o">]</span> <span class="o">}</span>
</span><span class='line'><span class="o">[</span> <span class="o">{</span> <span class="kt">failure1</span> <span class="o">}</span> <span class="o">{</span> <span class="err">2</span> <span class="o">}</span> <span class="o">{</span> <span class="err">3</span> <span class="o">}</span> <span class="o">]</span>
</span><span class='line'><span class="o">{</span> <span class="n">failure1</span> <span class="o">}</span>
</span><span class='line'><span class="o">[</span> <span class="o">{</span> <span class="err">1</span> <span class="o">}</span> <span class="o">{</span> <span class="kt">failure1</span> <span class="o">}</span> <span class="o">{</span> <span class="kt">failure2</span> <span class="o">}</span> <span class="o">]</span>
</span><span class='line'><span class="o">{</span> <span class="n">failure1</span> <span class="n">failure2</span> <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>If, as suggested in the code of the actual implementation (not given yet), you comment out the <em>overriding definition</em> of <code>and</code> and make use of the <em>default definition</em> instead, then this results in something along the following lines</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="o">[</span> <span class="o">{</span> <span class="err">1</span> <span class="o">}</span> <span class="o">{</span> <span class="err">2</span> <span class="o">}</span> <span class="o">{</span> <span class="err">3</span> <span class="o">}</span> <span class="o">]</span>
</span><span class='line'><span class="o">{</span> <span class="o">[</span> <span class="err">1</span> <span class="err">2</span> <span class="err">3</span> <span class="o">]</span> <span class="o">}</span>
</span><span class='line'><span class="o">[</span> <span class="o">{</span> <span class="kt">failure1</span> <span class="o">}</span> <span class="o">{</span> <span class="err">2</span> <span class="o">}</span> <span class="o">{</span> <span class="err">3</span> <span class="o">}</span> <span class="o">]</span>
</span><span class='line'><span class="o">{</span> <span class="n">failure1</span> <span class="o">}</span>
</span><span class='line'><span class="o">[</span> <span class="o">{</span> <span class="err">1</span> <span class="o">}</span> <span class="o">{</span> <span class="kt">failure1</span> <span class="o">}</span> <span class="o">{</span> <span class="kt">failure2</span> <span class="o">}</span> <span class="o">]</span>
</span><span class='line'><span class="o">{</span> <span class="n">failure1</span> <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><em>What is the moral of this story:</em></p>

<ul>
<li><code>and</code>, being more abstract than <code>bnd</code>, has more implementation flexibility</li>
</ul>


<p>The default fail fast strategy implementation can (but does not have to) be overridden by a fail slow and accumulate strategy implementation.</p>

<h2>Stateful data</h2>

<p><em>Stateful data</em> are formalized by the <code>trait</code> below</p>

<figure class='code'><figcaption><span>Stateful  (Stateful.scala)</span> <a href='http://www.strongtyped.io/downloads/code/Stateful.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">trait</span> <span class="nc">StatefulModule</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">S</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">&lt;:</span> <span class="nc">Stateful</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">get</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">S</span><span class="o">]</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">set</span><span class="k">:</span> <span class="kt">S</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">exec</span><span class="k">:</span> <span class="o">(</span><span class="kt">S</span> <span class="o">=&gt;</span> <span class="kt">S</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span>
</span><span class='line'>    <span class="k">trait</span> <span class="nc">Stateful</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>trait StatefulModule</code></p>

<ul>
<li>declares a type <code>S</code>

<ul>
<li><code>S</code> represents <em>state</em></li>
</ul>
</li>
<li>declares the function <code>get</code>

<ul>
<li><code>get(())</code> should, somehow, produce the current state</li>
</ul>
</li>
<li>declares the function <code>set</code>

<ul>
<li><code>set(s)</code> should, somehow, set the current state (and produce <code>()</code>)</li>
</ul>
</li>
<li>declares the function <code>exec</code>

<ul>
<li>given a function <code>s2s</code>, <code>exec(s2s)</code> should, somehow, transform the current state <code>s</code> to <code>s2s(s)</code> (and produce <code>()</code>)</li>
</ul>
</li>
</ul>


<h2>Stateful data source</h2>

<p><em>Stateful datasources</em> are formalized by the <code>trait</code> below</p>

<figure class='code'><figcaption><span>StatefulSource  (StatefulSource.scala)</span> <a href='http://www.strongtyped.io/downloads/code/StatefulSource.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">trait</span> <span class="nc">StatefulSourceModule</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">SourceModule</span>
</span><span class='line'>    <span class="k">with</span> <span class="nc">StatefulModule</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">&lt;:</span> <span class="nc">StatefulSource</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">def</span> <span class="n">exec</span><span class="k">:</span> <span class="o">(</span><span class="kt">S</span> <span class="o">=&gt;</span> <span class="kt">S</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>      <span class="n">s2s</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">get</span><span class="o">(())</span> <span class="n">bnd</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">s</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="n">set</span><span class="o">(</span><span class="n">s2s</span><span class="o">(</span><span class="n">s</span><span class="o">))</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="k">trait</span> <span class="nc">StatefulSource</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="nc">extends</span> <span class="nc">Source</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="k">with</span> <span class="nc">Stateful</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span> <span class="n">da</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=&gt;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>trait StatefulSourceModule</code></p>

<ul>
<li>defines the function <code>exec</code> in terms of <code>get</code>, <code>set</code> and <code>bnd</code></li>
</ul>


<h2>Stateful datasource usage</h2>

<p>The code below defines some example that makes use of the stateful datasource DSL.
It deals with a simple &ldquo;coin and candy&rdquo; state machine.</p>

<figure class='code'><figcaption><span>StatefulSourceUsage  (StatefulSourceUsage.scala)</span> <a href='http://www.strongtyped.io/downloads/code/StatefulSourceUsage.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">trait</span> <span class="nc">StatefulSourceUsage</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">import</span> <span class="nn">Lib.TraversablePolynomialModule</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">tpm</span><span class="k">:</span> <span class="kt">TraversablePolynomialModule</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">import</span> <span class="nn">Lib.StatefulSourceModule</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">object</span> <span class="nc">Status</span> <span class="k">extends</span> <span class="nc">Enumeration</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">val</span> <span class="nc">FREE</span><span class="o">,</span> <span class="nc">BUSY</span> <span class="k">=</span> <span class="nc">Value</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">object</span> <span class="nc">Action</span> <span class="k">extends</span> <span class="nc">Enumeration</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">val</span> <span class="nc">COIN_IN</span><span class="o">,</span> <span class="nc">CANDY_OUT</span> <span class="k">=</span> <span class="nc">Value</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">import</span> <span class="nn">Status.</span><span class="o">{</span> <span class="nc">FREE</span><span class="o">,</span> <span class="nc">BUSY</span> <span class="o">}</span>
</span><span class='line'>    <span class="k">import</span> <span class="nn">Action.</span><span class="o">{</span> <span class="nc">COIN_IN</span><span class="o">,</span> <span class="nc">CANDY_OUT</span> <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="k">class</span> <span class="nc">Machine</span><span class="o">(</span><span class="n">status</span><span class="k">:</span> <span class="kt">Status.Value</span><span class="o">,</span> <span class="n">candies</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">coins</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">def</span> <span class="n">acceptsCoinIn</span> <span class="k">=</span> <span class="n">candies</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">==</span> <span class="nc">FREE</span>
</span><span class='line'>      <span class="k">def</span> <span class="n">acceptsCandyOut</span> <span class="k">=</span> <span class="n">candies</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">==</span> <span class="nc">BUSY</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">ssm</span><span class="k">:</span> <span class="kt">StatefulSourceModule</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">type</span> <span class="kt">S</span> <span class="o">=</span> <span class="kt">Machine</span>
</span><span class='line'>      <span class="k">type</span> <span class="kt">In</span> <span class="o">=</span> <span class="n">S</span>
</span><span class='line'>      <span class="k">type</span> <span class="kt">Out</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span> <span class="n">S</span> <span class="o">**</span> <span class="n">Z</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">import</span> <span class="nn">ssm._</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="n">executeAction</span><span class="k">:</span> <span class="kt">Action.Value</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>      <span class="n">action</span> <span class="k">=&gt;</span> <span class="n">exec</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">machine</span> <span class="k">=&gt;</span>
</span><span class='line'>          <span class="n">action</span> <span class="k">match</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">case</span> <span class="nc">COIN_IN</span> <span class="k">if</span> <span class="o">(</span><span class="n">machine</span><span class="o">.</span><span class="n">acceptsCoinIn</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>              <span class="nc">Machine</span><span class="o">(</span><span class="nc">BUSY</span><span class="o">,</span> <span class="n">machine</span><span class="o">.</span><span class="n">candies</span><span class="o">,</span> <span class="n">machine</span><span class="o">.</span><span class="n">coins</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span>
</span><span class='line'>            <span class="k">case</span> <span class="nc">CANDY_OUT</span> <span class="k">if</span> <span class="o">(</span><span class="n">machine</span><span class="o">.</span><span class="n">acceptsCandyOut</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>              <span class="nc">Machine</span><span class="o">(</span><span class="nc">FREE</span><span class="o">,</span> <span class="n">machine</span><span class="o">.</span><span class="n">candies</span> <span class="o">-</span> <span class="mi">1</span><span class="o">,</span> <span class="n">machine</span><span class="o">.</span><span class="n">coins</span><span class="o">)</span>
</span><span class='line'>            <span class="k">case</span> <span class="k">_</span> <span class="k">=&gt;</span>
</span><span class='line'>              <span class="n">machine</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">initialMachine</span><span class="k">:</span> <span class="kt">Machine</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">reducer</span><span class="k">:</span> <span class="kt">tpm.Reducer</span><span class="o">[</span><span class="kt">Unit</span>, <span class="kt">Unit</span><span class="o">]</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">actions</span><span class="k">:</span> <span class="kt">tpm.D</span><span class="o">[</span><span class="kt">Action.Value</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">ss</span><span class="k">:</span> <span class="kt">ssm.D</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>      <span class="n">actions</span><span class="o">.</span><span class="n">foreach</span><span class="o">(</span><span class="n">ssm</span><span class="o">)(</span><span class="n">executeAction</span><span class="o">)(</span><span class="n">reducer</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="n">stateful_source_usage</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">val</span> <span class="n">finalMachine</span><span class="k">:</span> <span class="kt">Machine</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">initialMachine</span><span class="o">).</span><span class="n">_1</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">finalMachine</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The simplest stateful <code>Runnable</code> implementation is the following</p>

<figure class='code'><figcaption><span>StatefulRunnableModule  (StatefulRunnableModule.scala)</span> <a href='http://www.strongtyped.io/downloads/code/StatefulRunnableModule.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">trait</span> <span class="nc">StatefulRunnableModule</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">RunnableModule</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">&lt;:</span> <span class="nc">StatefulRunnable</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">S</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">In</span> <span class="o">=</span> <span class="n">S</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">Out</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span> <span class="n">S</span> <span class="o">**</span> <span class="n">Z</span>
</span><span class='line'>    <span class="k">trait</span> <span class="nc">StatefulRunnable</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="nc">extends</span> <span class="nc">Runnable</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span> <span class="n">da</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=&gt;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The simplest <code>StatefulSourceModule</code> instance one can think of is one along the following lines</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">object</span> <span class="nc">StateModule</span> <span class="o">{</span>
</span><span class='line'>  <span class="c1">// ...</span>
</span><span class='line'>  <span class="k">case</span> <span class="k">class</span> <span class="nc">State</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">s_2_sna</span><span class="k">:</span> <span class="kt">S</span> <span class="o">=&gt;</span> <span class="n">S</span> <span class="o">**</span> <span class="n">A</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="c1">// ...</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Think of <code>State[Z]</code> as a data source that produces, <em>maintaining state while producing</em>, one value.</p>

<p>Given a <code>State[Z]</code> instance it is possible to define</p>

<figure class='code'><figcaption><span>StateUsage  (StateUsage.scala)</span> <a href='http://www.strongtyped.io/downloads/code/StateUsage.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">object</span> <span class="nc">StateUsage</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">StatefulSourceUsage</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">import</span> <span class="nn">Instances.ZeroOrMoreModule</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">override</span> <span class="k">val</span> <span class="n">tpm</span><span class="k">:</span> <span class="kt">ZeroOrMoreModule.</span><span class="k">type</span> <span class="o">=</span> <span class="nc">ZeroOrMoreModule</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">import</span> <span class="nn">Instances.StateModule</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">object</span> <span class="nc">MachineStateModule</span>
</span><span class='line'>      <span class="k">extends</span> <span class="nc">StateModule</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">type</span> <span class="kt">S</span> <span class="o">=</span> <span class="nc">Machine</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">override</span> <span class="k">val</span> <span class="n">ssm</span><span class="k">:</span> <span class="kt">MachineStateModule.</span><span class="k">type</span> <span class="o">=</span> <span class="nc">MachineStateModule</span>
</span><span class='line'>    <span class="k">import</span> <span class="nn">ssm._</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">import</span> <span class="nn">Status.</span><span class="o">{</span> <span class="nc">FREE</span><span class="o">,</span> <span class="nc">BUSY</span> <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">override</span> <span class="k">val</span> <span class="n">initialMachine</span> <span class="k">=</span> <span class="nc">Machine</span><span class="o">(</span><span class="nc">FREE</span><span class="o">,</span> <span class="mi">20</span><span class="o">,</span> <span class="mi">0</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">import</span> <span class="nn">Action.</span><span class="o">{</span> <span class="nc">COIN_IN</span><span class="o">,</span> <span class="nc">CANDY_OUT</span> <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">import</span> <span class="nn">tpm.one</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">override</span> <span class="k">val</span> <span class="n">actions</span><span class="k">:</span> <span class="kt">tpm.D</span><span class="o">[</span><span class="kt">Action.Value</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>      <span class="n">one</span><span class="o">(</span><span class="nc">COIN_IN</span><span class="o">)</span> <span class="n">or</span> <span class="n">one</span><span class="o">(</span><span class="nc">CANDY_OUT</span><span class="o">)</span> <span class="n">or</span> <span class="n">one</span><span class="o">(</span><span class="nc">COIN_IN</span><span class="o">)</span> <span class="n">or</span> <span class="n">one</span><span class="o">(</span><span class="nc">CANDY_OUT</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">override</span> <span class="k">val</span> <span class="n">reducer</span><span class="k">:</span> <span class="kt">tpm.Reducer</span><span class="o">[</span><span class="kt">Unit</span>, <span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>      <span class="o">({</span> <span class="k">case</span> <span class="k">_</span> <span class="k">=&gt;</span> <span class="o">()</span> <span class="o">},</span> <span class="o">{</span> <span class="k">case</span> <span class="o">(</span><span class="k">_</span><span class="o">,</span> <span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">()</span> <span class="o">})</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>and use it as follows</p>

<figure class='code'><figcaption><span>StateUsageInApp  (StateUsageInApp.scala)</span> <a href='http://www.strongtyped.io/downloads/code/StateUsageInApp.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>    <span class="o">{</span>
</span><span class='line'>      <span class="k">import</span> <span class="nn">Usage.StateUsage._</span>
</span><span class='line'>      <span class="n">stateful_source_usage</span><span class="o">()</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Running the example above would then result in something along the following lines</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="nc">Machine</span><span class="o">(</span><span class="nc">FREE</span><span class="o">,</span><span class="mi">18</span><span class="o">,</span><span class="mi">2</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Asynchronous data</h2>

<p><em>Asynchronous data</em> are formalized by the <code>trait</code> below</p>

<figure class='code'><figcaption><span>Asynchronous  (Asynchronous.scala)</span> <a href='http://www.strongtyped.io/downloads/code/Asynchronous.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">trait</span> <span class="nc">AsynchronousModule</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">&lt;:</span> <span class="nc">Asynchronous</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">async</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span><span class="k">:</span> <span class="o">(</span><span class="kt">Unit</span> <span class="o">=&gt;</span> <span class="kt">Z</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="k">trait</span> <span class="nc">Asynchronous</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>trait AsynchronousModule</code></p>

<ul>
<li>declares the function <code>async</code>

<ul>
<li>given <code>u2z</code>, <code>async(u2z)</code> should produce <code>u2z(())</code> <em>asynchronously</em></li>
</ul>
</li>
</ul>


<h2>Asynchronous data source</h2>

<p><em>Asynchronous datasources</em> are declared by the <code>trait</code> below</p>

<figure class='code'><figcaption><span>AsynchronousSource  (AsynchronousSource.scala)</span> <a href='http://www.strongtyped.io/downloads/code/AsynchronousSource.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">trait</span> <span class="nc">AsynchronousSourceModule</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">SourceModule</span>
</span><span class='line'>    <span class="k">with</span> <span class="nc">AsynchronousModule</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">&lt;:</span> <span class="nc">AsynchronousSource</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="k">trait</span> <span class="nc">AsynchronousSource</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="nc">extends</span> <span class="nc">Source</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="k">with</span> <span class="nc">Asynchronous</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span> <span class="n">da</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=&gt;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Asynchronous datasource usage</h2>

<p>The code below defines some examples that make use of the asynchronous datasource DSL</p>

<figure class='code'><figcaption><span>AsynchronousSourceUsage  (AsynchronousSourceUsage.scala)</span> <a href='http://www.strongtyped.io/downloads/code/AsynchronousSourceUsage.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">trait</span> <span class="nc">AsynchronousSourceUsage</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">import</span> <span class="nn">Lib.TraversablePolynomialModule</span>
</span><span class='line'>    <span class="k">import</span> <span class="nn">Lib.AsynchronousSourceModule</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">tpm</span><span class="k">:</span> <span class="kt">TraversablePolynomialModule</span>
</span><span class='line'>    <span class="k">import</span> <span class="nn">tpm.one</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">asm</span><span class="k">:</span> <span class="kt">AsynchronousSourceModule</span>
</span><span class='line'>    <span class="k">import</span> <span class="nn">asm.async</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">import</span> <span class="nn">java.lang.Thread.sleep</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="n">sleepVerbose</span><span class="o">(</span><span class="n">i</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=&gt;</span> <span class="nc">Int</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">_</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="o">(</span><span class="mi">1</span> <span class="n">to</span> <span class="mi">10</span><span class="o">).</span><span class="n">toList</span><span class="o">.</span><span class="n">foreach</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">x</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="n">sleep</span><span class="o">(</span><span class="mi">500</span><span class="o">)</span>
</span><span class='line'>            <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">10</span><span class="o">)</span> <span class="n">print</span><span class="o">(</span><span class="n">s</span><span class="s">&quot;\n${i} finished\n&quot;</span><span class="o">)</span>
</span><span class='line'>            <span class="k">else</span> <span class="n">print</span><span class="o">(</span><span class="n">s</span><span class="s">&quot;${i} &quot;</span><span class="o">)</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="n">i</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">import</span> <span class="nn">math._</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="n">randomSleep</span><span class="o">(</span><span class="n">timeOut</span><span class="k">:</span> <span class="kt">TimeOut</span><span class="o">)</span> <span class="k">=</span>
</span><span class='line'>      <span class="n">sleep</span><span class="o">(</span><span class="n">round</span><span class="o">(</span><span class="n">timeOut</span> <span class="o">*</span> <span class="n">random</span><span class="o">))</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="n">randomSleepVerbose</span><span class="o">(</span><span class="n">i</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=&gt;</span> <span class="nc">Int</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">_</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="o">(</span><span class="mi">1</span> <span class="n">to</span> <span class="mi">10</span><span class="o">).</span><span class="n">toList</span><span class="o">.</span><span class="n">foreach</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">x</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="n">randomSleep</span><span class="o">(</span><span class="mi">500</span><span class="o">)</span>
</span><span class='line'>            <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">10</span><span class="o">)</span> <span class="n">print</span><span class="o">(</span><span class="n">s</span><span class="s">&quot;\n${i} finished\n&quot;</span><span class="o">)</span>
</span><span class='line'>            <span class="k">else</span> <span class="n">print</span><span class="o">(</span><span class="n">s</span><span class="s">&quot;${i} &quot;</span><span class="o">)</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="n">i</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">manySleepVerbose</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="n">tpm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">Unit</span> <span class="k">=&gt;</span> <span class="kt">Int</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>      <span class="n">n</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">one</span><span class="o">(</span><span class="n">sleepVerbose</span><span class="o">(</span><span class="n">n</span><span class="o">))</span> <span class="n">or</span> <span class="n">manySleepVerbose</span><span class="o">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">manyRandomSleepVerbose</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="n">tpm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">Unit</span> <span class="k">=&gt;</span> <span class="kt">Int</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>      <span class="n">n</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">one</span><span class="o">(</span><span class="n">randomSleepVerbose</span><span class="o">(</span><span class="n">n</span><span class="o">))</span> <span class="n">or</span> <span class="n">manyRandomSleepVerbose</span><span class="o">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">in</span><span class="k">:</span> <span class="kt">asm.In</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">tp_as01</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="n">tpm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">asm.D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]]</span> <span class="k">=</span>
</span><span class='line'>      <span class="n">manySleepVerbose</span><span class="o">(</span><span class="k">_</span><span class="o">)</span> <span class="n">end</span> <span class="n">async</span> <span class="n">take</span> <span class="o">(</span><span class="mi">8</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">as_tp01</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="n">asm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">tpm.D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]]</span> <span class="k">=</span>
</span><span class='line'>      <span class="n">tp_as01</span> <span class="n">andThen</span> <span class="n">tpm</span><span class="o">.</span><span class="n">swap</span><span class="o">(</span><span class="n">asm</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">tp_as02</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="n">tpm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">asm.D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]]</span> <span class="k">=</span>
</span><span class='line'>      <span class="n">manyRandomSleepVerbose</span><span class="o">(</span><span class="k">_</span><span class="o">)</span> <span class="n">end</span> <span class="n">async</span> <span class="n">take</span> <span class="o">(</span><span class="mi">8</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">lazy</span> <span class="k">val</span> <span class="n">as_tp02</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="n">asm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">tpm.D</span><span class="o">[</span><span class="kt">Int</span><span class="o">]]</span> <span class="k">=</span>
</span><span class='line'>      <span class="n">tp_as02</span> <span class="n">andThen</span> <span class="n">tpm</span><span class="o">.</span><span class="n">swap</span><span class="o">(</span><span class="n">asm</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="n">asynchronous_source_usage</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">as_tp01</span><span class="o">(</span><span class="mi">1</span><span class="o">).</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">as_tp02</span><span class="o">(</span><span class="mi">1</span><span class="o">).</span><span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The simplest asynchronous <code>Runnable</code> implementation is the following</p>

<figure class='code'><figcaption><span>AsynchronousRunnableModule  (AsynchronousRunnableModule.scala)</span> <a href='http://www.strongtyped.io/downloads/code/AsynchronousRunnableModule.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">trait</span> <span class="nc">AsynchronousRunnableModule</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">RunnableModule</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">&lt;:</span> <span class="nc">AsynchronousRunnable</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">In</span> <span class="o">=</span> <span class="nc">ExecutorService</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">Out</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span> <span class="n">Z</span>
</span><span class='line'>    <span class="k">trait</span> <span class="nc">AsynchronousRunnable</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="nc">extends</span> <span class="nc">Runnable</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span> <span class="n">da</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=&gt;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The simplest <code>AsynchronousSourceModule</code> instance one can think of is one along the following lines</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">object</span> <span class="nc">AsyncModule</span> <span class="o">{</span>
</span><span class='line'>  <span class="c1">// ...</span>
</span><span class='line'>  <span class="k">case</span> <span class="k">class</span> <span class="nc">Async</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">es_2_sfa</span><span class="k">:</span> <span class="kt">ExecutorService</span> <span class="o">=&gt;</span> <span class="nc">SimpleFuture</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span> <span class="o">{</span>
</span><span class='line'>  <span class="c1">// ...</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Think of <code>Async[Z]</code> as a data source that, making use of an <em>executor service</em>, produces one value <em>asynchronously</em>.</p>

<p>Given a <code>Async[Z]</code> instance it is possible to a define</p>

<figure class='code'><figcaption><span>AsyncUsage  (AsyncUsage.scala)</span> <a href='http://www.strongtyped.io/downloads/code/AsyncUsage.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">object</span> <span class="nc">AsyncUsage</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">AsynchronousSourceUsage</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">import</span> <span class="nn">Instances.ZeroOrMoreModule</span>
</span><span class='line'>    <span class="k">import</span> <span class="nn">Instances.AsyncModule</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">override</span> <span class="k">val</span> <span class="n">tpm</span><span class="k">:</span> <span class="kt">ZeroOrMoreModule.</span><span class="k">type</span> <span class="o">=</span> <span class="nc">ZeroOrMoreModule</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">val</span> <span class="n">asm</span><span class="k">:</span> <span class="kt">AsyncModule.</span><span class="k">type</span> <span class="o">=</span> <span class="nc">AsyncModule</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">import</span> <span class="nn">java.util.concurrent.ExecutorService</span>
</span><span class='line'>    <span class="k">import</span> <span class="nn">java.util.concurrent.Executors</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">override</span> <span class="k">val</span> <span class="n">in</span><span class="k">:</span> <span class="kt">ExecutorService</span> <span class="o">=</span>
</span><span class='line'>      <span class="nc">Executors</span><span class="o">.</span><span class="n">newScheduledThreadPool</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">override</span> <span class="k">def</span> <span class="n">asynchronous_source_usage</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">super</span><span class="o">.</span><span class="n">asynchronous_source_usage</span>
</span><span class='line'>      <span class="n">in</span><span class="o">.</span><span class="n">shutdown</span><span class="o">()</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>and use it as follows</p>

<figure class='code'><figcaption><span>AsyncUsageInApp  (AsyncUsageInApp.scala)</span> <a href='http://www.strongtyped.io/downloads/code/AsyncUsageInApp.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>    <span class="o">{</span>
</span><span class='line'>      <span class="k">import</span> <span class="nn">Usage.AsyncUsage._</span>
</span><span class='line'>      <span class="n">asynchronous_source_usage</span><span class="o">()</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Running the example above would then result in something along the following lines</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">6</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">2</span> <span class="mi">6</span> <span class="mi">1</span> <span class="mi">4</span> <span class="mi">8</span> <span class="mi">7</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mi">6</span> <span class="mi">4</span> <span class="mi">8</span> <span class="mi">7</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">2</span> <span class="mi">6</span> <span class="mi">8</span> <span class="mi">7</span> <span class="mi">1</span> <span class="mi">4</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">2</span> <span class="mi">6</span> <span class="mi">8</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">7</span> <span class="mi">1</span> <span class="mi">5</span> <span class="mi">2</span> <span class="mi">6</span> <span class="mi">3</span> <span class="mi">8</span> <span class="mi">7</span> <span class="mi">1</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">2</span> <span class="mi">8</span> <span class="mi">3</span> <span class="mi">6</span> <span class="mi">5</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">7</span> <span class="mi">2</span> <span class="mi">8</span> <span class="mi">3</span> <span class="mi">6</span> <span class="mi">1</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">4</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">8</span> <span class="mi">6</span> <span class="mi">1</span> <span class="mi">5</span> <span class="mi">4</span> <span class="mi">7</span>
</span><span class='line'><span class="mi">3</span> <span class="n">finished</span>
</span><span class='line'>
</span><span class='line'><span class="mi">6</span> <span class="n">finished</span>
</span><span class='line'>
</span><span class='line'><span class="mi">8</span> <span class="n">finished</span>
</span><span class='line'>
</span><span class='line'><span class="mi">2</span> <span class="n">finished</span>
</span><span class='line'>
</span><span class='line'><span class="mi">1</span> <span class="n">finished</span>
</span><span class='line'>
</span><span class='line'><span class="mi">7</span> <span class="n">finished</span>
</span><span class='line'>
</span><span class='line'><span class="mi">5</span> <span class="n">finished</span>
</span><span class='line'>
</span><span class='line'><span class="mi">4</span> <span class="n">finished</span>
</span><span class='line'><span class="o">[</span> <span class="err">1</span> <span class="err">2</span> <span class="err">3</span> <span class="err">4</span> <span class="err">5</span> <span class="err">6</span> <span class="err">7</span> <span class="err">8</span> <span class="o">]</span>
</span><span class='line'><span class="mi">7</span> <span class="mi">6</span> <span class="mi">6</span> <span class="mi">2</span> <span class="mi">4</span> <span class="mi">8</span> <span class="mi">3</span> <span class="mi">7</span> <span class="mi">1</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">1</span> <span class="mi">8</span> <span class="mi">3</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">8</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">6</span> <span class="mi">5</span> <span class="mi">1</span> <span class="mi">7</span> <span class="mi">4</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">1</span> <span class="mi">6</span> <span class="mi">3</span> <span class="mi">8</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">6</span> <span class="mi">4</span> <span class="mi">3</span> <span class="mi">7</span> <span class="mi">3</span> <span class="mi">6</span> <span class="mi">3</span> <span class="mi">8</span> <span class="mi">8</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">6</span> <span class="mi">5</span> <span class="mi">3</span>
</span><span class='line'><span class="mi">6</span> <span class="n">finished</span>
</span><span class='line'><span class="mi">7</span> <span class="mi">8</span> <span class="mi">8</span> <span class="mi">5</span> <span class="mi">4</span> <span class="mi">3</span> <span class="mi">1</span> <span class="mi">2</span>
</span><span class='line'><span class="mi">3</span> <span class="n">finished</span>
</span><span class='line'><span class="mi">5</span> <span class="mi">7</span> <span class="mi">2</span> <span class="mi">8</span>
</span><span class='line'><span class="mi">8</span> <span class="n">finished</span>
</span><span class='line'><span class="mi">4</span> <span class="mi">1</span> <span class="mi">5</span> <span class="mi">7</span>
</span><span class='line'><span class="mi">2</span> <span class="n">finished</span>
</span><span class='line'><span class="mi">5</span> <span class="mi">4</span>
</span><span class='line'><span class="mi">1</span> <span class="n">finished</span>
</span><span class='line'>
</span><span class='line'><span class="mi">7</span> <span class="n">finished</span>
</span><span class='line'><span class="mi">5</span> <span class="mi">4</span>
</span><span class='line'><span class="mi">4</span> <span class="n">finished</span>
</span><span class='line'>
</span><span class='line'><span class="mi">5</span> <span class="n">finished</span>
</span><span class='line'><span class="o">[</span> <span class="err">1</span> <span class="err">2</span> <span class="err">3</span> <span class="err">4</span> <span class="err">5</span> <span class="err">6</span> <span class="err">7</span> <span class="err">8</span> <span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>If, as suggested in the code of the actual implementation (not given yet), you comment out the <em>overriding definition</em> of <code>and</code> and make use of the <em>default definition</em> instead, then this results in something along the following lines</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span>
</span><span class='line'><span class="mi">1</span> <span class="n">finished</span>
</span><span class='line'><span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span>
</span><span class='line'><span class="mi">2</span> <span class="n">finished</span>
</span><span class='line'><span class="mi">3</span> <span class="mi">3</span> <span class="mi">3</span> <span class="mi">3</span> <span class="mi">3</span> <span class="mi">3</span> <span class="mi">3</span> <span class="mi">3</span> <span class="mi">3</span>
</span><span class='line'><span class="mi">3</span> <span class="n">finished</span>
</span><span class='line'><span class="mi">4</span> <span class="mi">4</span> <span class="mi">4</span> <span class="mi">4</span> <span class="mi">4</span> <span class="mi">4</span> <span class="mi">4</span> <span class="mi">4</span> <span class="mi">4</span>
</span><span class='line'><span class="mi">4</span> <span class="n">finished</span>
</span><span class='line'><span class="mi">5</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">5</span>
</span><span class='line'><span class="mi">5</span> <span class="n">finished</span>
</span><span class='line'><span class="mi">6</span> <span class="mi">6</span> <span class="mi">6</span> <span class="mi">6</span> <span class="mi">6</span> <span class="mi">6</span> <span class="mi">6</span> <span class="mi">6</span> <span class="mi">6</span>
</span><span class='line'><span class="mi">6</span> <span class="n">finished</span>
</span><span class='line'><span class="mi">7</span> <span class="mi">7</span> <span class="mi">7</span> <span class="mi">7</span> <span class="mi">7</span> <span class="mi">7</span> <span class="mi">7</span> <span class="mi">7</span> <span class="mi">7</span>
</span><span class='line'><span class="mi">7</span> <span class="n">finished</span>
</span><span class='line'><span class="mi">8</span> <span class="mi">8</span> <span class="mi">8</span> <span class="mi">8</span> <span class="mi">8</span> <span class="mi">8</span> <span class="mi">8</span> <span class="mi">8</span> <span class="mi">8</span>
</span><span class='line'><span class="mi">8</span> <span class="n">finished</span>
</span><span class='line'><span class="o">[</span> <span class="err">1</span> <span class="err">2</span> <span class="err">3</span> <span class="err">4</span> <span class="err">5</span> <span class="err">6</span> <span class="err">7</span> <span class="err">8</span> <span class="o">]</span>
</span><span class='line'><span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span>
</span><span class='line'><span class="mi">1</span> <span class="n">finished</span>
</span><span class='line'><span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span>
</span><span class='line'><span class="mi">2</span> <span class="n">finished</span>
</span><span class='line'><span class="mi">3</span> <span class="mi">3</span> <span class="mi">3</span> <span class="mi">3</span> <span class="mi">3</span> <span class="mi">3</span> <span class="mi">3</span> <span class="mi">3</span> <span class="mi">3</span>
</span><span class='line'><span class="mi">3</span> <span class="n">finished</span>
</span><span class='line'><span class="mi">4</span> <span class="mi">4</span> <span class="mi">4</span> <span class="mi">4</span> <span class="mi">4</span> <span class="mi">4</span> <span class="mi">4</span> <span class="mi">4</span> <span class="mi">4</span>
</span><span class='line'><span class="mi">4</span> <span class="n">finished</span>
</span><span class='line'><span class="mi">5</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">5</span>
</span><span class='line'><span class="mi">5</span> <span class="n">finished</span>
</span><span class='line'><span class="mi">6</span> <span class="mi">6</span> <span class="mi">6</span> <span class="mi">6</span> <span class="mi">6</span> <span class="mi">6</span> <span class="mi">6</span> <span class="mi">6</span> <span class="mi">6</span>
</span><span class='line'><span class="mi">6</span> <span class="n">finished</span>
</span><span class='line'><span class="mi">7</span> <span class="mi">7</span> <span class="mi">7</span> <span class="mi">7</span> <span class="mi">7</span> <span class="mi">7</span> <span class="mi">7</span> <span class="mi">7</span> <span class="mi">7</span>
</span><span class='line'><span class="mi">7</span> <span class="n">finished</span>
</span><span class='line'><span class="mi">8</span> <span class="mi">8</span> <span class="mi">8</span> <span class="mi">8</span> <span class="mi">8</span> <span class="mi">8</span> <span class="mi">8</span> <span class="mi">8</span> <span class="mi">8</span>
</span><span class='line'><span class="mi">8</span> <span class="n">finished</span>
</span><span class='line'><span class="o">[</span> <span class="err">1</span> <span class="err">2</span> <span class="err">3</span> <span class="err">4</span> <span class="err">5</span> <span class="err">6</span> <span class="err">7</span> <span class="err">8</span> <span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p><em>What is the moral of this story:</em></p>

<ul>
<li><code>and</code>, being more abstract than <code>bnd</code>, has more implementation flexibility</li>
</ul>


<p>The default <em>sequential</em> implementation can (but does not have to) be overridden by a <em>concurrent</em> implementation.</p>

<h2>Implementations</h2>

<p>We still did not fully define any concrete instances yet.</p>

<h2>OneModule</h2>

<p><code>OneModule</code> is a <code>TraversableSourceModule</code></p>

<figure class='code'><figcaption><span>OneModule  (OneModule.scala)</span> <a href='http://www.strongtyped.io/downloads/code/OneModule.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">object</span> <span class="nc">OneModule</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">TraversableSourceModule</span>
</span><span class='line'>    <span class="k">with</span> <span class="nc">TrivialRunnableModule</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span> <span class="nc">One</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">def</span> <span class="n">one</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>      <span class="n">z</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="nc">One</span><span class="o">(</span><span class="n">z</span><span class="o">)</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">Reducer</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">R</span><span class="o">]</span> <span class="k">=</span> <span class="n">Z</span> <span class="k">=&gt;</span> <span class="n">R</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">identityReducer</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span><span class="k">:</span> <span class="kt">Reducer</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]]</span> <span class="k">=</span>
</span><span class='line'>      <span class="n">one</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">def</span> <span class="n">lift</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">Y</span>, <span class="kt">R</span><span class="o">](</span><span class="n">mm</span><span class="k">:</span> <span class="kt">MM</span><span class="o">)(</span><span class="n">z2mmdy</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=&gt;</span> <span class="n">mm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">Y</span><span class="o">])</span><span class="k">:</span> <span class="kt">Reducer</span><span class="o">[</span><span class="kt">Y</span>, <span class="kt">R</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="nc">Reducer</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">mm.D</span><span class="o">[</span><span class="kt">R</span><span class="o">]]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="n">y2r</span> <span class="k">=&gt;</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">z2mmdr</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=&gt;</span> <span class="n">mm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">R</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">case</span> <span class="n">z</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="n">z2mmdy</span><span class="o">(</span><span class="n">z</span><span class="o">)</span> <span class="n">end</span> <span class="o">{</span>
</span><span class='line'>              <span class="n">y</span> <span class="k">=&gt;</span>
</span><span class='line'>                <span class="n">y2r</span><span class="o">(</span><span class="n">y</span><span class="o">)</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="n">z2mmdr</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">case</span> <span class="k">class</span> <span class="nc">One</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">a</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span>
</span><span class='line'>      <span class="k">extends</span> <span class="nc">TraversableSource</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="k">with</span> <span class="nc">TrivialRunnable</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span> <span class="n">da</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="k">override</span> <span class="k">def</span> <span class="n">reducedBy</span><span class="o">[</span><span class="kt">R</span><span class="o">](</span><span class="n">a_r2_r</span><span class="k">:</span> <span class="kt">Reducer</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">R</span><span class="o">])</span><span class="k">:</span> <span class="kt">R</span> <span class="o">=</span> <span class="n">da</span> <span class="k">match</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">case</span> <span class="nc">One</span><span class="o">(</span><span class="n">a</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>          <span class="n">a_r2_r</span> <span class="k">match</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">case</span> <span class="n">a2r</span> <span class="k">=&gt;</span>
</span><span class='line'>              <span class="n">a2r</span><span class="o">(</span><span class="n">a</span><span class="o">)</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>      <span class="k">override</span> <span class="k">def</span> <span class="n">bnd</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">a2db</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>        <span class="n">da</span> <span class="n">reducedBy</span> <span class="n">a2db</span>
</span><span class='line'>      <span class="k">override</span> <span class="k">def</span> <span class="n">toString</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">a2s</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="nc">String</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">case</span> <span class="n">a</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="n">s</span><span class="s">&quot; ${a}&quot;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="n">s</span><span class="s">&quot;{${da reducedBy a2s} }&quot;</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>ZeroOrOneModule</h2>

<p><code>ZeroOrOneModule</code> is a <code>TraversablePolynomialSourceModule</code></p>

<figure class='code'><figcaption><span>ZeroOrOneModule  (ZeroOrOneModule.scala)</span> <a href='http://www.strongtyped.io/downloads/code/ZeroOrOneModule.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">object</span> <span class="nc">ZeroOrOneModule</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">TraversablePolynomialSourceModule</span>
</span><span class='line'>    <span class="k">with</span> <span class="nc">TrivialRunnableModule</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span> <span class="nc">ZeroOrOne</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">def</span> <span class="n">zero</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>      <span class="k">_</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="nc">Zero</span><span class="o">()</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">def</span> <span class="n">one</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>      <span class="n">z</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="nc">One</span><span class="o">(</span><span class="n">z</span><span class="o">)</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">Reducer</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">R</span><span class="o">]</span> <span class="k">=</span> <span class="o">(</span><span class="nc">Unit</span> <span class="k">=&gt;</span> <span class="n">R</span><span class="o">)</span> <span class="o">**</span> <span class="o">(</span><span class="n">Z</span> <span class="k">=&gt;</span> <span class="n">R</span><span class="o">)</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">identityReducer</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span><span class="k">:</span> <span class="kt">Reducer</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]]</span> <span class="k">=</span>
</span><span class='line'>      <span class="o">(</span><span class="n">zero</span><span class="o">,</span> <span class="n">one</span><span class="o">)</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">def</span> <span class="n">lift</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">Y</span>, <span class="kt">R</span><span class="o">](</span><span class="n">mm</span><span class="k">:</span> <span class="kt">MM</span><span class="o">)(</span><span class="n">z2mmdy</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=&gt;</span> <span class="n">mm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">Y</span><span class="o">])</span><span class="k">:</span> <span class="kt">Reducer</span><span class="o">[</span><span class="kt">Y</span>, <span class="kt">R</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="nc">Reducer</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">mm.D</span><span class="o">[</span><span class="kt">R</span><span class="o">]]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="o">(</span><span class="n">u2r</span><span class="o">,</span> <span class="n">y2r</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">u2mmdr</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=&gt;</span> <span class="n">mm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">R</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">case</span> <span class="o">()</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="n">mm</span><span class="o">.</span><span class="n">one</span><span class="o">(</span><span class="n">u2r</span><span class="o">(()))</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">z2mmdr</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=&gt;</span> <span class="n">mm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">R</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">case</span> <span class="n">z</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="n">z2mmdy</span><span class="o">(</span><span class="n">z</span><span class="o">)</span> <span class="n">end</span> <span class="o">{</span>
</span><span class='line'>              <span class="n">y</span> <span class="k">=&gt;</span>
</span><span class='line'>                <span class="n">y2r</span><span class="o">(</span><span class="n">y</span><span class="o">)</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="o">(</span><span class="n">u2mmdr</span><span class="o">,</span> <span class="n">z2mmdr</span><span class="o">)</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">sealed</span> <span class="k">trait</span> <span class="nc">ZeroOrOne</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="nc">extends</span> <span class="nc">TraversablePolynomialSource</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="k">with</span> <span class="nc">TrivialRunnable</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span> <span class="n">da</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="k">override</span> <span class="k">def</span> <span class="n">take</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>        <span class="n">da</span>
</span><span class='line'>      <span class="k">override</span> <span class="k">def</span> <span class="n">reducedBy</span><span class="o">[</span><span class="kt">R</span><span class="o">](</span><span class="n">a_r2_r</span><span class="k">:</span> <span class="kt">Reducer</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">R</span><span class="o">])</span><span class="k">:</span> <span class="kt">R</span> <span class="o">=</span> <span class="n">da</span> <span class="k">match</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">case</span> <span class="nc">Zero</span><span class="o">()</span> <span class="k">=&gt;</span>
</span><span class='line'>          <span class="n">a_r2_r</span> <span class="k">match</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">case</span> <span class="o">(</span><span class="n">u2r</span><span class="o">,</span> <span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>              <span class="n">u2r</span><span class="o">(())</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>        <span class="k">case</span> <span class="nc">One</span><span class="o">(</span><span class="n">a</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>          <span class="n">a_r2_r</span> <span class="k">match</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">case</span> <span class="o">(</span><span class="k">_</span><span class="o">,</span> <span class="n">a2r</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>              <span class="n">a2r</span><span class="o">(</span><span class="n">a</span><span class="o">)</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>      <span class="k">override</span> <span class="k">def</span> <span class="n">bnd</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">a2db</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>        <span class="n">da</span> <span class="n">reducedBy</span> <span class="o">(</span><span class="n">zero</span><span class="o">[</span><span class="kt">B</span><span class="o">],</span> <span class="n">a2db</span><span class="o">)</span>
</span><span class='line'>      <span class="k">override</span> <span class="k">def</span> <span class="n">or</span><span class="o">(</span><span class="n">da1</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">u2da</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">case</span> <span class="o">()</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="n">da1</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">a2da</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">case</span> <span class="n">a</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="n">one</span><span class="o">(</span><span class="n">a</span><span class="o">)</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="n">da</span> <span class="n">reducedBy</span> <span class="o">(</span><span class="n">u2da</span><span class="o">,</span> <span class="n">a2da</span><span class="o">)</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>      <span class="k">override</span> <span class="k">def</span> <span class="n">toString</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">u2s</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=&gt;</span> <span class="nc">String</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">case</span> <span class="o">()</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="s">&quot;&quot;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">a2s</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="nc">String</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">case</span> <span class="n">a</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="n">s</span><span class="s">&quot; ${a}&quot;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="n">s</span><span class="s">&quot;{${da reducedBy (u2s, a2s)} }&quot;</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Zero</span><span class="o">[</span><span class="kt">A</span><span class="o">]()</span> <span class="k">extends</span> <span class="nc">ZeroOrOne</span><span class="o">[</span><span class="kt">A</span><span class="o">]()</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">One</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">a</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">ZeroOrOne</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>ZeroOrMoreModule</h2>

<p><code>ZeroOrMoreModule</code> is a <code>TraversablePolynomialSourceModule</code></p>

<figure class='code'><figcaption><span>ZeroOrMoreModule  (ZeroOrMoreModule.scala)</span> <a href='http://www.strongtyped.io/downloads/code/ZeroOrMoreModule.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">object</span> <span class="nc">ZeroOrMoreModule</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">TraversablePolynomialSourceModule</span>
</span><span class='line'>    <span class="k">with</span> <span class="nc">TrivialRunnableModule</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span> <span class="nc">ZeroOrMore</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">def</span> <span class="n">zero</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>      <span class="k">_</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="nc">Zero</span><span class="o">()</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">def</span> <span class="n">one</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>      <span class="n">z</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="nc">More</span><span class="o">((</span><span class="n">z</span><span class="o">,</span> <span class="n">zero</span><span class="o">))</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">def</span> <span class="n">more</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span><span class="k">:</span> <span class="o">(</span><span class="kt">Z</span> <span class="kt">**</span> <span class="o">(</span><span class="kt">Unit</span> <span class="o">=&gt;</span> <span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]))</span> <span class="k">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="n">z_n_u2dz</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="nc">More</span><span class="o">[</span><span class="kt">Z</span><span class="o">](</span><span class="n">z_n_u2dz</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">Reducer</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">R</span><span class="o">]</span> <span class="k">=</span> <span class="o">(</span><span class="nc">Unit</span> <span class="k">=&gt;</span> <span class="n">R</span><span class="o">)</span> <span class="o">**</span> <span class="o">((</span><span class="n">Z</span> <span class="o">**</span> <span class="o">(</span><span class="nc">Unit</span> <span class="k">=&gt;</span> <span class="n">R</span><span class="o">))</span> <span class="k">=&gt;</span> <span class="n">R</span><span class="o">)</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">identityReducer</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span><span class="k">:</span> <span class="kt">Reducer</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="o">(</span><span class="n">zero</span><span class="o">,</span> <span class="n">more</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">def</span> <span class="n">lift</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">Y</span>, <span class="kt">R</span><span class="o">](</span><span class="n">mm</span><span class="k">:</span> <span class="kt">MM</span><span class="o">)(</span><span class="n">z2mmdy</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=&gt;</span> <span class="n">mm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">Y</span><span class="o">])</span><span class="k">:</span> <span class="kt">Reducer</span><span class="o">[</span><span class="kt">Y</span>, <span class="kt">R</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="nc">Reducer</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">mm.D</span><span class="o">[</span><span class="kt">R</span><span class="o">]]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="o">(</span><span class="n">u2r</span><span class="o">,</span> <span class="n">y_n_u2r__2__r</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">u2mmdr</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=&gt;</span> <span class="n">mm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">R</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">case</span> <span class="o">()</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="n">mm</span><span class="o">.</span><span class="n">one</span><span class="o">(</span><span class="n">u2r</span><span class="o">(()))</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">z_n_u2mmdr__2__mmdr</span><span class="k">:</span> <span class="o">(</span><span class="kt">Z</span> <span class="kt">**</span> <span class="o">(</span><span class="kt">Unit</span> <span class="o">=&gt;</span> <span class="kt">mm.D</span><span class="o">[</span><span class="kt">R</span><span class="o">]))</span> <span class="k">=&gt;</span> <span class="n">mm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">R</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">case</span> <span class="o">(</span><span class="n">z</span><span class="o">,</span> <span class="n">u2mmdr</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="n">z2mmdy</span><span class="o">(</span><span class="n">z</span><span class="o">)</span> <span class="n">and</span> <span class="o">(</span>
</span><span class='line'>              <span class="n">u2mmdr</span><span class="o">(())</span> <span class="n">end</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">r</span> <span class="k">=&gt;</span>
</span><span class='line'>                  <span class="n">y</span> <span class="k">=&gt;</span>
</span><span class='line'>                    <span class="n">y_n_u2r__2__r</span><span class="o">((</span><span class="n">y</span><span class="o">,</span> <span class="o">{</span> <span class="k">case</span> <span class="o">()</span> <span class="k">=&gt;</span> <span class="n">r</span> <span class="o">}))</span>
</span><span class='line'>              <span class="o">})</span>
</span><span class='line'>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="o">(</span><span class="n">u2mmdr</span><span class="o">,</span> <span class="n">z_n_u2mmdr__2__mmdr</span><span class="o">)</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">sealed</span> <span class="k">trait</span> <span class="nc">ZeroOrMore</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="nc">extends</span> <span class="nc">TraversablePolynomialSource</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="k">with</span> <span class="nc">TrivialRunnable</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span> <span class="n">da</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="k">override</span> <span class="k">def</span> <span class="n">take</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>        <span class="n">da</span> <span class="k">match</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">case</span> <span class="nc">Zero</span><span class="o">()</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="n">zero</span><span class="o">(())</span>
</span><span class='line'>          <span class="k">case</span> <span class="nc">More</span><span class="o">((</span><span class="n">a</span><span class="o">,</span> <span class="n">u2da</span><span class="o">))</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="k">if</span> <span class="o">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span>
</span><span class='line'>              <span class="n">more</span><span class="o">((</span><span class="n">a</span><span class="o">,</span> <span class="o">{</span> <span class="k">case</span> <span class="o">()</span> <span class="k">=&gt;</span> <span class="n">u2da</span><span class="o">(()).</span><span class="n">take</span><span class="o">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span> <span class="o">}))</span>
</span><span class='line'>            <span class="k">else</span>
</span><span class='line'>              <span class="n">zero</span><span class="o">(())</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>      <span class="k">override</span> <span class="k">def</span> <span class="n">bnd</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">a2db</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">a_n_u2db__2__db</span><span class="k">:</span> <span class="o">(</span><span class="kt">A</span> <span class="kt">**</span> <span class="o">(</span><span class="kt">Unit</span> <span class="o">=&gt;</span> <span class="kt">D</span><span class="o">[</span><span class="kt">B</span><span class="o">]))</span> <span class="k">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">case</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">u2db</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="n">a2db</span><span class="o">(</span><span class="n">a</span><span class="o">)</span> <span class="n">or</span> <span class="n">u2db</span><span class="o">(())</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="n">da</span> <span class="n">reducedBy</span> <span class="o">((</span><span class="n">zero</span><span class="o">[</span><span class="kt">B</span><span class="o">],</span> <span class="n">a_n_u2db__2__db</span><span class="o">))</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>      <span class="k">override</span> <span class="k">def</span> <span class="n">or</span><span class="o">(</span><span class="n">da1</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">u2da</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">case</span> <span class="o">()</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="n">da1</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="n">da</span> <span class="n">reducedBy</span> <span class="o">(</span><span class="n">u2da</span><span class="o">,</span> <span class="n">more</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>      <span class="k">override</span> <span class="k">def</span> <span class="n">toString</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">u2s</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=&gt;</span> <span class="nc">String</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">case</span> <span class="o">()</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="s">&quot;&quot;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">a_n_u2s__2__s</span><span class="k">:</span> <span class="o">(</span><span class="kt">A</span> <span class="kt">**</span> <span class="o">(</span><span class="kt">Unit</span> <span class="o">=&gt;</span> <span class="kt">String</span><span class="o">))</span> <span class="k">=&gt;</span> <span class="nc">String</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">case</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">s</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="n">s</span><span class="s">&quot; ${a}${s(())}&quot;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="n">s</span><span class="s">&quot;[${da reducedBy (u2s, a_n_u2s__2__s)} ]&quot;</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>      <span class="k">override</span> <span class="k">def</span> <span class="n">reducedBy</span><span class="o">[</span><span class="kt">R</span><span class="o">](</span><span class="n">a_r2_r</span><span class="k">:</span> <span class="kt">Reducer</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">R</span><span class="o">])</span><span class="k">:</span> <span class="kt">R</span> <span class="o">=</span>
</span><span class='line'>        <span class="n">da</span> <span class="k">match</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">case</span> <span class="nc">Zero</span><span class="o">()</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="n">a_r2_r</span> <span class="k">match</span> <span class="o">{</span>
</span><span class='line'>              <span class="k">case</span> <span class="o">(</span><span class="n">u2r</span><span class="o">,</span> <span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>                <span class="n">u2r</span><span class="o">(())</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>          <span class="k">case</span> <span class="nc">More</span><span class="o">((</span><span class="n">a</span><span class="o">,</span> <span class="n">u2da</span><span class="o">))</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="n">a_r2_r</span> <span class="k">match</span> <span class="o">{</span>
</span><span class='line'>              <span class="k">case</span> <span class="o">(</span><span class="n">u2r</span><span class="o">,</span> <span class="n">a_n_u2r__2__r</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>                <span class="n">a_n_u2r__2__r</span><span class="o">((</span><span class="n">a</span><span class="o">,</span> <span class="o">{</span> <span class="k">case</span> <span class="o">()</span> <span class="k">=&gt;</span> <span class="n">u2da</span><span class="o">(()).</span><span class="n">reducedBy</span><span class="o">((</span><span class="n">u2r</span><span class="o">,</span> <span class="n">a_n_u2r__2__r</span><span class="o">))</span> <span class="o">}))</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>      <span class="k">override</span> <span class="k">def</span> <span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="k">:</span> <span class="kt">In</span><span class="o">)</span><span class="k">:</span> <span class="kt">Out</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>        <span class="n">da</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">private</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Zero</span><span class="o">[</span><span class="kt">A</span><span class="o">]()</span> <span class="k">extends</span> <span class="nc">ZeroOrMore</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">More</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">a_n_u2da</span><span class="k">:</span> <span class="kt">A</span> <span class="kt">**</span> <span class="o">(</span><span class="kt">Unit</span> <span class="o">=&gt;</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]))</span> <span class="k">extends</span> <span class="nc">ZeroOrMore</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>SuccessOrFailureModule</h2>

<p><code>SuccessOrFailureModule</code> is a <code>TraversablePolynomialSourceModule</code> and a <code>PolynomialFailingModule</code></p>

<figure class='code'><figcaption><span>SuccessOrFailureModule  (SuccessOrFailureModule.scala)</span> <a href='http://www.strongtyped.io/downloads/code/SuccessOrFailureModule.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">trait</span> <span class="nc">SuccessOrFailureModule</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">TraversablePolynomialSourceModule</span>
</span><span class='line'>    <span class="k">with</span> <span class="nc">PolynomialFailingModule</span>
</span><span class='line'>    <span class="k">with</span> <span class="nc">TrivialRunnableModule</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">import</span> <span class="nn">mm._</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span> <span class="nc">SuccessOrFailure</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">def</span> <span class="n">fail</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span><span class="k">:</span> <span class="kt">M</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>      <span class="n">m</span> <span class="k">=&gt;</span> <span class="nc">Failure</span><span class="o">(</span><span class="n">m</span><span class="o">)</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">def</span> <span class="n">one</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>      <span class="n">z</span> <span class="k">=&gt;</span> <span class="nc">Success</span><span class="o">(</span><span class="n">z</span><span class="o">)</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">Reducer</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">R</span><span class="o">]</span> <span class="k">=</span> <span class="o">(</span><span class="n">M</span> <span class="k">=&gt;</span> <span class="n">R</span><span class="o">)</span> <span class="o">**</span> <span class="o">(</span><span class="n">Z</span> <span class="k">=&gt;</span> <span class="n">R</span><span class="o">)</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">def</span> <span class="n">identityReducer</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span><span class="k">:</span> <span class="kt">Reducer</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="o">(</span><span class="n">fail</span><span class="o">,</span> <span class="n">one</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">def</span> <span class="n">lift</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">Y</span>, <span class="kt">R</span><span class="o">](</span><span class="n">mm</span><span class="k">:</span> <span class="kt">MM</span><span class="o">)(</span><span class="n">z2mmdy</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=&gt;</span> <span class="n">mm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">Y</span><span class="o">])</span><span class="k">:</span> <span class="kt">Reducer</span><span class="o">[</span><span class="kt">Y</span>, <span class="kt">R</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="nc">Reducer</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">mm.D</span><span class="o">[</span><span class="kt">R</span><span class="o">]]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="o">(</span><span class="n">m2r</span><span class="o">,</span> <span class="n">y2r</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">m2mmdr</span><span class="k">:</span> <span class="kt">M</span> <span class="o">=&gt;</span> <span class="n">mm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">R</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">case</span> <span class="n">m</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="n">mm</span><span class="o">.</span><span class="n">one</span><span class="o">(</span><span class="n">m2r</span><span class="o">(</span><span class="n">m</span><span class="o">))</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">z2mmdr</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=&gt;</span> <span class="n">mm</span><span class="o">.</span><span class="n">D</span><span class="o">[</span><span class="kt">R</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">case</span> <span class="n">z</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="n">z2mmdy</span><span class="o">(</span><span class="n">z</span><span class="o">)</span> <span class="n">end</span> <span class="o">{</span>
</span><span class='line'>              <span class="n">y</span> <span class="k">=&gt;</span>
</span><span class='line'>                <span class="n">y2r</span><span class="o">(</span><span class="n">y</span><span class="o">)</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="o">(</span><span class="n">m2mmdr</span><span class="o">,</span> <span class="n">z2mmdr</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">sealed</span> <span class="k">trait</span> <span class="nc">SuccessOrFailure</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="nc">extends</span> <span class="nc">TraversablePolynomialSource</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="k">with</span> <span class="nc">PolynomialFailing</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="k">with</span> <span class="nc">TrivialRunnable</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span> <span class="n">da</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="k">override</span> <span class="k">def</span> <span class="n">take</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>        <span class="n">da</span>
</span><span class='line'>      <span class="k">override</span> <span class="k">def</span> <span class="n">reducedBy</span><span class="o">[</span><span class="kt">R</span><span class="o">](</span><span class="n">a_r2_r</span><span class="k">:</span> <span class="kt">Reducer</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">R</span><span class="o">])</span><span class="k">:</span> <span class="kt">R</span> <span class="o">=</span> <span class="n">da</span> <span class="k">match</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">case</span> <span class="nc">Failure</span><span class="o">(</span><span class="n">m</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>          <span class="n">a_r2_r</span> <span class="k">match</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">case</span> <span class="o">(</span><span class="n">m2r</span><span class="o">,</span> <span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>              <span class="n">m2r</span><span class="o">(</span><span class="n">m</span><span class="o">)</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>        <span class="k">case</span> <span class="nc">Success</span><span class="o">(</span><span class="n">a</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>          <span class="n">a_r2_r</span> <span class="k">match</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">case</span> <span class="o">(</span><span class="k">_</span><span class="o">,</span> <span class="n">a2r</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>              <span class="n">a2r</span><span class="o">(</span><span class="n">a</span><span class="o">)</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">override</span> <span class="k">def</span> <span class="n">bnd</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">a2ob</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">m2ob</span><span class="k">:</span> <span class="kt">M</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">case</span> <span class="n">m</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="n">fail</span><span class="o">(</span><span class="n">m</span><span class="o">)</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">reducer</span><span class="k">:</span> <span class="kt">Reducer</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">D</span><span class="o">[</span><span class="kt">B</span><span class="o">]]</span> <span class="k">=</span>
</span><span class='line'>          <span class="o">(</span><span class="n">m2ob</span><span class="o">,</span> <span class="n">a2ob</span><span class="o">)</span>
</span><span class='line'>        <span class="n">da</span> <span class="n">reducedBy</span> <span class="n">reducer</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>      <span class="c1">// comment this one out</span>
</span><span class='line'>      <span class="c1">// for</span>
</span><span class='line'>      <span class="c1">// fail fast</span>
</span><span class='line'>      <span class="c1">// instead of</span>
</span><span class='line'>      <span class="c1">// fail slow and accumulate</span>
</span><span class='line'>      <span class="k">override</span> <span class="k">def</span> <span class="n">and</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">d_a2b</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">A</span> <span class="k">=&gt;</span> <span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">m2ob</span><span class="k">:</span> <span class="kt">M</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">case</span> <span class="n">m</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="n">d_a2b</span> <span class="k">match</span> <span class="o">{</span>
</span><span class='line'>              <span class="k">case</span> <span class="nc">Success</span><span class="o">(</span><span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>                <span class="n">fail</span><span class="o">(</span><span class="n">m</span><span class="o">)</span>
</span><span class='line'>              <span class="k">case</span> <span class="nc">Failure</span><span class="o">(</span><span class="n">m1</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>                <span class="n">fail</span><span class="o">(</span><span class="n">m</span> <span class="n">operator</span> <span class="n">m1</span><span class="o">)</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">a2ob</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">case</span> <span class="n">a</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="n">d_a2b</span> <span class="k">match</span> <span class="o">{</span>
</span><span class='line'>              <span class="k">case</span> <span class="nc">Success</span><span class="o">(</span><span class="n">a2b</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>                <span class="n">one</span><span class="o">(</span><span class="n">a2b</span><span class="o">(</span><span class="n">a</span><span class="o">))</span>
</span><span class='line'>              <span class="k">case</span> <span class="nc">Failure</span><span class="o">(</span><span class="n">m</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>                <span class="n">fail</span><span class="o">(</span><span class="n">m</span><span class="o">)</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">reducer</span><span class="k">:</span> <span class="kt">Reducer</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">D</span><span class="o">[</span><span class="kt">B</span><span class="o">]]</span> <span class="k">=</span>
</span><span class='line'>          <span class="o">(</span><span class="n">m2ob</span><span class="o">,</span> <span class="n">a2ob</span><span class="o">)</span>
</span><span class='line'>        <span class="n">da</span> <span class="n">reducedBy</span> <span class="n">reducer</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>      <span class="k">override</span> <span class="k">def</span> <span class="n">or</span><span class="o">(</span><span class="n">da1</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">u2oa</span><span class="k">:</span> <span class="kt">M</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">case</span> <span class="n">m</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="n">da</span> <span class="k">match</span> <span class="o">{</span>
</span><span class='line'>              <span class="k">case</span> <span class="nc">Success</span><span class="o">(</span><span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>                <span class="n">da</span>
</span><span class='line'>              <span class="k">case</span> <span class="nc">Failure</span><span class="o">(</span><span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>                <span class="n">da1</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">a2oa</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">case</span> <span class="n">a</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="n">one</span><span class="o">(</span><span class="n">a</span><span class="o">)</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">reducer</span><span class="k">:</span> <span class="kt">Reducer</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]]</span> <span class="k">=</span>
</span><span class='line'>          <span class="o">(</span><span class="n">u2oa</span><span class="o">,</span> <span class="n">a2oa</span><span class="o">)</span>
</span><span class='line'>        <span class="n">da</span> <span class="n">reducedBy</span> <span class="n">reducer</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>      <span class="k">override</span> <span class="k">def</span> <span class="n">toString</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">u2s</span><span class="k">:</span> <span class="kt">M</span> <span class="o">=&gt;</span> <span class="nc">String</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">case</span> <span class="n">m</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="n">s</span><span class="s">&quot; ${m.toString}&quot;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">a2s</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="nc">String</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">case</span> <span class="n">a</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="n">s</span><span class="s">&quot; ${a}&quot;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">reducer</span><span class="k">:</span> <span class="kt">Reducer</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>          <span class="o">(</span><span class="n">u2s</span><span class="o">,</span> <span class="n">a2s</span><span class="o">)</span>
</span><span class='line'>        <span class="n">s</span><span class="s">&quot;{${da reducedBy reducer} }&quot;</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>      <span class="k">override</span> <span class="k">def</span> <span class="n">run</span><span class="o">(</span><span class="n">in</span><span class="k">:</span> <span class="kt">In</span><span class="o">)</span><span class="k">:</span> <span class="kt">Out</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>        <span class="n">da</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">case</span> <span class="k">class</span> <span class="nc">Failure</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">m</span><span class="k">:</span> <span class="kt">M</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">SuccessOrFailure</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>    <span class="k">case</span> <span class="k">class</span> <span class="nc">Success</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">a</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">SuccessOrFailure</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>StateModule</h2>

<p><code>StateModule</code> is a <code>StatefulSourceModule</code></p>

<figure class='code'><figcaption><span>StateModule  (StateModule.scala)</span> <a href='http://www.strongtyped.io/downloads/code/StateModule.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">trait</span> <span class="nc">StateModule</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">StatefulSourceModule</span>
</span><span class='line'>    <span class="k">with</span> <span class="nc">StatefulRunnableModule</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span> <span class="nc">State</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">implicit</span> <span class="k">def</span> <span class="n">toState</span><span class="o">[</span><span class="kt">Z</span><span class="o">](</span><span class="n">s_2_snz</span><span class="k">:</span> <span class="kt">S</span> <span class="o">=&gt;</span> <span class="n">S</span> <span class="o">**</span> <span class="n">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>      <span class="nc">State</span><span class="o">(</span><span class="n">s_2_snz</span><span class="o">)</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">def</span> <span class="n">one</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>      <span class="n">z</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="n">s</span><span class="k">:</span> <span class="kt">S</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="n">s</span><span class="o">,</span> <span class="n">z</span><span class="o">)</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">def</span> <span class="n">get</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">S</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>      <span class="k">_</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="n">s</span><span class="k">:</span> <span class="kt">S</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="n">s</span><span class="o">,</span> <span class="n">s</span><span class="o">)</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">def</span> <span class="n">set</span><span class="k">:</span> <span class="kt">S</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>      <span class="n">s</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="k">_:</span> <span class="kt">S</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="n">s</span><span class="o">,</span> <span class="o">())</span>
</span><span class='line'>    <span class="k">case</span> <span class="k">class</span> <span class="nc">State</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">s_2_sna</span><span class="k">:</span> <span class="kt">S</span> <span class="o">=&gt;</span> <span class="n">S</span> <span class="o">**</span> <span class="n">A</span><span class="o">)</span>
</span><span class='line'>      <span class="k">extends</span> <span class="nc">StatefulSource</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="k">with</span> <span class="nc">StatefulRunnable</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span> <span class="n">da</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="k">override</span> <span class="k">def</span> <span class="n">bnd</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">a2db</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>        <span class="o">(</span><span class="n">s</span><span class="k">:</span> <span class="kt">S</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>          <span class="n">da</span><span class="o">.</span><span class="n">s_2_sna</span><span class="o">(</span><span class="n">s</span><span class="o">)</span> <span class="k">match</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">case</span> <span class="o">(</span><span class="n">s1</span><span class="o">,</span> <span class="n">a</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>              <span class="n">a2db</span><span class="o">(</span><span class="n">a</span><span class="o">).</span><span class="n">s_2_sna</span><span class="o">(</span><span class="n">s1</span><span class="o">)</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>      <span class="k">override</span> <span class="k">def</span> <span class="n">run</span><span class="o">(</span><span class="n">s</span><span class="k">:</span> <span class="kt">S</span><span class="o">)</span><span class="k">:</span> <span class="kt">S</span> <span class="kt">**</span> <span class="kt">A</span> <span class="o">=</span>
</span><span class='line'>        <span class="n">s_2_sna</span><span class="o">(</span><span class="n">s</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>AsyncModule</h2>

<p><code>AsyncModule</code> is an <code>AsynchronousSourceModule</code></p>

<figure class='code'><figcaption><span>AsyncModule  (AsyncModule.scala)</span> <a href='http://www.strongtyped.io/downloads/code/AsyncModule.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">object</span> <span class="nc">AsyncModule</span>
</span><span class='line'>    <span class="k">extends</span> <span class="nc">AsynchronousSourceModule</span>
</span><span class='line'>    <span class="k">with</span> <span class="nc">AsynchronousRunnableModule</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">implicit</span> <span class="k">def</span> <span class="n">toSimpleFuture</span><span class="o">[</span><span class="kt">Z</span><span class="o">](</span><span class="n">to2z</span><span class="k">:</span> <span class="kt">TimeOut</span> <span class="o">=&gt;</span> <span class="n">Z</span><span class="o">)</span> <span class="k">=</span>
</span><span class='line'>      <span class="k">new</span> <span class="nc">SimpleFuture</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">override</span> <span class="k">def</span> <span class="n">get</span><span class="o">(</span><span class="n">timeOut</span><span class="k">:</span> <span class="kt">TimeOut</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span>
</span><span class='line'>          <span class="n">to2z</span><span class="o">(</span><span class="n">timeOut</span><span class="o">)</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">implicit</span> <span class="k">def</span> <span class="n">toAsync</span><span class="o">[</span><span class="kt">Z</span><span class="o">](</span><span class="n">es_2_sfz</span><span class="k">:</span> <span class="kt">ExecutorService</span> <span class="o">=&gt;</span> <span class="nc">SimpleFuture</span><span class="o">[</span><span class="kt">Z</span><span class="o">])</span> <span class="k">=</span>
</span><span class='line'>      <span class="nc">Async</span><span class="o">(</span><span class="n">es_2_sfz</span><span class="o">)</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">implicit</span> <span class="k">def</span> <span class="n">toRunnable</span><span class="o">(</span><span class="n">u2u</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=&gt;</span> <span class="nc">Unit</span><span class="o">)</span> <span class="k">=</span>
</span><span class='line'>      <span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="n">lang</span><span class="o">.</span><span class="nc">Runnable</span><span class="o">()</span> <span class="o">{</span> <span class="k">def</span> <span class="n">run</span><span class="o">()</span> <span class="k">=</span> <span class="n">u2u</span><span class="o">(())</span> <span class="o">}</span>
</span><span class='line'>    <span class="k">type</span> <span class="kt">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Async</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">def</span> <span class="n">one</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>      <span class="n">z</span> <span class="k">=&gt;</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">es_2_sfz</span><span class="k">:</span> <span class="kt">ExecutorService</span> <span class="o">=&gt;</span> <span class="nc">SimpleFuture</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>          <span class="k">_</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="k">_:</span> <span class="kt">TimeOut</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">z</span>
</span><span class='line'>        <span class="n">es_2_sfz</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">def</span> <span class="n">async</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span><span class="k">:</span> <span class="o">(</span><span class="kt">Unit</span> <span class="o">=&gt;</span> <span class="kt">Z</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>      <span class="n">u2z</span> <span class="k">=&gt;</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">es_2_sfz</span><span class="k">:</span> <span class="kt">ExecutorService</span> <span class="o">=&gt;</span> <span class="nc">SimpleFuture</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>          <span class="n">es</span> <span class="k">=&gt;</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">val</span> <span class="n">atomic</span><span class="k">:</span> <span class="kt">Atomic</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Atomic</span><span class="o">()</span>
</span><span class='line'>            <span class="n">es</span><span class="o">.</span><span class="n">submit</span> <span class="o">{</span>
</span><span class='line'>              <span class="o">(</span><span class="k">_:</span> <span class="kt">Unit</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>                <span class="n">atomic</span><span class="o">.</span><span class="n">setValue</span><span class="o">(</span><span class="n">u2z</span><span class="o">(()))</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>            <span class="o">(</span><span class="n">timeOut</span><span class="k">:</span> <span class="kt">TimeOut</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">{</span>
</span><span class='line'>              <span class="n">atomic</span><span class="o">.</span><span class="n">getValue</span><span class="o">(</span><span class="n">timeOut</span><span class="o">)</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>        <span class="n">es_2_sfz</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="k">case</span> <span class="k">class</span> <span class="nc">Async</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">es_2_sfa</span><span class="k">:</span> <span class="kt">ExecutorService</span> <span class="o">=&gt;</span> <span class="nc">SimpleFuture</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span>
</span><span class='line'>      <span class="k">extends</span> <span class="nc">AsynchronousSource</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span><span class='line'>      <span class="k">with</span> <span class="nc">AsynchronousRunnable</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span> <span class="n">da</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="k">override</span> <span class="k">def</span> <span class="n">bnd</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">a2db</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">es_2_sfb</span><span class="k">:</span> <span class="kt">ExecutorService</span> <span class="o">=&gt;</span> <span class="nc">SimpleFuture</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>          <span class="n">es</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="n">timeOut</span><span class="k">:</span> <span class="kt">TimeOut</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">val</span> <span class="n">startTime</span> <span class="k">=</span> <span class="n">currentTimeMillis</span><span class="o">()</span>
</span><span class='line'>            <span class="k">val</span> <span class="n">a</span> <span class="k">=</span> <span class="n">es_2_sfa</span><span class="o">(</span><span class="n">es</span><span class="o">).</span><span class="n">get</span><span class="o">(</span><span class="n">timeOut</span><span class="o">)</span>
</span><span class='line'>            <span class="k">val</span> <span class="n">stopTime</span> <span class="k">=</span> <span class="n">currentTimeMillis</span><span class="o">()</span>
</span><span class='line'>            <span class="o">(</span><span class="n">a2db</span><span class="o">(</span><span class="n">a</span><span class="o">)).</span><span class="n">es_2_sfa</span><span class="o">(</span><span class="n">es</span><span class="o">).</span><span class="n">get</span><span class="o">(</span><span class="n">timeOut</span> <span class="o">-</span> <span class="o">(</span><span class="n">stopTime</span> <span class="o">-</span> <span class="n">startTime</span><span class="o">))</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>        <span class="n">es_2_sfb</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>      <span class="c1">// comment this one out</span>
</span><span class='line'>      <span class="c1">// for</span>
</span><span class='line'>      <span class="c1">// sequential</span>
</span><span class='line'>      <span class="c1">// instead of parallel</span>
</span><span class='line'>      <span class="k">override</span> <span class="k">def</span> <span class="n">and</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">d_a2b</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="n">D</span><span class="o">[</span><span class="kt">A</span> <span class="k">=&gt;</span> <span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">D</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">es_2_sfb</span><span class="k">:</span> <span class="kt">ExecutorService</span> <span class="o">=&gt;</span> <span class="nc">SimpleFuture</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>          <span class="n">es</span> <span class="k">=&gt;</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">val</span> <span class="n">sfa</span> <span class="k">=</span> <span class="n">es_2_sfa</span><span class="o">(</span><span class="n">es</span><span class="o">)</span>
</span><span class='line'>            <span class="k">val</span> <span class="n">sf_a2b</span> <span class="k">=</span> <span class="n">d_a2b</span><span class="o">.</span><span class="n">es_2_sfa</span><span class="o">(</span><span class="n">es</span><span class="o">)</span>
</span><span class='line'>            <span class="k">val</span> <span class="n">sfb</span> <span class="k">=</span> <span class="o">(</span><span class="n">timeOut</span><span class="k">:</span> <span class="kt">TimeOut</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">{</span>
</span><span class='line'>              <span class="k">val</span> <span class="n">startTime</span> <span class="k">=</span> <span class="n">currentTimeMillis</span><span class="o">()</span>
</span><span class='line'>              <span class="k">val</span> <span class="n">a</span> <span class="k">=</span> <span class="n">sfa</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="n">timeOut</span><span class="o">)</span>
</span><span class='line'>              <span class="k">val</span> <span class="n">stopTime</span> <span class="k">=</span> <span class="n">currentTimeMillis</span><span class="o">()</span>
</span><span class='line'>              <span class="k">val</span> <span class="n">a2b</span> <span class="k">=</span> <span class="n">sf_a2b</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="n">timeOut</span> <span class="o">-</span> <span class="o">(</span><span class="n">stopTime</span> <span class="o">-</span> <span class="n">startTime</span><span class="o">))</span>
</span><span class='line'>              <span class="n">a2b</span><span class="o">(</span><span class="n">a</span><span class="o">)</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>            <span class="n">sfb</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>        <span class="n">es_2_sfb</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>      <span class="k">def</span> <span class="n">run</span><span class="o">(</span><span class="n">es</span><span class="k">:</span> <span class="kt">ExecutorService</span><span class="o">)</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=</span>
</span><span class='line'>        <span class="n">es_2_sfa</span><span class="o">(</span><span class="n">es</span><span class="o">).</span><span class="n">get</span><span class="o">()</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>AsyncModule</code> makes use of the type <code>TimeOut</code>, the <em>trait</em> <code>SimpleFuture</code> and the <em>class</em> <code>Atomic</code></p>

<figure class='code'><figcaption><span>TimeOut  (TimeOut.scala)</span> <a href='http://www.strongtyped.io/downloads/code/TimeOut.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">type</span> <span class="kt">TimeOut</span> <span class="o">=</span> <span class="nc">Long</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>SimpleFuture  (SimpleFuture.scala)</span> <a href='http://www.strongtyped.io/downloads/code/SimpleFuture.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">trait</span> <span class="nc">SimpleFuture</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="nc">extends</span> <span class="nc">Future</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">get</span><span class="o">(</span><span class="n">timeOut</span><span class="k">:</span> <span class="kt">TimeOut</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">def</span> <span class="n">get</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span>
</span><span class='line'>      <span class="n">get</span><span class="o">(</span><span class="nc">MAX_VALUE</span><span class="o">)</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">def</span> <span class="n">get</span><span class="o">(</span><span class="n">timeOut</span><span class="k">:</span> <span class="kt">TimeOut</span><span class="o">,</span> <span class="n">timeUnit</span><span class="k">:</span> <span class="kt">TimeUnit</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span>
</span><span class='line'>      <span class="n">get</span><span class="o">(</span><span class="nc">MILLISECONDS</span><span class="o">.</span><span class="n">convert</span><span class="o">(</span><span class="n">timeOut</span><span class="o">,</span> <span class="n">timeUnit</span><span class="o">))</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">def</span> <span class="n">isDone</span> <span class="k">=</span>
</span><span class='line'>      <span class="n">sys</span><span class="o">.</span><span class="n">error</span><span class="o">(</span><span class="s">&quot;not implemented&quot;</span><span class="o">)</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">def</span> <span class="n">isCancelled</span> <span class="k">=</span>
</span><span class='line'>      <span class="n">sys</span><span class="o">.</span><span class="n">error</span><span class="o">(</span><span class="s">&quot;not implemented&quot;</span><span class="o">)</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">def</span> <span class="n">cancel</span><span class="o">(</span><span class="n">interruptable</span><span class="k">:</span> <span class="kt">Boolean</span><span class="o">)</span> <span class="k">=</span>
</span><span class='line'>      <span class="n">sys</span><span class="o">.</span><span class="n">error</span><span class="o">(</span><span class="s">&quot;not implemented&quot;</span><span class="o">)</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Atomic  (Atomic.scala)</span> <a href='http://www.strongtyped.io/downloads/code/Atomic.scala'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">class</span> <span class="nc">Atomic</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">var</span> <span class="n">z</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="k">_</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">countDownLatch</span><span class="k">:</span> <span class="kt">CountDownLatch</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CountDownLatch</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">getValue</span><span class="o">(</span><span class="n">timeOut</span><span class="k">:</span> <span class="kt">TimeOut</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">countDownLatch</span><span class="o">.</span><span class="n">await</span><span class="o">(</span><span class="n">timeOut</span><span class="o">,</span> <span class="nc">MILLISECONDS</span><span class="o">)</span>
</span><span class='line'>      <span class="n">z</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">setValue</span><span class="o">(</span><span class="n">newZ</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">z</span> <span class="k">=</span> <span class="n">newZ</span>
</span><span class='line'>      <span class="n">countDownLatch</span><span class="o">.</span><span class="n">countDown</span><span class="o">()</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Embracing Your Rows With Slick]]></title>
    <link href="http://www.strongtyped.io/blog/2014/07/18/embracing-your-rows-with-slick/"/>
    <updated>2014-07-18T09:00:00+02:00</updated>
    <id>http://www.strongtyped.io/blog/2014/07/18/embracing-your-rows-with-slick</id>
    <content type="html"><![CDATA[<p>This post is a follow-up of my talk &ldquo;<em>Slick in the field, learning to forget ORM</em>&rdquo; presented at ScalaDays 2014. The video is available on <a href="http://www.parleys.com/play/53a7d2c6e4b0543940d9e54c">Parleys</a> and can be watched on the bottom of this page.</p>

<p>At Scala Days I presented the project <a href="https://github.com/strongtyped/active-slick">ActiveSlick</a> which is a thin layer on top of Slick (v.20) providing some abstractions to ease object lifecycle management and the implementation of a type-safe <code>ActiveRecord</code> pattern.</p>

<p>Slick is wonderful piece of code that allows you to build and compose sql queries using plain Scala code. The advantages of that are many, but the most important, in my opinion, is the high re-utilisation of queries by composition and the compile time checking offered by the Scala compiler.</p>

<p>This post is NOT an introduction to Slick, neither was my talk at Scala Days. The goal is to explain how I&rsquo;ve solved part of the object lifecycle management and my vision about how one should model applications using Slick.</p>

<!-- more -->


<h1>Object lifecycle management</h1>

<p>It&rsquo;s very common nowadays to find articles blaming ORM frameworks and stating that ORM is an anti-pattern. I won&rsquo;t go into that discussion. I don&rsquo;t think that ORM frameworks offer a perfect solution, but much like everything in our industry, there is no perfect solutions. There is always some trade-offs to make when choosing one or other tool.</p>

<p>Martin Fowler once wrote an article called <a href="http://martinfowler.com/bliki/OrmHate.html">OrmHate</a> where he discuss this ORM blaming trend. The main argument against ORM is that it tries to workaround the inherent problem of connecting an object-oriented model to relational database tables. However, Martin&rsquo;s point of view is that ORM frameworks are not only trying to solve the impedance mismatch problem, they are also helping us to deal with two representations of our data. One representation being the in-memory model expressed in an object-oriented fashion and another representation stored in relational database tables.</p>

<p>These two representations of data must be kept in sync. This is a challenge that any application doing persistence needs to solve. As soon you serialise/deserialise data to and from any kind of storage you have to make sure you synchronise them correctly.</p>

<p>The most common problems related to the object lifecycle are <em>identity</em> and <em>versioning</em>. Once we have <em>identity</em> and <em>versioning</em> we can answer the following questions:</p>

<ul>
<li>Is this object already persisted?</li>
<li>Is this object dirty? Does it need to be saved back into storage?</li>
<li>Is this object stale?</li>
</ul>


<p>These are the typical lifecycle questions that we have for a single object. But this is not all. We also need to deal with collections of records. We must be able to preserve the ordering of elements and to know when an object was removed from a collection or added to it.</p>

<p>Contrary to other persistence libraries, Slick does not provide these facilities. To some extend this is expected as Slick is a database access library not a persistence framework. As stated in the Slick website, &ldquo;<em>Slick is a modern database query and access library for Scala</em>&rdquo;.</p>

<p>The question is how can we build a framework to solve the above mentioned problems on top of Slick? How can we build a framework that helps us to deal with single object and collection lifecycle using a type-safe database query and access library?</p>

<h1>Embrace your rows</h1>

<p>Another import point of my talk was around the question: &ldquo;<em>How to model your domain when using Slick?</em>&rdquo;.</p>

<p>A very common question on the Slick mailing list is how to model one-to-many and many-to-many relations with Slick? After years of object-oriented and ORM practice it&rsquo;s natural that we have to spent some time to learn how to think differently. By consequence, we&rsquo;ll also have to learn how to model differently.</p>

<p>My take on that is that we should code and model to our rows. When using Scala we often model using immutable data structures, i.e.: case classes.  Slick of course just builds on top of this paradigm. A case class model is a mirror of a table definition and an instance of such case class is just a row that was brought into memory or a row that still need to be inserted in a table.</p>

<p><strong>Embrace your rows</strong> is a call-out to adopt this way of modelling. We often say that functions are first-class citizens in functional programming. That failure is a first-class citizen in reactive programming. Well, when using Slick, rows are first-class citizens.</p>

<p>We could try to fight the ORM battle once again and build a ORM framework more suited to immutable data structures, with built-in nullable &lt;&ndash;> Option conversion, with type-safe queries and query composition. But we can also model differently by keeping our in-memory model as close as possible to its relational database representation. And that&rsquo;s exactly what Slick does.</p>

<p>Therefore the <a href="https://github.com/strongtyped/active-slick">ActiveSlick</a> project goal is to build a thin layer on top of Slick to solve some basic object lifecycle challenges and to promote the idea of modelling with rows, much like when using the <code>ActiveRecord</code> pattern. Hence the name <code>ActiveSlick</code>.</p>

<hr />

<h2>Parleys Video: Slick in the field, learning to forget ORM</h2>

<iframe type="text/html" width="100%" height="410" mozallowfullscreen="true" webkitallowfullscreen="true" src="http://www.parleys.com/share.html#play/53a7d2c6e4b0543940d9e54c" frameborder="0"></iframe>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Macros: Case Class Related Macros]]></title>
    <link href="http://www.strongtyped.io/blog/2014/05/23/case-class-related-macros/"/>
    <updated>2014-05-23T09:00:00+02:00</updated>
    <id>http://www.strongtyped.io/blog/2014/05/23/case-class-related-macros</id>
    <content type="html"><![CDATA[<p>This is a first blog post about <em>Writing Macros in Scala</em>.
This blog post covers two interesting pairs of macros dealing with <em>case classes</em>.
The macros of the first pair translate <em>case classes to tuples</em>, and <em>tuples to case classes</em>.
The macros of the second pair translate <em>case classes to maps</em>, and <em>maps to case classes</em>.</p>

<p><strong>Remark:</strong>
The macros presented in this blog can be found elsewhere on the internet.
We tried to reuse as much code as possible for both pairs of macros using a <code>Common</code> singleton object. Moreover, we end by adding a bit of extra code of our own as well.</p>

<!-- more -->


<h2>Case classes and Tuples</h2>

<p>The tranformations
from case classes <code>Z</code> to tuples <code>T</code>
and
from tuples <code>T</code> to case classes <code>Z</code>
can be formalized as follows</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">trait</span> <span class="nc">ToTuple</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">T</span><span class="o">]</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">toTuple</span><span class="o">(</span><span class="n">z</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">T</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">trait</span> <span class="nc">FromTuple</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">T</span><span class="o">]</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">fromTuple</span><span class="o">(</span><span class="n">t</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>The <code>toTuple</code> and <code>fromTuple</code> functions</h2>

<p>It turns out that it is convenient to define <em>implicit macros</em> of type <code>ToTuple[Z, T]</code> and <code>FromTuple[Z, T]</code>.
Assuming the existence of such macros, it is also convenient to define functions
<code>toTuple</code> and <code>fromTuple</code> that  <code>implicitly</code> make use of them</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">def</span> <span class="n">toTuple</span><span class="o">[</span><span class="kt">Z:</span> <span class="o">({</span> <span class="k">type</span> <span class="kt">ToTuple_</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="kt">=</span> <span class="kt">ToTuple</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">T</span><span class="o">]</span> <span class="o">})</span><span class="k">#</span><span class="kt">ToTuple_</span>, <span class="kt">T</span><span class="o">](</span><span class="n">z</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">T</span> <span class="o">=</span>
</span><span class='line'>    <span class="n">implicitly</span><span class="o">[</span><span class="kt">ToTuple</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">T</span><span class="o">]].</span><span class="n">toTuple</span><span class="o">(</span><span class="n">z</span><span class="o">)</span>
</span><span class='line'>  <span class="k">def</span> <span class="n">fromTuple</span><span class="o">[</span><span class="kt">Z:</span> <span class="o">({</span> <span class="k">type</span> <span class="kt">FromTuple_</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="kt">=</span> <span class="kt">FromTuple</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">T</span><span class="o">]</span> <span class="o">})</span><span class="k">#</span><span class="kt">FromTuple_</span>, <span class="kt">T</span><span class="o">](</span><span class="n">t</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span>
</span><span class='line'>    <span class="n">implicitly</span><span class="o">[</span><span class="kt">FromTuple</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">T</span><span class="o">]].</span><span class="n">fromTuple</span><span class="o">(</span><span class="n">t</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>The definitions above make use of type constructors <code>ToTuple_</code> resp. <code>FromTuple_</code>,
having <em>one type parameter</em>, that are obtained by <em>partially binding</em> the
the type <code>T</code> to the second type parameter of the type constructors <code>ToTuple</code> resp. <code>FromTuple</code>,
having <em>two type parameters</em>.</p>

<h2>An example case class</h2>

<p>Consider the case class</p>

<ul>
<li><code>case class Person(name: String, age: Int)</code></li>
</ul>


<p>The tuple class corresponding to this case class is</p>

<ul>
<li><code>(String, Int)</code></li>
</ul>


<p>Here is the code that a macro should generate to convert a <code>Person</code> instance
to a <code>(String, Int)</code> instance</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">new</span> <span class="nc">ToTuple</span><span class="o">[</span><span class="kt">Person</span>, <span class="o">(</span><span class="kt">String</span>, <span class="kt">Int</span><span class="o">)]</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">def</span> <span class="n">toTuple</span><span class="o">(</span><span class="n">z</span><span class="k">:</span> <span class="kt">Person</span><span class="o">)</span> <span class="k">=</span> <span class="o">(</span><span class="n">z</span><span class="o">.</span><span class="n">name</span><span class="o">,</span> <span class="n">z</span><span class="o">.</span><span class="n">age</span><span class="o">)</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here is the code that a macro should generate to convert a <code>(String, Int)</code> instance
to a <code>Person</code> instance</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">new</span> <span class="nc">FromTuple</span><span class="o">[</span><span class="kt">Person</span>, <span class="o">(</span><span class="kt">String</span>, <span class="kt">Int</span><span class="o">)]</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">def</span> <span class="n">fromTuple</span><span class="o">(</span><span class="n">t</span><span class="k">:</span> <span class="o">(</span><span class="kt">String</span><span class="o">,</span> <span class="kt">Int</span><span class="o">))</span> <span class="k">=</span> <span class="nc">Person</span><span class="o">(</span><span class="n">t</span><span class="o">.</span><span class="n">_1</span><span class="o">,</span> <span class="n">t</span><span class="o">.</span><span class="n">_2</span><span class="o">)</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>So, what is the information that we require at compile time
for being able to generate this code?</p>

<ul>
<li>we require the string <code>"Person"</code></li>
<li>we require the strings <code>"String"</code> and <code>"Int"</code></li>
<li>we require the strings <code>"name"</code> and <code>"age"</code></li>
<li>we require the number <code>2</code> to generate the strings <code>"1"</code> and <code>"2"</code></li>
</ul>


<p>The last requirement is not really needed if we replace the first three
requirements above by</p>

<ul>
<li>we require the string <code>"Person"</code></li>
<li>we require the list of strings containing <code>"String"</code> and <code>"Int"</code></li>
<li>we require the list of strings containing <code>"name"</code> and <code>"age"</code></li>
</ul>


<p>because the lists above have size <code>2</code>.</p>

<p>So how can we obtain all those required strings?</p>

<h2>The <code>getFieldNamesAndTypes</code> method</h2>

<p>The following code is all we need to obtain the required strings</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">trait</span> <span class="nc">Common</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">getFieldNamesAndTypes</span><span class="o">(</span><span class="n">c</span><span class="k">:</span> <span class="kt">Context</span><span class="o">)(</span><span class="n">tpe</span><span class="k">:</span> <span class="kt">c.universe.Type</span><span class="o">)</span><span class="k">:</span>
</span><span class='line'>      <span class="kt">Iterable</span><span class="o">[(</span><span class="kt">c.universe.Name</span>, <span class="kt">c.universe.Type</span><span class="o">)]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">import</span> <span class="nn">c.universe._</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">object</span> <span class="nc">CaseField</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">def</span> <span class="n">unapply</span><span class="o">(</span><span class="n">trmSym</span><span class="k">:</span> <span class="kt">TermSymbol</span><span class="o">)</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[(</span><span class="kt">Name</span>, <span class="kt">Type</span><span class="o">)]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">if</span> <span class="o">(</span><span class="n">trmSym</span><span class="o">.</span><span class="n">isVal</span> <span class="o">&amp;&amp;</span> <span class="n">trmSym</span><span class="o">.</span><span class="n">isCaseAccessor</span><span class="o">)</span>
</span><span class='line'>             <span class="nc">Some</span><span class="o">((</span><span class="n">newTermName</span><span class="o">(</span><span class="n">trmSym</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">toString</span><span class="o">.</span><span class="n">trim</span><span class="o">),</span> <span class="n">trmSym</span><span class="o">.</span><span class="n">typeSignature</span><span class="o">))</span>
</span><span class='line'>          <span class="k">else</span>
</span><span class='line'>            <span class="nc">None</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">tpe</span><span class="o">.</span><span class="n">declarations</span><span class="o">.</span><span class="n">collect</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">case</span> <span class="nc">CaseField</span><span class="o">(</span><span class="n">nme</span><span class="o">,</span> <span class="n">tpe</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>          <span class="o">(</span><span class="n">nme</span><span class="o">,</span> <span class="n">tpe</span><span class="o">)</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The code above has a <code>Context</code> parameter <code>c</code>, using which we can obtain all
the types we need using <code>import c.universe._</code>.</p>

<p>The only information available to start generating code from is <code>tpe</code>, having type <code>Type</code>.
The <code>object CaseField</code>&rsquo;s <code>unapply</code> method can be used to<em> extract</em> the
information that we need from the <em>declarations</em> of <code>tpe</code>,
using a <em>collection</em> that uses an appropriate <code>CaseField</code> pattern matching partial function.</p>

<p>Maybe, by looking at the code, you may wonder why it uses
the somewhat complex expression <code>newTermName(trmSym.name.toString.trim)</code> instead
of the much simpler expression <code>trmSym.name</code>.
Writing macros is still somewhat of a <em>black art</em>.
It turns out that using <code>trmSym.name</code> would result in strings
<code>"name "</code> and <code>"age "</code>, with an extra blank at the end,
and we can get rid of that extra blank using
the more complex expression <code>newTermName(trmSym.name.toString.trim)</code>.</p>

<h2>The <code>toTupleMacro</code> macro</h2>

<p>Using the <code>getFieldNamesAndTypes</code> method we can now define the
implicit <code>toTupleMacro</code> as follows</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">object</span> <span class="nc">ToTuple</span> <span class="k">extends</span> <span class="nc">Common</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">implicit</span> <span class="k">def</span> <span class="n">toTupleMacro</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">T</span><span class="o">]</span><span class="k">:</span> <span class="kt">ToTuple</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">T</span><span class="o">]</span> <span class="k">=</span> <span class="n">macro</span> <span class="n">toTupleMacroImpl</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">T</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="n">toTupleMacroImpl</span><span class="o">[</span><span class="kt">Z:</span> <span class="kt">c.WeakTypeTag</span>, <span class="kt">T</span><span class="o">](</span><span class="n">c</span><span class="k">:</span> <span class="kt">Context</span><span class="o">)</span><span class="k">:</span> <span class="kt">c.Expr</span><span class="o">[</span><span class="kt">ToTuple</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">T</span><span class="o">]]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">import</span> <span class="nn">c.universe._</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">val</span> <span class="n">tpe</span><span class="k">:</span> <span class="kt">Type</span> <span class="o">=</span> <span class="n">weakTypeOf</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">val</span> <span class="o">(</span><span class="n">nmes</span><span class="o">,</span> <span class="n">tpes</span><span class="o">)</span> <span class="k">=</span> <span class="n">getFieldNamesAndTypes</span><span class="o">(</span><span class="n">c</span><span class="o">)(</span><span class="n">tpe</span><span class="o">).</span><span class="n">unzip</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">val</span> <span class="n">fldSels</span><span class="k">:</span> <span class="kt">Iterable</span><span class="o">[</span><span class="kt">Select</span><span class="o">]</span> <span class="k">=</span> <span class="n">nmes</span><span class="o">.</span><span class="n">map</span> <span class="o">{</span> <span class="n">nme</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">q</span><span class="s">&quot;&quot;&quot;</span>
</span><span class='line'><span class="s">         z.$nme</span>
</span><span class='line'><span class="s">        &quot;&quot;&quot;</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">val</span> <span class="n">toTuple</span><span class="k">:</span> <span class="kt">Tree</span> <span class="o">=</span>
</span><span class='line'>        <span class="n">q</span><span class="s">&quot;&quot;&quot;</span>
</span><span class='line'><span class="s">         new ToTuple[$tpe, (..$tpes)] {</span>
</span><span class='line'><span class="s">           def toTuple(z: $tpe) = (..$fldSels)</span>
</span><span class='line'><span class="s">         }</span>
</span><span class='line'><span class="s">        &quot;&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">c</span><span class="o">.</span><span class="nc">Expr</span><span class="o">[</span><span class="kt">ToTuple</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">T</span><span class="o">]](</span><span class="n">toTuple</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The macro, in this case one of type <code>ToTuple[Z, T]</code>, is <em>declared</em> using a <code>macro</code> keyword.
The macro is <em>definied</em> using a method of type <code>c.Expr</code>,
in this case of type <code>c.Expr[ToTuple[Z, T]]</code>.
The method has an extra parameter of type <code>Context</code>.
The macro makes use of <em>quasi-quotes</em>, the preferred way to generate code. We use <code>unzip</code>
to turn a list of tuples into a tuple of lists. The <code>tpes</code> can be used as such in the
quasi-quote expression that defines <code>toTuple</code>. The <code>nmes</code> can be used to define <em>field selections</em>
<code>fldSels</code> that can be used in the quasi-quote expression that defines <code>toTuple</code>.
The variable <code>toTuple</code> has type <code>Tree</code> and the macro needs a <code>c.Expr[ToTuple[Z, T]]</code>
type. Therefore we wrap <code>toTuple</code> into an expression of type <code>c.Expr[ToTuple[Z, T]]</code>.</p>

<h2>The <code>fromTupleMacro</code> macro</h2>

<p>Using the <code>getFieldNamesAndTypes</code> method we can now define the
implicit <code>fromTupleMacro</code> as follows</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">object</span> <span class="nc">FromTuple</span> <span class="k">extends</span> <span class="nc">Common</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">implicit</span> <span class="k">def</span> <span class="n">fromTupleMacro</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">T</span><span class="o">]</span><span class="k">:</span> <span class="kt">FromTuple</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">T</span><span class="o">]</span> <span class="k">=</span> <span class="n">macro</span> <span class="n">fromTupleMacroImpl</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">T</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="n">fromTupleMacroImpl</span><span class="o">[</span><span class="kt">Z:</span> <span class="kt">c.WeakTypeTag</span>, <span class="kt">T</span><span class="o">](</span><span class="n">c</span><span class="k">:</span> <span class="kt">Context</span><span class="o">)</span><span class="k">:</span> <span class="kt">c.Expr</span><span class="o">[</span><span class="kt">FromTuple</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">T</span><span class="o">]]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">import</span> <span class="nn">c.universe._</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">val</span> <span class="n">tpe</span><span class="k">:</span> <span class="kt">Type</span> <span class="o">=</span> <span class="n">weakTypeOf</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">val</span> <span class="o">(</span><span class="n">nmes</span><span class="o">,</span> <span class="n">tpes</span><span class="o">)</span> <span class="k">=</span> <span class="n">getFieldNamesAndTypes</span><span class="o">(</span><span class="n">c</span><span class="o">)(</span><span class="n">tpe</span><span class="o">).</span><span class="n">unzip</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">def</span> <span class="n">prj</span><span class="o">(</span><span class="n">i</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">TermName</span> <span class="o">=</span> <span class="n">newTermName</span><span class="o">(</span><span class="s">&quot;_&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">val</span> <span class="n">prjs</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[</span><span class="kt">Select</span><span class="o">]</span> <span class="k">=</span> <span class="o">(</span><span class="mi">1</span> <span class="n">to</span> <span class="n">nmes</span><span class="o">.</span><span class="n">toSeq</span><span class="o">.</span><span class="n">size</span><span class="o">).</span><span class="n">map</span> <span class="o">{</span> <span class="n">i</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">q</span><span class="s">&quot;&quot;&quot;</span>
</span><span class='line'><span class="s">         t.${prj(i)}</span>
</span><span class='line'><span class="s">        &quot;&quot;&quot;</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">val</span> <span class="n">tpeSym</span><span class="k">:</span> <span class="kt">Symbol</span> <span class="o">=</span> <span class="n">tpe</span><span class="o">.</span><span class="n">typeSymbol</span><span class="o">.</span><span class="n">companionSymbol</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">val</span> <span class="n">fromTuple</span><span class="k">:</span> <span class="kt">Tree</span> <span class="o">=</span>
</span><span class='line'>        <span class="n">q</span><span class="s">&quot;&quot;&quot;</span>
</span><span class='line'><span class="s">         new FromTuple[$tpe, (..$tpes)] {</span>
</span><span class='line'><span class="s">           def fromTuple(t: (..$tpes)) = ${tpeSym}(..$prjs)</span>
</span><span class='line'><span class="s">         }</span>
</span><span class='line'><span class="s">        &quot;&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">c</span><span class="o">.</span><span class="nc">Expr</span><span class="o">[</span><span class="kt">FromTuple</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">T</span><span class="o">]](</span><span class="n">fromTuple</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The macro, in this case one of type <code>FromTuple[Z, T]</code>,  is <em>declared</em> using a <code>macro</code> keyword.
The macro is <em>definied</em> using a method of type <code>c.Expr</code>,
in this case of type <code>c.Expr[FromTuple[Z, T]]</code>.
The method has an extra parameter of type <code>Context</code>.
The macro makes use of <em>quasi-quotes</em>, the preferred way to generate code. We use <code>unzip</code>
to turn a list of tuples into a tuple of lists. The <code>tpes</code> can be used as such in the
quasi-quote expression that defines <code>fromTuple</code>. The <code>nmes</code> can be used to define <em>projections</em>
<code>prjs</code> that can be used in the quasi-quote expression that defines <code>fromTuple</code>.
We also need <code>tpeSym</code> the <em>type symbol</em> of the <em>companion object</em> of the case class.
The variable <code>fromTuple</code> has type <code>Tree</code> and the macro needs a <code>c.Expr[FromTuple[Z, T]]</code>
type. Therefore we wrap <code>fromTuple</code> into an expression of type <code>c.Expr[FromTuple[Z, T]]</code>.</p>

<p>Here is an example</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">object</span> <span class="nc">MacroApp</span> <span class="k">extends</span> <span class="nc">App</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">case</span> <span class="k">class</span> <span class="nc">Person</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">age</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">val</span> <span class="n">person</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">(</span><span class="s">&quot;John&quot;</span><span class="o">,</span> <span class="mi">40</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">println</span><span class="o">(</span><span class="n">toTuple</span><span class="o">(</span><span class="n">person</span><span class="o">))</span>
</span><span class='line'>  <span class="n">println</span><span class="o">(</span><span class="n">fromTuple</span><span class="o">[</span><span class="kt">Person</span>, <span class="o">(</span><span class="kt">String</span>, <span class="kt">Int</span><span class="o">)]((</span><span class="s">&quot;John&quot;</span><span class="o">,</span> <span class="mi">40</span><span class="o">)))</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>printing</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="o">(</span><span class="nc">John</span><span class="o">,</span><span class="mi">40</span><span class="o">)</span>
</span><span class='line'><span class="nc">Person</span><span class="o">(</span><span class="nc">John</span><span class="o">,</span><span class="mi">40</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Case classes and Maps</h2>

<p>The tranformations
from case classes <code>Z</code> to maps <code>Map[String, Any]</code>
and
from maps <code>Map[String, Any]</code> to case classes <code>Z</code>
can be formalized as follows</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">type</span> <span class="kt">M</span> <span class="o">=</span> <span class="nc">Map</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Any</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">trait</span> <span class="nc">Store</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">store</span><span class="o">(</span><span class="n">z</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">M</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">trait</span> <span class="nc">Load</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">load</span><span class="o">(</span><span class="n">m</span><span class="k">:</span> <span class="kt">M</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>The <code>store</code> and <code>load</code> functions</h2>

<p>It turns out that it is convenient to define <em>implicit macros</em> of type <code>Store[Z]</code> and <code>Load[Z]</code>.
Assuming the existence of such macros, it is also convenient to define functions
<code>store</code> and <code>load</code> that <code>implicitly</code> make use of them</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">def</span> <span class="n">store</span><span class="o">[</span><span class="kt">Z:</span> <span class="kt">Store</span><span class="o">](</span><span class="n">z</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">M</span> <span class="o">=</span>
</span><span class='line'>    <span class="n">implicitly</span><span class="o">[</span><span class="kt">Store</span><span class="o">[</span><span class="kt">Z</span><span class="o">]].</span><span class="n">store</span><span class="o">(</span><span class="n">z</span><span class="o">)</span>
</span><span class='line'>  <span class="k">def</span> <span class="n">load</span><span class="o">[</span><span class="kt">Z:</span> <span class="kt">Load</span><span class="o">](</span><span class="n">m</span><span class="k">:</span> <span class="kt">M</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span>
</span><span class='line'>    <span class="n">implicitly</span><span class="o">[</span><span class="kt">Load</span><span class="o">[</span><span class="kt">Z</span><span class="o">]].</span><span class="n">load</span><span class="o">(</span><span class="n">m</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>An example case class</h2>

<p>Consider the case class</p>

<ul>
<li><code>case class Person(name: String, age: Int)</code></li>
</ul>


<p>Here is the code that a macro should generate to convert a <code>Person</code> instance
to an <code>M</code> instance</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">new</span> <span class="nc">Store</span><span class="o">[</span><span class="kt">Person</span><span class="o">]</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">store</span><span class="o">(</span><span class="n">z</span><span class="k">:</span> <span class="kt">Person</span><span class="o">)</span><span class="k">:</span> <span class="kt">M</span> <span class="o">=</span>
</span><span class='line'>      <span class="nc">Map</span><span class="o">(</span><span class="s">&quot;name&quot;</span> <span class="o">-&gt;</span> <span class="n">z</span><span class="o">.</span><span class="n">name</span><span class="o">,</span> <span class="s">&quot;age&quot;</span> <span class="o">-&gt;</span> <span class="n">z</span><span class="o">.</span><span class="n">age</span><span class="o">)</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here is the code that a macro should generate to convert an <code>M</code> instance
to a <code>Person</code> instance</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">new</span> <span class="nc">Load</span><span class="o">[</span><span class="kt">Person</span><span class="o">]</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">load</span><span class="o">(</span><span class="n">m</span><span class="k">:</span> <span class="kt">M</span><span class="o">)</span><span class="k">:</span> <span class="kt">Person</span> <span class="o">=</span>
</span><span class='line'>      <span class="nc">Person</span><span class="o">(</span><span class="n">m</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">).</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">String</span><span class="o">],</span> <span class="n">m</span><span class="o">(</span><span class="s">&quot;age&quot;</span><span class="o">).</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">Int</span><span class="o">])</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The information that we require at compile time
for being able to generate this code is exactly the same
as when converting from and to tuples, so we can reuse
the <code>getFieldNamesAndTypes</code> method.</p>

<h2>The <code>storeMacro</code> macro</h2>

<p>Using the <code>getFieldNamesAndTypes</code> method we can now define the
implicit <code>storeMacro</code> as follows</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">object</span> <span class="nc">Store</span> <span class="k">extends</span> <span class="nc">Common</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">implicit</span> <span class="k">def</span> <span class="n">storeMacro</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span><span class="k">:</span> <span class="kt">Store</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span> <span class="n">macro</span> <span class="n">storeMacroImpl</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="n">storeMacroImpl</span><span class="o">[</span><span class="kt">Z:</span> <span class="kt">c.WeakTypeTag</span><span class="o">](</span><span class="n">c</span><span class="k">:</span> <span class="kt">Context</span><span class="o">)</span><span class="k">:</span> <span class="kt">c.Expr</span><span class="o">[</span><span class="kt">Store</span><span class="o">[</span><span class="kt">Z</span><span class="o">]]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">import</span> <span class="nn">c.universe._</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">val</span> <span class="n">tpe</span><span class="k">:</span> <span class="kt">Type</span> <span class="o">=</span> <span class="n">weakTypeOf</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">val</span> <span class="n">mpgs</span><span class="k">:</span> <span class="kt">Iterable</span><span class="o">[</span><span class="kt">Apply</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>        <span class="n">getFieldNamesAndTypes</span><span class="o">(</span><span class="n">c</span><span class="o">)(</span><span class="n">tpe</span><span class="o">).</span><span class="n">map</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">case</span> <span class="o">(</span><span class="n">nme</span><span class="o">,</span> <span class="n">tpe</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="n">q</span><span class="s">&quot;&quot;&quot;</span>
</span><span class='line'><span class="s">            ${nme.decoded} -&gt; z.${nme}</span>
</span><span class='line'><span class="s">            &quot;&quot;&quot;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">val</span> <span class="n">store</span><span class="k">:</span> <span class="kt">Tree</span> <span class="o">=</span>
</span><span class='line'>        <span class="n">q</span><span class="s">&quot;&quot;&quot;</span>
</span><span class='line'><span class="s">         new Store[$tpe] {</span>
</span><span class='line'><span class="s">           def store(z: $tpe): M =</span>
</span><span class='line'><span class="s">             Map(..$mpgs)</span>
</span><span class='line'><span class="s">         }</span>
</span><span class='line'><span class="s">         &quot;&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">c</span><span class="o">.</span><span class="nc">Expr</span><span class="o">[</span><span class="kt">Store</span><span class="o">[</span><span class="kt">Z</span><span class="o">]](</span><span class="n">store</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The macro, in this case one of type <code>Store[Z]</code>, is <em>declared</em> using a <code>macro</code> keyword.
The macro is <em>definied</em> using a method of type <code>c.Expr</code>,
in this case of type <code>c.Expr[Store[Z]]</code>.
The method has an extra parameter of type <code>Context</code>.
The macro makes use of <em>quasi-quotes</em>, the preferred way to generate code.
<code>getFieldNamesAndTypes(c)(tpe)</code> can be used to define <em>mappings</em>
<code>mpgs</code> that can be used in the quasi-quote expression that defines <code>store</code>.
The mappings use the field names in two ways: with and without double-quotes.
The variable <code>store</code> has type <code>Tree</code> and the macro needs a <code>c.Expr[Store[Z]]</code>
type. Therefore we wrap <code>store</code> into an expression of type <code>c.Expr[Store[Z]]</code>.</p>

<h2>The <code>loadMacro</code> macro</h2>

<p>Using the <code>getFieldNamesAndTypes</code> method we can now define the
implicit <code>loadMacro</code> as follows</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">object</span> <span class="nc">Load</span> <span class="k">extends</span> <span class="nc">Common</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">implicit</span> <span class="k">def</span> <span class="n">loadMacro</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span><span class="k">:</span> <span class="kt">Load</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span> <span class="n">macro</span> <span class="n">loadMacroImpl</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="n">loadMacroImpl</span><span class="o">[</span><span class="kt">Z:</span> <span class="kt">c.WeakTypeTag</span><span class="o">](</span>
</span><span class='line'>      <span class="n">c</span><span class="k">:</span> <span class="kt">Context</span><span class="o">)</span><span class="k">:</span> <span class="kt">c.Expr</span><span class="o">[</span><span class="kt">Load</span><span class="o">[</span><span class="kt">Z</span><span class="o">]]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">import</span> <span class="nn">c.universe._</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">val</span> <span class="n">tpe</span><span class="k">:</span> <span class="kt">Type</span> <span class="o">=</span> <span class="n">weakTypeOf</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">val</span> <span class="n">args</span><span class="k">:</span> <span class="kt">Iterable</span><span class="o">[</span><span class="kt">Tree</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>        <span class="n">getFieldNamesAndTypes</span><span class="o">(</span><span class="n">c</span><span class="o">)(</span><span class="n">tpe</span><span class="o">).</span><span class="n">map</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">case</span> <span class="o">(</span><span class="n">nme</span><span class="o">,</span> <span class="n">tpe</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>            <span class="n">q</span><span class="s">&quot;&quot;&quot;</span>
</span><span class='line'><span class="s">            m(${nme.decoded}).asInstanceOf[${tpe}]</span>
</span><span class='line'><span class="s">            &quot;&quot;&quot;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">val</span> <span class="n">tpeSym</span><span class="k">:</span> <span class="kt">Symbol</span> <span class="o">=</span> <span class="n">tpe</span><span class="o">.</span><span class="n">typeSymbol</span><span class="o">.</span><span class="n">companionSymbol</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">val</span> <span class="n">load</span><span class="k">:</span> <span class="kt">Tree</span> <span class="o">=</span>
</span><span class='line'>        <span class="n">q</span><span class="s">&quot;&quot;&quot;</span>
</span><span class='line'><span class="s">         new Load[$tpe] {</span>
</span><span class='line'><span class="s">           def load(m: M): $tpe =</span>
</span><span class='line'><span class="s">             ${tpeSym}(..$args)</span>
</span><span class='line'><span class="s">         }</span>
</span><span class='line'><span class="s">         &quot;&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">c</span><span class="o">.</span><span class="nc">Expr</span><span class="o">[</span><span class="kt">Load</span><span class="o">[</span><span class="kt">Z</span><span class="o">]](</span><span class="n">load</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The macro, in this case one of type <code>Load[Z]</code>, is <em>declared</em> using a <code>macro</code> keyword.
The macro is <em>definied</em> using a method of type <code>c.Expr</code>,
in this case of type <code>c.Expr[Load[Z]]</code>.
The method has an extra parameter of type <code>Context</code>.
The macro makes use of <em>quasi-quotes</em>, the preferred way to generate code.
<code>getFieldNamesAndTypes(c)(tpe)</code> can be used to define <em>case class constructor arguments</em>
<code>args</code> that can be used in the quasi-quote expression that defines <code>load</code>.
We also need <code>tpeSym</code> the <em>type symbol</em> of the <em>companion object</em> of the case class.
The variable <code>load</code> has type <code>Tree</code> and the macro needs a <code>c.Expr[Load[Z]]</code>
type. Therefore we wrap <code>load</code> into an expression of type <code>c.Expr[Load[Z]]</code>.</p>

<p>Here is an example</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">object</span> <span class="nc">MacroApp</span> <span class="k">extends</span> <span class="nc">App</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">case</span> <span class="k">class</span> <span class="nc">Person</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">age</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">val</span> <span class="n">person</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">(</span><span class="s">&quot;John&quot;</span><span class="o">,</span> <span class="mi">40</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">println</span><span class="o">(</span><span class="n">store</span><span class="o">(</span><span class="n">person</span><span class="o">))</span>
</span><span class='line'>  <span class="n">println</span><span class="o">(</span><span class="n">load</span><span class="o">[</span><span class="kt">Person</span>, <span class="o">(</span><span class="kt">String</span>, <span class="kt">Int</span><span class="o">)](</span><span class="nc">Map</span><span class="o">(</span><span class="s">&quot;name&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;John&quot;</span><span class="o">,</span> <span class="s">&quot;age&quot;</span> <span class="o">-&gt;</span> <span class="mi">40</span><span class="o">)))</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>printing</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="nc">Map</span><span class="o">(</span><span class="n">name</span> <span class="o">-&gt;</span> <span class="nc">John</span><span class="o">,</span> <span class="n">age</span> <span class="o">-&gt;</span> <span class="mi">40</span><span class="o">)</span>
</span><span class='line'><span class="nc">Person</span><span class="o">(</span><span class="nc">John</span><span class="o">,</span><span class="mi">40</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Loading and Storing other types</h2>

<p>Now that we know how to load and store case class instances, what about other classes?
If there exist <em>bidirectional mappings</em> from a class to a case class, then we can use
those mappings to load and store instances of that class.
The way those bidirectional mappings can be used is formalized as follows</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">def</span> <span class="n">lift</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">Y</span><span class="o">](</span><span class="n">z2y</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=&gt;</span> <span class="n">Y</span><span class="o">)</span><span class="k">:</span> <span class="kt">Load</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="nc">Load</span><span class="o">[</span><span class="kt">Y</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>    <span class="n">lz</span> <span class="k">=&gt;</span> <span class="k">new</span> <span class="nc">Load</span><span class="o">[</span><span class="kt">Y</span><span class="o">]()</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">def</span> <span class="n">load</span><span class="o">(</span><span class="n">m</span><span class="k">:</span> <span class="kt">M</span><span class="o">)</span> <span class="k">=</span> <span class="n">z2y</span><span class="o">(</span><span class="n">lz</span><span class="o">.</span><span class="n">load</span><span class="o">(</span><span class="n">m</span><span class="o">))</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">tfil</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">Y</span><span class="o">](</span><span class="n">z2y</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=&gt;</span> <span class="n">Y</span><span class="o">)</span><span class="k">:</span> <span class="kt">Store</span><span class="o">[</span><span class="kt">Y</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="nc">Store</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>    <span class="n">sy</span> <span class="k">=&gt;</span> <span class="k">new</span> <span class="nc">Store</span><span class="o">[</span><span class="kt">Z</span><span class="o">]()</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">def</span> <span class="n">store</span><span class="o">(</span><span class="n">s</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span> <span class="k">=</span> <span class="n">sy</span><span class="o">.</span><span class="n">store</span><span class="o">(</span><span class="n">z2y</span><span class="o">(</span><span class="n">s</span><span class="o">))</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">lift2load</span><span class="o">[</span><span class="kt">Z:</span> <span class="kt">Load</span>, <span class="kt">Y</span><span class="o">](</span><span class="n">z2y</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=&gt;</span> <span class="n">Y</span><span class="o">)</span><span class="k">:</span> <span class="kt">Load</span><span class="o">[</span><span class="kt">Y</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>    <span class="n">lift</span><span class="o">(</span><span class="n">z2y</span><span class="o">)(</span><span class="n">implicitly</span><span class="o">[</span><span class="kt">Load</span><span class="o">[</span><span class="kt">Z</span><span class="o">]])</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">tfil2store</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">Y:</span> <span class="kt">Store</span><span class="o">](</span><span class="n">z2y</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=&gt;</span> <span class="n">Y</span><span class="o">)</span><span class="k">:</span> <span class="kt">Store</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>    <span class="n">tfil</span><span class="o">(</span><span class="n">z2y</span><span class="o">)(</span><span class="n">implicitly</span><span class="o">[</span><span class="kt">Store</span><span class="o">[</span><span class="kt">Y</span><span class="o">]])</span>
</span></code></pre></td></tr></table></div></figure>


<p>We have called the first function <code>lift</code> and the second one <code>tfil</code> to emphasize that
<code>lift</code> is <em>covariant</em> (the arrow direction is preserved) and
<code>tfil</code> <em>contravariant</em> (the arrow direction has changed).</p>

<p>Here is a first example</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">class</span> <span class="nc">Customer</span><span class="o">(</span><span class="k">val</span> <span class="n">named</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="k">val</span> <span class="n">aged</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">person2customer</span><span class="o">(</span><span class="n">person</span><span class="k">:</span> <span class="kt">Person</span><span class="o">)</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Customer</span><span class="o">(</span><span class="n">person</span><span class="o">.</span><span class="n">name</span><span class="o">,</span> <span class="n">person</span><span class="o">.</span><span class="n">age</span><span class="o">)</span>
</span><span class='line'>  <span class="k">def</span> <span class="n">customer2person</span><span class="o">(</span><span class="n">customer</span><span class="k">:</span> <span class="kt">Customer</span><span class="o">)</span> <span class="k">=</span> <span class="nc">Person</span><span class="o">(</span><span class="n">customer</span><span class="o">.</span><span class="n">named</span><span class="o">,</span> <span class="n">customer</span><span class="o">.</span><span class="n">aged</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">println</span><span class="o">(</span><span class="n">lift2load</span><span class="o">(</span><span class="n">person2customer</span><span class="o">).</span><span class="n">load</span><span class="o">(</span><span class="nc">Map</span><span class="o">(</span><span class="s">&quot;name&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;John&quot;</span><span class="o">,</span> <span class="s">&quot;age&quot;</span> <span class="o">-&gt;</span> <span class="mi">40</span><span class="o">)))</span>
</span><span class='line'>  <span class="n">println</span><span class="o">(</span><span class="n">tfil2store</span><span class="o">(</span><span class="n">customer2person</span><span class="o">).</span><span class="n">store</span><span class="o">(</span><span class="k">new</span> <span class="nc">Customer</span><span class="o">(</span><span class="s">&quot;John&quot;</span><span class="o">,</span> <span class="mi">40</span><span class="o">)))</span>
</span></code></pre></td></tr></table></div></figure>


<p>printing</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="nc">Customer</span><span class="o">(</span><span class="nc">John</span><span class="o">,</span><span class="mi">40</span><span class="o">)</span>
</span><span class='line'><span class="nc">Map</span><span class="o">(</span><span class="n">name</span> <span class="o">-&gt;</span> <span class="nc">John</span><span class="o">,</span> <span class="n">age</span> <span class="o">-&gt;</span> <span class="mi">40</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here is a second example,
making use of the bidirectional mappings from case classes to tuples</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="n">println</span><span class="o">(</span><span class="n">lift2load</span><span class="o">(</span><span class="n">toTuple</span><span class="o">[</span><span class="kt">Person</span>, <span class="o">(</span><span class="kt">String</span>, <span class="kt">Int</span><span class="o">)]).</span><span class="n">load</span><span class="o">(</span><span class="nc">Map</span><span class="o">(</span><span class="s">&quot;name&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;John&quot;</span><span class="o">,</span> <span class="s">&quot;age&quot;</span> <span class="o">-&gt;</span> <span class="mi">40</span><span class="o">)))</span>
</span><span class='line'>  <span class="n">println</span><span class="o">(</span><span class="n">tfil2store</span><span class="o">(</span><span class="n">fromTuple</span><span class="o">[</span><span class="kt">Person</span>, <span class="o">(</span><span class="kt">String</span>, <span class="kt">Int</span><span class="o">)]).</span><span class="n">store</span><span class="o">((</span><span class="s">&quot;John&quot;</span><span class="o">,</span> <span class="mi">40</span><span class="o">)))</span>
</span></code></pre></td></tr></table></div></figure>


<p>printing</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="o">(</span><span class="nc">John</span><span class="o">,</span><span class="mi">40</span><span class="o">)</span>
</span><span class='line'><span class="nc">Map</span><span class="o">(</span><span class="n">name</span> <span class="o">-&gt;</span> <span class="nc">John</span><span class="o">,</span> <span class="n">age</span> <span class="o">-&gt;</span> <span class="mi">40</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Reactive Programming: Schedulers and Workers]]></title>
    <link href="http://www.strongtyped.io/blog/2014/05/20/reactive-programming-schedulers-workers/"/>
    <updated>2014-05-20T09:52:00+02:00</updated>
    <id>http://www.strongtyped.io/blog/2014/05/20/reactive-programming-schedulers-workers</id>
    <content type="html"><![CDATA[<p>This is a third blog post about <em>Reactive Programming in Scala</em>.
The first two blog posts,
<a href="http://www.strongtyped.io/blog/2014/05/11/reactive-programming-try-future"><em>Reactive Programming: Try versus Future</em></a>
resp.
<a href="http://www.strongtyped.io/blog/2014/05/14/reactive-programming-notification-observable"><em>Reactive Programming: Notification versus Observable</em></a>,
covered reactive programs resulting in <em>one value</em> resp. <em>many values</em>.
This blog post covers <em>schedulers</em> and <em>workers</em>.
They are used to transform <em>iterables</em> to <em>observables</em>.
As mentioned in
<a href="http://www.strongtyped.io/blog/2014/05/14/reactive-programming-notification-observable"><em>Reactive Programming: Notification versus Observable</em></a>,
the transformation from iterables to observables is not as trivial as it looks: at any moment subscribed observers should be able to unsubscribe.</p>

<p><strong>Remark:</strong>
The types that are used in this blog post exist in the
<a href="https://github.com/Netflix/RxJava/tree/master/language-adaptors/rxjava-scala">Scala Adaptor for RxJava</a> library.
We refer to this library as the RxScala library.
In contrast with the previous two blog posts, this blog post deals with only one function: <code>iterable2observable</code>.
Moreover, the <code>Observable</code> companion object of the RxScala library already has a <code>from</code> method, having an iterable parameter,
that is equivalent to <code>iterable2observable</code>.
Dedicating a separate blog post on the definition of <code>iterable2observable</code> is done for didactical reasons only.</p>

<!-- more -->


<h2>A first attempt: the <code>iterable2observable01</code> function</h2>

<p>In the
<a href="http://www.strongtyped.io/blog/2014/05/14/reactive-programming-notification-observable"><em>Reactive Programming: Notification versus Observable</em></a> blog post
we defined a function <code>mkObservable</code> with the following signature</p>

<ul>
<li><code>def mkObservable[Z](sz2u: Subscriber[Z] =&gt; Unit): Observable[Z]</code></li>
</ul>


<p>The function <code>mkObservable</code> can be used to define an observable by defining what it pushes to subscribed observers.
Using <code>mkObservable</code> we can naturally define a function <code>iterable2observable01</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">def</span> <span class="n">iterable2observable01</span><span class="o">[</span><span class="kt">Z</span><span class="o">](</span><span class="n">iz</span><span class="k">:</span> <span class="kt">Iterable</span><span class="o">[</span><span class="kt">Z</span><span class="o">])</span><span class="k">:</span> <span class="kt">Observable</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>    <span class="n">mkObservable</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="o">{</span> <span class="n">sz</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="n">iz</span><span class="o">.</span><span class="n">foreach</span> <span class="o">{</span> <span class="n">z</span> <span class="k">=&gt;</span> <span class="n">sz</span><span class="o">.</span><span class="n">onNext</span><span class="o">(</span><span class="n">z</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'>      <span class="n">sz</span><span class="o">.</span><span class="n">onCompleted</span><span class="o">()</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>describe a computation <code>observable01</code> using <code>iterable2observable01</code>,
and use the computation <code>observable01</code> as follows</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="o">{</span>
</span><span class='line'>     <span class="k">lazy</span> <span class="k">val</span> <span class="n">observable01</span> <span class="k">=</span> <span class="n">iterable2observable01</span><span class="o">((</span><span class="mi">1</span> <span class="n">to</span> <span class="mi">10</span><span class="o">).</span><span class="n">toList</span><span class="o">)</span>
</span><span class='line'>     <span class="k">val</span> <span class="n">subscription01</span> <span class="k">=</span> <span class="n">subscribe</span><span class="o">(</span><span class="n">observable01</span><span class="o">)</span>
</span><span class='line'>     <span class="n">subscription01</span><span class="o">.</span><span class="n">unsubscribe</span><span class="o">()</span>
</span><span class='line'>     <span class="n">println</span><span class="o">()</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>resulting in <code>12345678910completed</code> being printed.</p>

<p>It looks as if <code>unsubscribe</code> does not really work.</p>

<h2>A second attempt: the <code>iterable2observable02</code> function</h2>

<p>Maybe we should run the code</p>

<ul>
<li><code>iz.foreach { z =&gt; sz.onNext(z) } ; sz.onCompleted()</code></li>
</ul>


<p>in a separate thread, so that we can unscubscribe from the main thread.</p>

<p>Using <em>schedulers</em>, and <em>workers</em> that can be created using them,
we can naturally define a function <code>iterable2observable02</code>
that schedules the code above to run after a <em>delay</em> of duration <code>delay</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">def</span> <span class="n">iterable2observable02</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>   <span class="o">(</span><span class="n">iz</span><span class="k">:</span> <span class="kt">Iterable</span><span class="o">[</span><span class="kt">Z</span><span class="o">],</span> <span class="n">delay</span><span class="k">:</span> <span class="kt">Duration</span><span class="o">)</span>
</span><span class='line'>   <span class="o">(</span><span class="k">implicit</span> <span class="n">scheduler</span><span class="k">:</span> <span class="kt">Scheduler</span><span class="o">)</span><span class="k">:</span> <span class="kt">Observable</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>     <span class="k">val</span> <span class="n">iterator</span> <span class="k">=</span> <span class="n">iz</span><span class="o">.</span><span class="n">iterator</span>
</span><span class='line'>     <span class="n">mkObservable</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="o">{</span> <span class="n">sz</span> <span class="k">=&gt;</span>
</span><span class='line'>       <span class="n">scheduler</span><span class="o">.</span><span class="n">createWorker</span><span class="o">.</span><span class="n">schedule</span><span class="o">({</span> <span class="k">_</span> <span class="k">=&gt;</span>
</span><span class='line'>         <span class="n">iz</span><span class="o">.</span><span class="n">foreach</span> <span class="o">{</span> <span class="n">z</span> <span class="k">=&gt;</span> <span class="n">sz</span><span class="o">.</span><span class="n">onNext</span><span class="o">(</span><span class="n">z</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'>          <span class="n">sz</span><span class="o">.</span><span class="n">onCompleted</span><span class="o">()</span>
</span><span class='line'>       <span class="o">},</span> <span class="n">delay</span><span class="o">)</span>
</span><span class='line'>     <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>describe a computation <code>observable02</code> using <code>iterable2observable02</code>,
and use the computation <code>observable02</code> as follows</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="o">{</span>
</span><span class='line'>     <span class="k">implicit</span> <span class="k">val</span> <span class="n">scheduler</span> <span class="k">=</span> <span class="nc">NewThreadScheduler</span><span class="o">()</span>
</span><span class='line'>     <span class="k">lazy</span> <span class="k">val</span> <span class="n">observable02</span> <span class="k">=</span> <span class="n">iterable2observable02</span><span class="o">((</span><span class="mi">1</span> <span class="n">to</span> <span class="mi">10</span><span class="o">).</span><span class="n">toList</span><span class="o">,</span> <span class="mi">1</span> <span class="n">second</span><span class="o">)</span>
</span><span class='line'>     <span class="k">val</span> <span class="n">subscription02</span> <span class="k">=</span> <span class="n">subscribe</span><span class="o">(</span><span class="n">observable02</span><span class="o">)</span>
</span><span class='line'>     <span class="n">subscription02</span><span class="o">.</span><span class="n">unsubscribe</span><span class="o">()</span>
</span><span class='line'>     <span class="nc">Thread</span><span class="o">.</span><span class="n">sleep</span><span class="o">(</span><span class="mi">990</span><span class="o">)</span>
</span><span class='line'>     <span class="n">println</span><span class="o">()</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>resulting in nothing being printed at all,</p>

<p>or as follows</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="o">{</span>
</span><span class='line'>     <span class="k">implicit</span> <span class="k">val</span> <span class="n">scheduler</span> <span class="k">=</span> <span class="nc">NewThreadScheduler</span><span class="o">()</span>
</span><span class='line'>     <span class="k">lazy</span> <span class="k">val</span> <span class="n">observable02</span> <span class="k">=</span> <span class="n">iterable2observable02</span><span class="o">((</span><span class="mi">1</span> <span class="n">to</span> <span class="mi">10</span><span class="o">).</span><span class="n">toList</span><span class="o">,</span> <span class="mi">1</span> <span class="n">second</span><span class="o">)</span>
</span><span class='line'>     <span class="k">val</span> <span class="n">subscription02</span> <span class="k">=</span> <span class="n">subscribe</span><span class="o">(</span><span class="n">observable02</span><span class="o">)</span>
</span><span class='line'>     <span class="n">subscription02</span><span class="o">.</span><span class="n">unsubscribe</span><span class="o">()</span>
</span><span class='line'>     <span class="nc">Thread</span><span class="o">.</span><span class="n">sleep</span><span class="o">(</span><span class="mi">1010</span><span class="o">)</span>
</span><span class='line'>     <span class="n">println</span><span class="o">()</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>resulting in <code>12345678910completed</code> being printed.</p>

<p>Ok, we have some period of time during which we can unsubscribe,
but, once the observable starts pushing we cannot unsubscribe any more.</p>

<p>It looks as if <code>unsubscribe</code> still does not work.</p>

<h2>A final attempt: the <code>iterable2observable</code> function</h2>

<p>The <em>first</em> idea behind the <code>iterable2observable</code> function is to replace the iterative code</p>

<ul>
<li><code>iz.foreach { z =&gt; sz.onNext(z) } ; sz.onCompleted()</code></li>
</ul>


<p>where <code>iz</code> is an <em>iterable</em>, or, equivalently, the iterative code</p>

<ul>
<li><code>while(iz.hasNext) { sz.onNext(iz.next()) } ; sz.onCompleted()</code></li>
</ul>


<p>where <code>iz</code> is an <em>iterator</em>, by code</p>

<ul>
<li><code>if(iz.hasNext) sz.onNext(iz.next()) else sz.onCompleted()</code></li>
</ul>


<p>where <code>iz</code> is an iterator, and, somehow, do the iteration steps ourselves.</p>

<p>The <em>second</em> idea behind the <code>iterable2observable</code> function is to not only
have a <em>delay</em> of a certain duration <em>before the first iteration step</em>, but to also
have a <em>period</em> of a certain duration <em>between consecutive iteration steps</em>.</p>

<p>The <em>third</em> idea behind the <code>iterable2observable</code> function is to work with a
<em>multi assignment subscription</em> that is updated during every iteration step.</p>

<p>The <code>iterativeSchedule</code> method below uses those three ideas</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">implicit</span> <span class="k">class</span> <span class="nc">WorkerOps</span><span class="o">(</span><span class="n">worker</span><span class="k">:</span> <span class="kt">Worker</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">iterativeSchedule</span>
</span><span class='line'>      <span class="o">(</span><span class="n">delay</span><span class="k">:</span> <span class="kt">Duration</span><span class="o">,</span> <span class="n">period</span><span class="k">:</span> <span class="kt">Duration</span><span class="o">)</span>
</span><span class='line'>      <span class="o">(</span><span class="n">action</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=&gt;</span> <span class="nc">Unit</span><span class="o">)</span><span class="k">:</span> <span class="kt">Subscription</span> <span class="o">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">val</span> <span class="n">multipleAssignmentSubscription</span> <span class="k">=</span> <span class="nc">MultipleAssignmentSubscription</span><span class="o">();</span>
</span><span class='line'>      <span class="k">lazy</span> <span class="k">val</span> <span class="n">recursiveAction</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=&gt;</span> <span class="nc">Unit</span> <span class="k">=</span> <span class="k">_</span> <span class="k">=&gt;</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">var</span> <span class="n">count</span><span class="k">:</span> <span class="kt">Long</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>        <span class="k">if</span><span class="o">(!</span><span class="n">multipleAssignmentSubscription</span><span class="o">.</span><span class="n">isUnsubscribed</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>           <span class="n">action</span><span class="o">(())</span>
</span><span class='line'>           <span class="n">count</span> <span class="k">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
</span><span class='line'>           <span class="n">multipleAssignmentSubscription</span><span class="o">.</span><span class="n">subscription</span> <span class="k">=</span>
</span><span class='line'>             <span class="n">worker</span><span class="o">.</span><span class="n">schedule</span><span class="o">(</span><span class="n">recursiveAction</span><span class="o">,</span> <span class="n">delay</span> <span class="o">+</span> <span class="n">count</span> <span class="o">*</span> <span class="n">period</span><span class="o">)</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>      <span class="n">multipleAssignmentSubscription</span><span class="o">.</span><span class="n">subscription</span> <span class="k">=</span>
</span><span class='line'>        <span class="n">worker</span><span class="o">.</span><span class="n">schedule</span><span class="o">(</span><span class="n">recursiveAction</span><span class="o">,</span> <span class="n">delay</span><span class="o">)</span>
</span><span class='line'>      <span class="n">multipleAssignmentSubscription</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>We used a <code>var count</code> as a counter. You may argue: how ugly!
Well, in a way, using a <code>var</code> as an <em>internal implementation detail</em> is not ugly at all.
Erik Meijer (the brain behind the Rx extensions of .NET, upon which RxJava
and RxScala are based) calls himself <em>&ldquo;both a functional thinker and an imperative hacker&rdquo;</em>.</p>

<p>We can now naturally define a function <code>iterable2observable</code>
that schedules the code</p>

<ul>
<li><code>if(iz.hasNext) sz.onNext(iz.next()) else sz.onCompleted()</code></li>
</ul>


<p>to run for the first time after a delay of a duration <code>delay</code>,
and to also continue running after delays of duration <code>delay + count * period</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">private</span> <span class="k">def</span> <span class="n">iterator2observable</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="o">(</span><span class="n">iz</span><span class="k">:</span> <span class="kt">Iterator</span><span class="o">[</span><span class="kt">Z</span><span class="o">],</span> <span class="n">delay</span><span class="k">:</span> <span class="kt">Duration</span><span class="o">,</span> <span class="n">period</span><span class="k">:</span> <span class="kt">Duration</span><span class="o">)</span>
</span><span class='line'>    <span class="o">(</span><span class="k">implicit</span> <span class="n">scheduler</span><span class="k">:</span> <span class="kt">Scheduler</span><span class="o">)</span><span class="k">:</span> <span class="kt">Observable</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>      <span class="n">mkObservable</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="o">{</span> <span class="n">sz</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">scheduler</span><span class="o">.</span><span class="n">createWorker</span><span class="o">.</span><span class="n">iterativeSchedule</span><span class="o">(</span><span class="n">delay</span><span class="o">,</span> <span class="n">period</span><span class="o">)</span> <span class="o">{</span> <span class="k">_</span> <span class="k">=&gt;</span>
</span><span class='line'>          <span class="k">if</span><span class="o">(</span><span class="n">iz</span><span class="o">.</span><span class="n">hasNext</span><span class="o">)</span> <span class="n">sz</span><span class="o">.</span><span class="n">onNext</span><span class="o">(</span><span class="n">iz</span><span class="o">.</span><span class="n">next</span><span class="o">())</span>
</span><span class='line'>          <span class="k">else</span> <span class="n">sz</span><span class="o">.</span><span class="n">onCompleted</span><span class="o">()</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">iterable2observable</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="o">(</span><span class="n">iz</span><span class="k">:</span> <span class="kt">Iterable</span><span class="o">[</span><span class="kt">Z</span><span class="o">],</span> <span class="n">delay</span><span class="k">:</span> <span class="kt">Duration</span><span class="o">,</span> <span class="n">period</span><span class="k">:</span> <span class="kt">Duration</span><span class="o">)</span>
</span><span class='line'>    <span class="o">(</span><span class="k">implicit</span> <span class="n">scheduler</span><span class="k">:</span> <span class="kt">Scheduler</span><span class="o">)</span><span class="k">:</span> <span class="kt">Observable</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>    <span class="n">iterator2observable</span><span class="o">(</span><span class="n">iz</span><span class="o">.</span><span class="n">iterator</span><span class="o">,</span> <span class="n">delay</span><span class="o">,</span> <span class="n">period</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can now describe a computation <code>observable</code> using <code>iterable2observable</code>,
and use the computation <code>observable</code> as follows</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="o">{</span>
</span><span class='line'>     <span class="k">implicit</span> <span class="k">val</span> <span class="n">scheduler</span> <span class="k">=</span> <span class="nc">NewThreadScheduler</span><span class="o">()</span>
</span><span class='line'>     <span class="k">lazy</span> <span class="k">val</span> <span class="n">observable</span> <span class="k">=</span> <span class="n">iterable2observable</span><span class="o">((</span><span class="mi">1</span> <span class="n">to</span> <span class="mi">10</span><span class="o">).</span><span class="n">toList</span><span class="o">,</span> <span class="mi">0</span> <span class="n">second</span><span class="o">,</span> <span class="mi">1</span> <span class="n">second</span><span class="o">)</span>
</span><span class='line'>     <span class="k">val</span> <span class="n">subscription</span> <span class="k">=</span> <span class="n">subscribe</span><span class="o">(</span><span class="n">observable</span><span class="o">)</span>
</span><span class='line'>     <span class="nc">Thread</span><span class="o">.</span><span class="n">sleep</span><span class="o">(</span><span class="mi">4500</span><span class="o">)</span>
</span><span class='line'>     <span class="n">subscription</span><span class="o">.</span><span class="n">unsubscribe</span><span class="o">()</span>
</span><span class='line'>     <span class="n">println</span><span class="o">()</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>resulting in <code>12345</code> being printed.</p>

<h2>Infinite Observables</h2>

<p>The code below also works with <em>infinite iterables</em> like the <code>nats</code> iterable below</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">def</span> <span class="n">nats</span><span class="k">:</span> <span class="kt">Iterable</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Iterable</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">var</span> <span class="n">i</span> <span class="k">=</span> <span class="mi">0</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">iterator</span><span class="k">:</span> <span class="kt">Iterator</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Iterator</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">def</span> <span class="n">hasNext</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">true</span>
</span><span class='line'>      <span class="k">def</span> <span class="n">next</span><span class="o">()</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">i</span> <span class="k">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span><span class='line'>        <span class="n">i</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can now describe a computation <code>natsObservable</code> using <code>iterable2observable</code>
and use the computation <code>natsObservable</code> as follows</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="o">{</span>
</span><span class='line'>     <span class="k">implicit</span> <span class="k">val</span> <span class="n">scheduler</span> <span class="k">=</span> <span class="nc">NewThreadScheduler</span><span class="o">()</span>
</span><span class='line'>     <span class="k">lazy</span> <span class="k">val</span> <span class="n">natsObservable</span> <span class="k">=</span> <span class="n">iterable2observable</span><span class="o">(</span><span class="n">nats</span><span class="o">,</span> <span class="mi">0</span> <span class="n">second</span><span class="o">,</span> <span class="mi">1</span> <span class="n">second</span><span class="o">)</span>
</span><span class='line'>     <span class="k">val</span> <span class="n">natsSubscription</span> <span class="k">=</span> <span class="n">subscribe</span><span class="o">(</span><span class="n">natsObservable</span><span class="o">)</span>
</span><span class='line'>     <span class="nc">Thread</span><span class="o">.</span><span class="n">sleep</span><span class="o">(</span><span class="mi">4500</span><span class="o">)</span>
</span><span class='line'>     <span class="n">natsSubscription</span><span class="o">.</span><span class="n">unsubscribe</span><span class="o">()</span>
</span><span class='line'>     <span class="n">println</span><span class="o">()</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>resulting in <code>12345</code> being printed</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Reactive Programming: Notification Versus Observable]]></title>
    <link href="http://www.strongtyped.io/blog/2014/05/14/reactive-programming-notification-observable/"/>
    <updated>2014-05-14T08:25:00+02:00</updated>
    <id>http://www.strongtyped.io/blog/2014/05/14/reactive-programming-notification-observable</id>
    <content type="html"><![CDATA[<p>This is a second of two blog posts about <em>Reactive Programming in Scala</em>.
The first blog post about <a href="http://www.strongtyped.io/blog/2014/05/11/reactive-programming-try-future"><em>Reactive Programming: Try versus Future</em></a>
covered <em>reactive programs resulting in one value</em>.
This second blog post covers <em>reactive programs resulting in many (zero or more) values</em>.</p>

<p><strong>Remark:</strong>
The types that are used in this blog post exist in the
<a href="https://github.com/Netflix/RxJava/tree/master/language-adaptors/rxjava-scala">Scala Adaptor for RxJava</a> library.
We refer to this library as the RxScala library.
In contrast with the previous blog post, this blog post puts less emphasis on how
to <em>define</em> computations. It puts more emphasis on how to <em>use</em> computations.</p>

<!-- more -->


<h2>The <code>Notification</code> type</h2>

<p>The <code>Notification</code> type plays a role similar to the <code>Try</code> type, but
it is not considered as a <em>computation</em> type (although it could be).
Just like <code>Try</code> is a type that is similar to <code>Option</code>,
<code>Notification</code> is a type that is similar to <code>Iterable</code>
(but they both also somehow deal with failure).</p>

<p>The <code>Notification</code> trait represents a value that is
a <em>next</em> value, an <em>error value</em> or a <em>marker value</em>
indicating that there are no more values.
An instance of <code>Notification[Z]</code> is
an instance of <code>OnNext[Z]</code> holding a value of type <code>Z</code>,
an instance of <code>OnError[Z]</code> holding an error of type <code>Throwable</code>
or an instance of <code>OnCompleted[Z]</code> holding no value at all.</p>

<p>Code that makes use a value <code>nz</code> of type <code>Notification[Z]</code>,
typically, makes use of a <code>match</code> on <code>nz</code>, which, you can think of as code that</p>

<ul>
<li>in a synchronous (blocking) way, <em>pulls</em> a
next value, error value or marker non-value
out of <code>nz</code>.</li>
</ul>


<p>In fact, this blog post is rarely uses notifications directly in this way.
Much in the spirit of reactive programming,
and as the names of the classes extending <code>Notification</code> suggest,
notifications values are at their best when used as values that
are <em>pushed</em> rather than <em>pulled</em>.</p>

<p>Notifications values can, just as computations of type <code>Try</code>, be materialized.
This blog post does not go into details.</p>

<h2>Computations of type <code>Observable</code></h2>

<p>A value of type <code>Notification[Z]</code> that is defined as a <code>def</code>
is essentially the same as a value of type <code>Unit =&gt; Notification[Z]</code>.
The <em>dual</em> of such a value, obtained by reversing the arrow <code>=&gt;</code>,
is a value of type <code>Notification[Z] =&gt; Unit</code>.
This dual is, in a way, the same as a value of type <code>Observer[Z]</code>
since the <code>Observer[-Z]</code> trait of RxScala has three methods</p>

<ul>
<li><code>def onNext(value: Z): Unit</code></li>
<li><code>def onError(error: Throwable): Unit</code></li>
<li><code>def onCompleted(): Unit</code></li>
</ul>


<p>In a way (as illustrated in the following section)
an <code>Observable[Z]</code> value is the <em>dual</em> of an <code>Observer[Z]</code> value,
and, as such, the <em>bi-dual</em> of a <code>Notification[Z]</code> value.</p>

<p>More precisely, in a way, <code>Observable[Z]</code> is the same as <code>Observer[Z] =&gt; Unit</code>,
which, in a way, is the same as <code>(Notification[Z] =&gt; Unit) =&gt; Unit</code>.</p>

<p>This <em>bi-duality</em> turns out to transform synchronous values of type <code>Notification</code>
into asynchronous computations of type <code>Observable</code>.</p>

<h2>Materializing failure and latency using <code>mkObservable</code></h2>

<p>Just as the code in the <a href="http://www.strongtyped.io/blog/2014/05/11/reactive-programming-try-future">previous blog post</a> did for <code>Future</code>
the code below materializes failure and latency for <code>Observable</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">def</span> <span class="n">mkObservable</span><span class="o">[</span><span class="kt">Z</span><span class="o">](</span><span class="n">sz2u</span><span class="k">:</span> <span class="kt">Subscriber</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="nc">Unit</span><span class="o">)</span><span class="k">:</span> <span class="kt">Observable</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>    <span class="nc">Observable</span><span class="o">(</span><span class="n">sz2u</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <code>Observable</code> companion object of the RxScala library has an <code>apply</code> method
that we use (in a trivial way) to define <code>mkObservable</code>.
The definition of <code>mkObservable</code> is given for consistency reasons only
(cfr. <code>mkTry</code> and <code>mkFuture</code> of the <a href="http://www.strongtyped.io/blog/2014/05/11/reactive-programming-try-future"> previous blog post</a>).</p>

<p>We did not define <code>Subscriber[Z]</code> yet. Below is its definition</p>

<ul>
<li><code>trait Subscriber[-Z] extends Observer[Z] with Subscription</code></li>
</ul>


<p>So, a subscriber is just a special observer.</p>

<p>When considering <code>mkObservable</code> as the <em>only</em> way to
make an observable, in a way, <code>Observable[Z]</code> becomes the same as <code>Observer[Z] =&gt; Unit</code>.</p>

<p>An observer can <em>subscribe</em> to an observable as shown by the following method of the <code>Observable[Z]</code> class below</p>

<ul>
<li><code>def subscribe(observer: Observer[T]): Subscription</code></li>
</ul>


<p>We did not define <code>Subscription</code> yet. It is a trait with the following methods</p>

<ul>
<li><code>def isUnsubscribed: Boolean</code></li>
<li><code>def unsubscribe(): Unit</code></li>
</ul>


<p>The main reason why <em>subscriptions</em> exist is because observables
push <em>many</em> values to subscribed observers and there should be a way for subscribed observers to
unsubscribe from a subscription so that no more values are pushed to them.</p>

<p>It is important that you understand the <em>usage</em> of <code>mkObservable</code></p>

<ul>
<li>you can make an observable by defining what it <em>pushes</em> to subscribed observers</li>
</ul>


<p>Not surprising, a computation of type <code>Future</code> can be transformed to a computation
of type <code>Observable</code> using this idea</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">def</span> <span class="n">future2observable</span><span class="o">[</span><span class="kt">Z</span><span class="o">](</span><span class="n">fz</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="nc">Future</span><span class="o">[</span><span class="kt">Z</span><span class="o">])</span><span class="k">:</span> <span class="kt">Observable</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>    <span class="nc">Observable</span> <span class="o">{</span> <span class="n">sz</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="n">fz</span><span class="o">.</span><span class="n">register</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">case</span> <span class="nc">Success</span><span class="o">(</span><span class="n">z</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>          <span class="n">sz</span><span class="o">.</span><span class="n">onNext</span><span class="o">(</span><span class="n">z</span><span class="o">)</span>
</span><span class='line'>          <span class="n">sz</span><span class="o">.</span><span class="n">onCompleted</span><span class="o">()</span>
</span><span class='line'>        <span class="k">case</span> <span class="nc">Failure</span><span class="o">(</span><span class="n">t</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>          <span class="n">sz</span><span class="o">.</span><span class="n">onError</span><span class="o">(</span><span class="n">t</span><span class="o">)</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <code>future2observable</code> code makes use of a call by name parameter <code>fz</code>.</p>

<p>The example below illustrates how to use <code>future2observable</code> to transform a computation
of type <code>Try</code> to a computation of type <code>Observable</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">def</span> <span class="n">try2observable</span><span class="o">[</span><span class="kt">Z</span><span class="o">](</span><span class="n">tz</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="nc">Try</span><span class="o">[</span><span class="kt">Z</span><span class="o">])</span><span class="k">:</span> <span class="kt">Observable</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>    <span class="n">future2observable</span><span class="o">(</span><span class="n">try2future</span><span class="o">(</span><span class="n">tz</span><span class="o">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <code>try2future</code> function for computations of type <code>Try</code> could naturally be reused.</p>

<p>The example below illustrates how to use <code>try2observable</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">def</span> <span class="n">mkObservableTry</span><span class="o">[</span><span class="kt">Z</span><span class="o">](</span><span class="n">block</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="n">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Observable</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>    <span class="n">try2observable</span><span class="o">(</span><span class="n">mkTry</span><span class="o">{</span> <span class="n">block</span> <span class="o">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <code>mkTry</code> function for computations of type <code>Try</code> could naturally be reused.</p>

<p>The <code>mkObservableTry</code> code makes use of a <em>call by name</em> parameter <code>block</code>
which you can think of as code that
on the one hand, <em>can succeed</em> or <em>can fail</em> and,
on the other hand, <em>can take some time to be evaluated</em>.</p>

<p>There is one concept that we did not explain yet.
In the <a href="http://www.strongtyped.io/blog/2014/05/11/reactive-programming-try-future">previous blog post</a>
the type <code>Promise[Z]</code> is used in the implementation of many methods.
We also pounted out that it is a useful type on its own.
There exists a corresponding concept that is formalized as</p>

<ul>
<li><code>trait Subject[-Z] extends Observer[-Z] with Observable[+Z]</code></li>
</ul>


<p>It is possible, and often useful, to define observables directly in terms of
<em>various kinds of</em> subjects (<code>Subject</code> is a trait).
This blog post does not go into details.</p>

<p>How are computations of type <code>Future</code> described?</p>

<h2>Describing Computations of type <code>Observable</code></h2>

<p>Here are four computations of type <code>Observable</code> that are described using <code>future2observable</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="k">:</span><span class="kt">paste</span>
</span><span class='line'><span class="c1">// Entering paste mode (ctrl-D to finish)</span>
</span><span class='line'>
</span><span class='line'><span class="k">lazy</span> <span class="k">val</span> <span class="n">tryObservableFooBar05</span><span class="k">:</span> <span class="kt">Observable</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>  <span class="n">future2observable</span><span class="o">(</span><span class="n">tryFutureFooBar05</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">lazy</span> <span class="k">val</span> <span class="n">tryObservableFooBar06</span><span class="k">:</span> <span class="kt">Observable</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>  <span class="n">future2observable</span><span class="o">(</span><span class="n">tryFutureFooBar06</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">lazy</span> <span class="k">val</span> <span class="n">tryObservableFooBar07</span><span class="k">:</span> <span class="kt">Observable</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>  <span class="n">future2observable</span><span class="o">(</span><span class="n">tryFutureFooBar07</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">lazy</span> <span class="k">val</span> <span class="n">tryObservableFooBar08</span><span class="k">:</span> <span class="kt">Observable</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>  <span class="n">future2observable</span><span class="o">(</span><span class="n">tryFutureFooBar08</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// Exiting paste mode, now interpreting.</span>
</span><span class='line'>
</span><span class='line'><span class="n">tryObservableFooBar05</span><span class="k">:</span> <span class="kt">rx.lang.scala.Observable</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">&lt;</span><span class="k">lazy</span><span class="o">&gt;</span>
</span><span class='line'><span class="n">tryObservableFooBar06</span><span class="k">:</span> <span class="kt">rx.lang.scala.Observable</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">&lt;</span><span class="k">lazy</span><span class="o">&gt;</span>
</span><span class='line'><span class="n">tryObservableFooBar07</span><span class="k">:</span> <span class="kt">rx.lang.scala.Observable</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">&lt;</span><span class="k">lazy</span><span class="o">&gt;</span>
</span><span class='line'><span class="n">tryObservableFooBar08</span><span class="k">:</span> <span class="kt">rx.lang.scala.Observable</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">&lt;</span><span class="k">lazy</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The examples make use of computations of type <code>Future</code>
from <a href="http://www.strongtyped.io/blog/2014/05/11/reactive-programming-try-future">the previous blog post</a></p>

<p>How are computations of type <code>Observable</code> <em>executed</em> once they are described?</p>

<h2>Executing Computations of type <code>Observable</code></h2>

<p>For the purpose of this series of blog posts,
executing a computation of type <code>Observable</code> can be as simple as
subscribing an observer that prints the values pushed to it, or
prints the message of an error pushed to it, or
prints an indication that no more more values are pushed.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">def</span> <span class="n">subscribe</span><span class="o">[</span><span class="kt">Z</span><span class="o">](</span><span class="n">oz</span><span class="k">:</span> <span class="kt">Observable</span><span class="o">[</span><span class="kt">Z</span><span class="o">])</span><span class="k">:</span> <span class="kt">Subscription</span> <span class="o">=</span>
</span><span class='line'>    <span class="n">oz</span><span class="o">.</span><span class="n">subscribe</span><span class="o">(</span><span class="k">new</span> <span class="nc">Observer</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">def</span> <span class="n">onNext</span><span class="o">(</span><span class="n">z</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span> <span class="k">=</span> <span class="n">print</span><span class="o">(</span><span class="n">s</span><span class="s">&quot;$z&quot;</span><span class="o">)</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">def</span> <span class="n">onError</span><span class="o">(</span><span class="n">t</span><span class="k">:</span> <span class="kt">Throwable</span><span class="o">)</span> <span class="k">=</span> <span class="n">print</span><span class="o">(</span><span class="n">s</span><span class="s">&quot;${t.getMessage}&quot;</span><span class="o">)</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">def</span> <span class="n">onCompleted</span><span class="o">()</span> <span class="k">=</span> <span class="n">print</span><span class="o">(</span><span class="s">&quot;completed&quot;</span><span class="o">)</span>
</span><span class='line'>  <span class="o">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>We have called the method <code>subscribe</code> instead of <code>execute</code>
because it corresponds to a <code>subscribe</code> method of <code>Observable</code> that,
in this case , also returns a subscription that can be unsubscribed.</p>

<p>Below, the four computations of type <code>Observable</code> are executed using <code>subscribe</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="o">{</span> <span class="n">subscribe</span><span class="o">(</span><span class="n">tryObservableFooBar05</span><span class="o">)</span> <span class="o">;</span> <span class="n">work</span><span class="o">(</span><span class="-Symbol">&#39;W</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">150</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="n">B54</span><span class="o">.</span><span class="n">F194</span><span class="o">.</span><span class="n">W192</span><span class="o">.</span><span class="n">B54</span><span class="o">.</span><span class="n">F194</span><span class="o">.</span><span class="n">B54</span><span class="o">.</span><span class="n">B54</span><span class="o">.</span><span class="n">W192</span><span class="o">.</span><span class="n">F194</span><span class="o">.</span><span class="n">B54</span><span class="o">.</span><span class="n">B54</span><span class="o">.</span><span class="n">F194</span><span class="o">.</span><span class="n">B54</span><span class="o">.</span><span class="n">W192</span><span class="o">.</span><span class="n">B54</span><span class="o">.</span><span class="n">F194</span><span class="o">.</span><span class="n">B54</span><span class="o">.</span><span class="n">B54</span><span class="o">.</span><span class="n">W192</span><span class="o">.</span>
</span><span class='line'><span class="n">F194</span><span class="o">.</span><span class="n">F194</span><span class="o">.</span><span class="n">W192</span><span class="o">.</span><span class="n">F194</span><span class="o">.</span><span class="n">W192</span><span class="o">.</span><span class="n">F194</span><span class="o">.</span><span class="n">F194</span><span class="o">.</span><span class="n">W192</span><span class="o">.</span><span class="n">fooOkbarOkcompletedW192</span><span class="o">.</span><span class="n">W192</span><span class="o">.</span><span class="n">W192</span><span class="o">.</span>
</span><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="o">{</span> <span class="n">subscribe</span><span class="o">(</span><span class="n">tryObservableFooBar06</span><span class="o">)</span> <span class="o">;</span> <span class="n">work</span><span class="o">(</span><span class="-Symbol">&#39;W</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">150</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="n">B54</span><span class="o">.</span><span class="n">F196</span><span class="o">.</span><span class="n">W192</span><span class="o">.</span><span class="n">B54</span><span class="o">.</span><span class="n">B54</span><span class="o">.</span><span class="n">F196</span><span class="o">.</span><span class="n">B54</span><span class="o">.</span><span class="n">W192</span><span class="o">.</span><span class="n">F196</span><span class="o">.</span><span class="n">B54</span><span class="o">.</span><span class="n">B54</span><span class="o">.</span><span class="n">F196</span><span class="o">.</span><span class="n">W192</span><span class="o">.</span><span class="n">B54</span><span class="o">.</span><span class="n">B54</span><span class="o">.</span><span class="n">F196</span><span class="o">.</span><span class="n">B54</span><span class="o">.</span><span class="n">W192</span><span class="o">.</span><span class="n">B54</span><span class="o">.</span>
</span><span class='line'><span class="n">F196</span><span class="o">.</span><span class="n">W192</span><span class="o">.</span><span class="n">F196</span><span class="o">.</span><span class="n">F196</span><span class="o">.</span><span class="n">W192</span><span class="o">.</span><span class="n">F196</span><span class="o">.</span><span class="n">W192</span><span class="o">.</span><span class="n">F196</span><span class="o">.</span><span class="n">fooKoW192</span><span class="o">.</span><span class="n">W192</span><span class="o">.</span><span class="n">W192</span><span class="o">.</span>
</span><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="o">{</span> <span class="n">subscribe</span><span class="o">(</span><span class="n">tryObservableFooBar07</span><span class="o">)</span> <span class="o">;</span> <span class="n">work</span><span class="o">(</span><span class="-Symbol">&#39;W</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">150</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="n">B196</span><span class="o">.</span><span class="n">F54</span><span class="o">.</span><span class="n">W192</span><span class="o">.</span><span class="n">B196</span><span class="o">.</span><span class="n">F54</span><span class="o">.</span><span class="n">B196</span><span class="o">.</span><span class="n">W192</span><span class="o">.</span><span class="n">B196</span><span class="o">.</span><span class="n">F54</span><span class="o">.</span><span class="n">B196</span><span class="o">.</span><span class="n">B196</span><span class="o">.</span><span class="n">W192</span><span class="o">.</span><span class="n">F54</span><span class="o">.</span><span class="n">B196</span><span class="o">.</span><span class="n">B196</span><span class="o">.</span><span class="n">F54</span><span class="o">.</span><span class="n">B196</span><span class="o">.</span><span class="n">W192</span><span class="o">.</span>
</span><span class='line'><span class="n">B196</span><span class="o">.</span><span class="n">F54</span><span class="o">.</span><span class="n">W192</span><span class="o">.</span><span class="n">F54</span><span class="o">.</span><span class="n">F54</span><span class="o">.</span><span class="n">W192</span><span class="o">.</span><span class="n">F54</span><span class="o">.</span><span class="n">W192</span><span class="o">.</span><span class="n">F54</span><span class="o">.</span><span class="n">barKoW192</span><span class="o">.</span><span class="n">W192</span><span class="o">.</span><span class="n">W192</span><span class="o">.</span>
</span><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="o">{</span> <span class="n">subscribe</span><span class="o">(</span><span class="n">tryObservableFooBar08</span><span class="o">)</span> <span class="o">;</span> <span class="n">work</span><span class="o">(</span><span class="-Symbol">&#39;W</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">150</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="n">B54</span><span class="o">.</span><span class="n">F197</span><span class="o">.</span><span class="n">W192</span><span class="o">.</span><span class="n">B54</span><span class="o">.</span><span class="n">F197</span><span class="o">.</span><span class="n">B54</span><span class="o">.</span><span class="n">W192</span><span class="o">.</span><span class="n">B54</span><span class="o">.</span><span class="n">F197</span><span class="o">.</span><span class="n">B54</span><span class="o">.</span><span class="n">B54</span><span class="o">.</span><span class="n">W192</span><span class="o">.</span><span class="n">F197</span><span class="o">.</span><span class="n">B54</span><span class="o">.</span><span class="n">B54</span><span class="o">.</span><span class="n">F197</span><span class="o">.</span><span class="n">B54</span><span class="o">.</span><span class="n">W192</span><span class="o">.</span><span class="n">B54</span><span class="o">.</span>
</span><span class='line'><span class="n">F197</span><span class="o">.</span><span class="n">W192</span><span class="o">.</span><span class="n">F197</span><span class="o">.</span><span class="n">F197</span><span class="o">.</span><span class="n">W192</span><span class="o">.</span><span class="n">F197</span><span class="o">.</span><span class="n">W192</span><span class="o">.</span><span class="n">F197</span><span class="o">.</span><span class="n">barKo</span> <span class="n">and</span> <span class="n">fooKoW192</span><span class="o">.</span><span class="n">W192</span><span class="o">.</span><span class="n">W192</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>Transforming futures, pushing one value,
to (a special  kind of) observables, potentially pushing many (zero or more) values,
is, of course, not the end of the story about observables.</p>

<h2>More Computations of type <code>Observable</code></h2>

<p>The simple observables defined below can serve as building blocks for defining more complex observables</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">def</span> <span class="n">zeroObservable</span><span class="o">()</span><span class="k">:</span> <span class="kt">Observable</span><span class="o">[</span><span class="kt">Nothing</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>    <span class="n">mkObservable</span> <span class="o">{</span> <span class="n">sn</span> <span class="k">=&gt;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">errorObservable</span><span class="o">[</span><span class="kt">Z</span><span class="o">](</span><span class="n">t</span><span class="k">:</span> <span class="kt">Throwable</span><span class="o">)</span><span class="k">:</span> <span class="kt">Observable</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>    <span class="nc">Observable</span> <span class="o">{</span> <span class="n">sz</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="n">sz</span><span class="o">.</span><span class="n">onError</span><span class="o">(</span><span class="n">t</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">nextObservable</span><span class="o">[</span><span class="kt">Z</span><span class="o">](</span><span class="n">z</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Observable</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>    <span class="nc">Observable</span> <span class="o">{</span> <span class="n">sz</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="n">sz</span><span class="o">.</span><span class="n">onNext</span><span class="o">(</span><span class="n">z</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">completedObservable</span><span class="o">()</span><span class="k">:</span> <span class="kt">Observable</span><span class="o">[</span><span class="kt">Nothing</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>    <span class="nc">Observable</span> <span class="o">{</span> <span class="n">sn</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="n">sn</span><span class="o">.</span><span class="n">onCompleted</span><span class="o">()</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">oneObservable</span><span class="o">[</span><span class="kt">Z</span><span class="o">](</span><span class="n">z</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Observable</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>    <span class="nc">Observable</span> <span class="o">{</span> <span class="n">sz</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="n">sz</span><span class="o">.</span><span class="n">onNext</span><span class="o">(</span><span class="n">z</span><span class="o">)</span>
</span><span class='line'>      <span class="n">sz</span><span class="o">.</span><span class="n">onCompleted</span><span class="o">()</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The meaning of the simple observables above is almost trivial:
they push <em>nothing</em> resp. an <em>error</em> resp. a <em>value</em>, resp. a <em>completed marker</em> resp. a <em>value and a completed marker</em> to subscribed observers.</p>

<p>The following method shows how to define observables that push many values.
It uses a helper function <code>subscriber2observable</code> because directly subscribing
the subscriber <code>sz</code> below to the observable <code>oz</code> below does not work:
a new observer, wrapping the subscriber, needs to be subscribed.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">def</span> <span class="n">subscriber2observer</span><span class="o">[</span><span class="kt">Z</span><span class="o">](</span><span class="n">sz</span><span class="k">:</span> <span class="kt">Subscriber</span><span class="o">[</span><span class="kt">Z</span><span class="o">])</span> <span class="k">=</span>
</span><span class='line'>    <span class="k">new</span> <span class="nc">Observer</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">def</span> <span class="n">onNext</span><span class="o">(</span><span class="n">z</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span> <span class="k">=</span> <span class="n">sz</span><span class="o">.</span><span class="n">onNext</span><span class="o">(</span><span class="n">z</span><span class="o">)</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">def</span> <span class="n">onError</span><span class="o">(</span><span class="n">t</span><span class="k">:</span> <span class="kt">Throwable</span><span class="o">)</span> <span class="k">=</span> <span class="n">sz</span><span class="o">.</span><span class="n">onError</span><span class="o">(</span><span class="n">t</span><span class="o">)</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">def</span> <span class="n">onCompleted</span><span class="o">()</span> <span class="k">=</span> <span class="n">sz</span><span class="o">.</span><span class="n">onCompleted</span><span class="o">()</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">implicit</span> <span class="k">class</span> <span class="nc">ObservableOps</span><span class="o">[</span><span class="kt">Z</span><span class="o">](</span><span class="n">oz</span><span class="k">:</span> <span class="kt">Observable</span><span class="o">[</span><span class="kt">Z</span><span class="o">])</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">startingWith</span><span class="o">(</span><span class="n">zs</span><span class="k">:</span> <span class="kt">Z*</span><span class="o">)</span> <span class="k">=</span>
</span><span class='line'>      <span class="nc">Observable</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="o">{</span> <span class="n">sz</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">zs</span><span class="o">.</span><span class="n">foreach</span> <span class="o">{</span> <span class="n">z</span> <span class="k">=&gt;</span> <span class="n">sz</span><span class="o">.</span><span class="n">onNext</span><span class="o">(</span><span class="n">z</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'>        <span class="n">oz</span><span class="o">.</span><span class="n">subscribe</span><span class="o">(</span><span class="n">subscriber2observer</span><span class="o">(</span><span class="n">sz</span><span class="o">))</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="c1">// ...</span>
</span></code></pre></td></tr></table></div></figure>


<p>First all <code>zs</code> are pushed to subscribed observers
and after that the observable <code>oz</code> continues pushing
values to them.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="n">subscribe</span><span class="o">(</span><span class="n">oneObservable</span><span class="o">(</span><span class="mi">4</span><span class="o">).</span><span class="n">startingWith</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">))</span>
</span><span class='line'><span class="mi">1234</span><span class="n">completed</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<h2>Computations of type <code>Observable</code> of the RxScala library</h2>

<p>There are various ways to define observables available in the RxScala library.</p>

<p>Below is an example, using <code>from</code>, that
can be used to transform any <em>iterable</em>, which is pull based,
to an <em>observable</em>, which is push based</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="k">lazy</span> <span class="k">val</span> <span class="n">oneTwoThreeFour</span> <span class="k">=</span> <span class="n">from</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">))</span>
</span><span class='line'><span class="n">oneTwoThreeFour</span><span class="k">:</span> <span class="kt">rx.lang.scala.Observable</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="o">&lt;</span><span class="k">lazy</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can subscribe to it (ignoring the subscription)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="o">{</span> <span class="n">subscribe</span><span class="o">(</span><span class="n">oneTwoThreeFour</span><span class="o">)</span> <span class="o">;</span> <span class="o">()</span> <span class="o">}</span>
</span><span class='line'><span class="mi">1234</span><span class="n">completed</span>
</span></code></pre></td></tr></table></div></figure>


<p>This transformation from iterables to observables is not as trivial
as it looks: at any moment subscribed observers should be able to
unsubscribe.</p>

<p>Below is an example, using <code>interval</code>, that defines
a <em>ticker</em>  that is ticking every <code>100</code> milliseconds.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="k">lazy</span> <span class="k">val</span> <span class="n">ticker</span> <span class="k">=</span> <span class="n">interval</span><span class="o">(</span><span class="mi">100</span> <span class="n">millis</span><span class="o">)</span>
</span><span class='line'><span class="n">ticker</span><span class="k">:</span> <span class="kt">rx.lang.scala.Observable</span><span class="o">[</span><span class="kt">Long</span><span class="o">]</span> <span class="k">=</span> <span class="o">&lt;</span><span class="k">lazy</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can subscribe to it and unsubscribe from it when
you are not interested in receiving further ticks any more.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="k">:</span><span class="kt">paste</span>
</span><span class='line'><span class="c1">// Entering paste mode (ctrl-D to finish)</span>
</span><span class='line'>
</span><span class='line'><span class="o">{</span>
</span><span class='line'> <span class="k">val</span> <span class="n">subscription</span> <span class="k">=</span> <span class="n">subscribe</span><span class="o">(</span><span class="n">ticker</span><span class="o">)</span>
</span><span class='line'> <span class="nc">Thread</span><span class="o">.</span><span class="n">sleep</span><span class="o">(</span><span class="mi">600</span><span class="o">)</span>
</span><span class='line'> <span class="n">subscription</span><span class="o">.</span><span class="n">unsubscribe</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// Exiting paste mode, now interpreting.</span>
</span><span class='line'>
</span><span class='line'><span class="mi">012345</span>
</span></code></pre></td></tr></table></div></figure>


<p>So what about <code>bnd</code> and <code>and</code>?</p>

<h2><code>flatten</code> is your friend</h2>

<p>The story is somewhat different here and we do not go into all details.
For observables, the method <code>bnd</code> below which is defined in terms of the RxScala
library method <code>flatten</code>
(which, <em>non-deterministically</em>, <em>merges observables of observables</em>)
is all we need.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">def</span> <span class="n">bnd</span><span class="o">[</span><span class="kt">Y</span><span class="o">](</span><span class="n">z2oy</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=&gt;</span> <span class="nc">Observable</span><span class="o">[</span><span class="kt">Y</span><span class="o">])</span><span class="k">:</span> <span class="kt">Observable</span><span class="o">[</span><span class="kt">Y</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>  <span class="nc">Observable</span><span class="o">[</span><span class="kt">Observable</span><span class="o">[</span><span class="kt">Y</span><span class="o">]]</span> <span class="o">{</span> <span class="n">ooy</span> <span class="k">=&gt;</span>
</span><span class='line'>    <span class="n">oz</span><span class="o">.</span><span class="n">subscribe</span><span class="o">(</span><span class="k">new</span> <span class="nc">Observer</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">override</span> <span class="k">def</span> <span class="n">onNext</span><span class="o">(</span><span class="n">z</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span> <span class="k">=</span>
</span><span class='line'>        <span class="n">ooy</span><span class="o">.</span><span class="n">onNext</span><span class="o">(</span><span class="n">z</span> <span class="n">bind</span> <span class="n">z2oy</span><span class="o">)</span>
</span><span class='line'>      <span class="k">override</span> <span class="k">def</span> <span class="n">onError</span><span class="o">(</span><span class="n">t</span><span class="k">:</span> <span class="kt">Throwable</span><span class="o">)</span> <span class="k">=</span>
</span><span class='line'>        <span class="n">ooy</span><span class="o">.</span><span class="n">onError</span><span class="o">(</span><span class="n">t</span><span class="o">)</span>
</span><span class='line'>      <span class="k">override</span> <span class="k">def</span> <span class="n">onCompleted</span><span class="o">()</span> <span class="k">=</span>
</span><span class='line'>        <span class="n">ooy</span><span class="o">.</span><span class="n">onCompleted</span><span class="o">()</span>
</span><span class='line'>    <span class="o">})</span>
</span><span class='line'>  <span class="o">}</span> <span class="n">flatten</span>
</span></code></pre></td></tr></table></div></figure>


<p>To make things interesting from a merge point of view we define
the following verbose version of <code>interval</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">def</span> <span class="n">verboseInterval</span><span class="o">(</span><span class="n">t0</span><span class="k">:</span> <span class="kt">Long</span><span class="o">,</span> <span class="n">x</span><span class="k">:</span> <span class="kt">Long</span><span class="o">,</span> <span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=</span>
</span><span class='line'>    <span class="n">interval</span><span class="o">(</span><span class="n">x</span><span class="o">*</span><span class="mi">100</span> <span class="n">millis</span><span class="o">).</span><span class="n">take</span><span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="n">bnd</span> <span class="o">{</span> <span class="n">y</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="k">val</span> <span class="n">millis</span> <span class="k">=</span> <span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span> <span class="o">-</span> <span class="n">t0</span><span class="o">)</span> <span class="o">/</span> <span class="mf">1000.0</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">f</span><span class="s">&quot;at ${millis}%.3f interval($x) emits $y&quot;</span><span class="o">)</span>
</span><span class='line'>      <span class="n">nextObservable</span><span class="o">(</span><span class="n">y</span><span class="o">)</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here is an observable, this time defined as a <code>def</code>,
to take the current time into account every time it is executed,
that uses <code>bnd</code> to merge three intervals as they are pushed
to subscribed observers</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="k">:</span><span class="kt">paste</span>
</span><span class='line'><span class="c1">// Entering paste mode (ctrl-D to finish)</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="n">mergedIntervals</span><span class="o">(</span><span class="n">t</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span> <span class="k">=</span>
</span><span class='line'>    <span class="n">from</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">))</span> <span class="n">bnd</span> <span class="o">{</span> <span class="n">x</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="n">verboseInterval</span><span class="o">(</span><span class="n">t</span><span class="o">,</span> <span class="n">x</span><span class="o">,</span> <span class="mi">2</span><span class="o">)</span> <span class="n">bnd</span> <span class="o">{</span> <span class="n">y</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">oneObservable</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">)</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Exiting paste mode, now interpreting.</span>
</span><span class='line'>
</span><span class='line'><span class="n">mergedIntervals</span><span class="k">:</span> <span class="o">(</span><span class="kt">t:</span> <span class="kt">Long</span><span class="o">)</span><span class="kt">rx.lang.scala.Observable</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>It is instructive to try to understand the output of executing the following computation</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="k">:</span><span class="kt">paste</span>
</span><span class='line'><span class="c1">// Entering paste mode (ctrl-D to finish)</span>
</span><span class='line'>
</span><span class='line'><span class="o">{</span>
</span><span class='line'> <span class="n">subscribe</span><span class="o">(</span><span class="n">mergedIntervals</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="o">))</span>
</span><span class='line'> <span class="nc">Thread</span><span class="o">.</span><span class="n">sleep</span><span class="o">(</span><span class="mi">3000</span><span class="o">)</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Exiting paste mode, now interpreting.</span>
</span><span class='line'>
</span><span class='line'><span class="n">at</span> <span class="mf">0.102</span><span class="k">:</span><span class="kt">interval</span><span class="o">(</span><span class="err">1</span><span class="o">)</span> <span class="kt">emits</span> <span class="err">0</span>
</span><span class='line'><span class="kt">at</span> <span class="err">0</span><span class="kt">.</span><span class="err">202</span><span class="kt">:interval</span><span class="o">(</span><span class="err">2</span><span class="o">)</span> <span class="kt">emits</span> <span class="err">0</span>
</span><span class='line'><span class="kt">at</span> <span class="err">0</span><span class="kt">.</span><span class="err">202</span><span class="kt">:interval</span><span class="o">(</span><span class="err">1</span><span class="o">)</span> <span class="kt">emits</span> <span class="err">1</span>
</span><span class='line'><span class="kt">at</span> <span class="err">0</span><span class="kt">.</span><span class="err">302</span><span class="kt">:interval</span><span class="o">(</span><span class="err">3</span><span class="o">)</span> <span class="kt">emits</span> <span class="err">0</span>
</span><span class='line'><span class="kt">at</span> <span class="err">0</span><span class="kt">.</span><span class="err">402</span><span class="kt">:interval</span><span class="o">(</span><span class="err">2</span><span class="o">)</span> <span class="kt">emits</span> <span class="err">1</span>
</span><span class='line'><span class="kt">at</span> <span class="err">0</span><span class="kt">.</span><span class="err">602</span><span class="kt">:interval</span><span class="o">(</span><span class="err">3</span><span class="o">)</span> <span class="kt">emits</span> <span class="err">1</span>
</span></code></pre></td></tr></table></div></figure>


<h2>An example: <code>scanning</code></h2>

<p>We end with a common use case: <em>scanning observables</em>.
For example:
an observable that pushes <code>"1" "2" "3" "4" "5"</code>,
when scanned using <code>add</code>, a swapped, curried version of <code>+</code>, becomes
an observable that pushes <code>"1" "12" "123" "1234" "12345"</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'> <span class="k">def</span> <span class="n">scanning</span><span class="o">[</span><span class="kt">Y</span><span class="o">](</span><span class="n">y</span><span class="k">:</span> <span class="kt">Y</span><span class="o">)(</span><span class="n">z_2_y2y</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=&gt;</span> <span class="n">Y</span> <span class="k">=&gt;</span> <span class="n">Y</span><span class="o">)</span><span class="k">:</span> <span class="kt">Observable</span><span class="o">[</span><span class="kt">Y</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>  <span class="n">mkObservable</span><span class="o">[</span><span class="kt">Y</span><span class="o">]</span> <span class="o">{</span> <span class="n">sz</span> <span class="k">=&gt;</span>
</span><span class='line'>    <span class="k">var</span> <span class="n">accY</span> <span class="k">=</span> <span class="n">y</span>
</span><span class='line'>    <span class="n">oz</span><span class="o">.</span><span class="n">subscribe</span><span class="o">(</span><span class="k">new</span> <span class="nc">Observer</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">override</span> <span class="k">def</span> <span class="n">onNext</span><span class="o">(</span><span class="n">z</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">accY</span> <span class="k">=</span> <span class="n">z_2_y2y</span><span class="o">(</span><span class="n">z</span><span class="o">)(</span><span class="n">accY</span><span class="o">)</span> <span class="o">;</span> <span class="n">sz</span><span class="o">.</span><span class="n">onNext</span><span class="o">(</span><span class="n">accY</span><span class="o">)</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>      <span class="k">override</span> <span class="k">def</span> <span class="n">onError</span><span class="o">(</span><span class="n">t</span><span class="k">:</span> <span class="kt">Throwable</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">sz</span><span class="o">.</span><span class="n">onError</span><span class="o">(</span><span class="n">t</span><span class="o">)</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>      <span class="k">override</span> <span class="k">def</span> <span class="n">onCompleted</span><span class="o">()</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">sz</span><span class="o">.</span><span class="n">onCompleted</span><span class="o">()</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="o">})</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>We used a <code>var accY</code> as an accumulator. You may argue: how ugly!
Well, in a way, using a <code>var</code> as an <em>internal implementation detail</em> is not ugly at all.
Erik Meijer (the brain behind the Rx extensions of .NET, upon which RxJava
and RxScala are based) calls himself <em>&ldquo;both a functional thinker and an imperative hacker&rdquo;</em>.</p>

<p>Here is a typical <code>scanning</code> example</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="k">:</span><span class="kt">paste</span>
</span><span class='line'><span class="c1">// Entering paste mode (ctrl-D to finish)</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="n">add</span><span class="o">(</span><span class="n">s</span><span class="k">:</span> <span class="kt">String</span><span class="o">)(</span><span class="n">t</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="n">s</span>
</span><span class='line'>
</span><span class='line'><span class="k">lazy</span> <span class="k">val</span> <span class="n">scannedObservable</span> <span class="k">=</span>
</span><span class='line'> <span class="n">from</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="s">&quot;1&quot;</span><span class="o">,</span> <span class="s">&quot;2&quot;</span><span class="o">,</span> <span class="s">&quot;3&quot;</span><span class="o">,</span> <span class="s">&quot;4&quot;</span><span class="o">,</span> <span class="s">&quot;5&quot;</span><span class="o">))</span>
</span><span class='line'>  <span class="o">.</span><span class="n">scanning</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">)(</span><span class="n">add</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Exiting paste mode, now interpreting.</span>
</span><span class='line'>
</span><span class='line'><span class="n">add</span><span class="k">:</span> <span class="o">(</span><span class="kt">s:</span> <span class="kt">String</span><span class="o">)(</span><span class="kt">t:</span> <span class="kt">String</span><span class="o">)</span><span class="kt">String</span>
</span><span class='line'><span class="n">scannedObservable</span><span class="k">:</span> <span class="kt">rx.lang.scala.Observable</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">&lt;</span><span class="k">lazy</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>and here we run it</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="o">{</span> <span class="n">subscribe</span><span class="o">(</span><span class="n">scannedObservable</span><span class="o">)</span> <span class="o">;</span> <span class="o">()</span> <span class="o">}</span>
</span><span class='line'><span class="mi">112123123412345</span><span class="n">completed</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Reactive Programming: Try Versus Future]]></title>
    <link href="http://www.strongtyped.io/blog/2014/05/11/reactive-programming-try-future/"/>
    <updated>2014-05-11T06:21:00+02:00</updated>
    <id>http://www.strongtyped.io/blog/2014/05/11/reactive-programming-try-future</id>
    <content type="html"><![CDATA[<p>This is a first of two blog posts about <em>Reactive Programming in Scala</em>.
The blog post about <a href="http://www.strongtyped.io/blog/2014/05/11/functional-programming-in-scala"><em>Functional Programming in Scala</em></a>
introduced <em>pure computations resulting in exactly one value</em>.
Reactive programming deals, in a functional way,
with two fundamental <em>impure</em> aspects of computations: <em>failure</em> and <em>latency</em>.
The first blog post covers reactive programs resulting in <em>one</em> value.
The second blog post covers Reactive Programs resulting in <em>many</em> (<em>zero or more</em>) values.</p>

<p><strong>Warning:</strong>
The types that are used in this blog post exist in the standard Scala library.
For didactical reasons this blog post sometimes defines extra types and extra methods for existing types.</p>

<!-- more -->


<h2>Failure</h2>

<p>In Java (and many other languages for that matter) failure is modeled using <em>exceptions</em>.
Java also added the distiction between <em>checked</em> and <em>unchecked</em> exceptions.</p>

<p>When asking Java programmers if they <em>like</em> checked exceptions, many of them say they <em>hate</em> them.
In a way this is strange because checked exceptions are part of the <em>contract</em> of your code,
and, when using them, the compiler <em>helps</em> you by telling you whether or not
your code <em>satisfies that contract</em>.
In practice, many Java programmers have the feeling that the compiler is <em>annoying</em>
them rather then helping them.</p>

<p>Why?</p>

<p>Well, because, when trying to satisfy the contract that comes with checked exceptions,
programmers are basically <em>left on their own</em>. As a consequence <code>try/catch</code> code propagates
all the way through their code, cluttering up the <em>essential part</em> of their code.
In a way, when using checked exceptions, <em>they end up in</em> <code>try/catch</code> <em>hell</em>.
Therefore many Java programmers <code>catch</code> checked exceptions and <code>throw</code> unchecked ones.</p>

<p>That makes the situation even worse since, by throwing unchecked exceptions,
programmers let failure <em>silently disappear at compile time</em>
until it <em>loudly re-appears at runtime</em>.</p>

<p>There must be a better way to deal with failure.</p>

<h2>Computations of type <code>Try</code></h2>

<p>The <code>Try</code> type represents a computation that may
either result in a successfully computed value
or result in a failure.
An instance of <code>Try[Z]</code> is
either an instance of <code>Success[Z]</code>
or an instance of <code>Failure[Z]</code>.</p>

<p>Code that makes use a value <code>tz</code> of type <code>Try[Z]</code>,
typically, makes use of a <code>match</code> on <code>tz</code>, which, you can think of as code that</p>

<ul>
<li>in a synchronous (blocking) way, <em>pulls</em> a value or a throwable out of <code>tz</code></li>
</ul>


<h2>Materializing failure using <code>mkTry</code></h2>

<p>A first step towards dealing with failure in a better way is to write, once and for all, code that
<em>materializes failure at compile time</em></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">def</span> <span class="n">mkTry</span><span class="o">[</span><span class="kt">Z</span><span class="o">](</span><span class="n">block</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="n">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Try</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>    <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>      <span class="nc">Success</span> <span class="o">{</span> <span class="n">block</span> <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">catch</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="n">throwable</span><span class="k">:</span> <span class="kt">Throwable</span> <span class="o">=&gt;</span>
</span><span class='line'>        <span class="nc">Failure</span><span class="o">(</span><span class="n">throwable</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <code>mkTry</code> code makes use of a <em>call by name</em> parameter <code>block</code>
which you can think of as code that <em>can succeed</em> or <em>can fail</em>.</p>

<p>The <code>Try</code> companion object of the standard Scala library already has an <code>apply</code> method
that is equivalent to <code>mkTry</code>. The definition of <code>mkTry</code> is given for didactical reasons only.</p>

<p>How are computations of type <code>Try</code> <em>described</em>?</p>

<h2>Describing Computations of type <code>Try</code></h2>

<p>To make things interesting from a failure and latency
point of view, many example computations make use of
the functions <code>work</code> and <code>block</code> below</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">def</span> <span class="n">work</span><span class="o">(</span><span class="n">c</span><span class="k">:</span> <span class="kt">Char</span><span class="o">,</span> <span class="n">l</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="o">(</span><span class="mi">1</span> <span class="n">to</span> <span class="mi">10</span><span class="o">).</span><span class="n">foreach</span> <span class="o">{</span> <span class="k">_</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="n">print</span><span class="o">(</span><span class="n">s</span><span class="s">&quot;${c}${Thread.currentThread().getId()}.&quot;</span><span class="o">)</span>
</span><span class='line'>      <span class="nc">Thread</span><span class="o">.</span><span class="n">sleep</span><span class="o">(</span><span class="n">l</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">block</span><span class="o">(</span><span class="n">string</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">Boolean</span><span class="o">,</span> <span class="n">c</span><span class="k">:</span> <span class="kt">Char</span><span class="o">,</span> <span class="n">l</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">work</span><span class="o">(</span><span class="n">c</span><span class="o">,</span> <span class="n">l</span><span class="o">)</span>
</span><span class='line'>    <span class="k">if</span><span class="o">(</span><span class="n">b</span><span class="o">)</span> <span class="n">s</span><span class="s">&quot;${string}Ok&quot;</span>
</span><span class='line'>    <span class="k">else</span> <span class="k">throw</span> <span class="k">new</span> <span class="nc">Throwable</span><span class="o">(</span><span class="n">s</span><span class="s">&quot;${string}Ko&quot;</span><span class="o">)</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here are two computations of type <code>Try</code> that are described using <code>mkTry</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="k">lazy</span> <span class="k">val</span> <span class="n">okTryFoo</span> <span class="k">=</span> <span class="n">mkTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="-Symbol">&#39;F</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="n">okTryFoo</span><span class="k">:</span> <span class="kt">scala.util.Try</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">&lt;</span><span class="k">lazy</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="k">lazy</span> <span class="k">val</span> <span class="n">koTryFoo</span> <span class="k">=</span> <span class="n">mkTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="-Symbol">&#39;F</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="n">okTryFoo</span><span class="k">:</span> <span class="kt">scala.util.Try</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">&lt;</span><span class="k">lazy</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>A <code>lazy val</code> is used to separate the description of the computation from its execution.</p>

<p>How are computations of type <code>Try</code> <em>executed</em> once they are described?</p>

<h2>Executing Computations of type <code>Try</code></h2>

<p>For the purpose of this series of blog posts,
executing a computation of type <code>Try</code> can be as simple as either printing the value
pulled out of a successful result or printing the message pulled out of an unsuccessful result</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">def</span> <span class="n">execute</span><span class="o">[</span><span class="kt">Z</span><span class="o">](</span><span class="n">tz</span><span class="k">:</span> <span class="kt">Try</span><span class="o">[</span><span class="kt">Z</span><span class="o">])</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span>
</span><span class='line'>    <span class="n">tz</span> <span class="k">match</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="nc">Success</span><span class="o">(</span><span class="n">z</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">print</span><span class="o">(</span><span class="n">s</span><span class="s">&quot;$z&quot;</span><span class="o">)</span>
</span><span class='line'>      <span class="k">case</span> <span class="nc">Failure</span><span class="o">(</span><span class="n">t</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">print</span><span class="o">(</span><span class="n">s</span><span class="s">&quot;${t.getMessage}&quot;</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Below, the two computations of type <code>Try</code> are executed using <code>execute</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="o">{</span> <span class="n">execute</span><span class="o">(</span><span class="n">okTryFoo</span><span class="o">)</span> <span class="o">;</span> <span class="n">work</span><span class="o">(</span><span class="-Symbol">&#39;M</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">fooOkM142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span>
</span><span class='line'><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span>
</span><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="o">{</span> <span class="n">execute</span><span class="o">(</span><span class="n">okTryFoo</span><span class="o">)</span> <span class="o">;</span> <span class="n">work</span><span class="o">(</span><span class="-Symbol">&#39;M</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="n">fooOkM142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span>
</span><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="o">{</span> <span class="n">execute</span><span class="o">(</span><span class="n">koTryFoo</span><span class="o">)</span> <span class="o">;</span> <span class="n">work</span><span class="o">(</span><span class="-Symbol">&#39;M</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">fooKoM142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span>
</span><span class='line'><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span>
</span><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="o">{</span> <span class="n">execute</span><span class="o">(</span><span class="n">koTryFoo</span><span class="o">)</span> <span class="o">;</span> <span class="n">work</span><span class="o">(</span><span class="-Symbol">&#39;M</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="n">fooKoM142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>So, what does materialized failure bring you?</p>

<h2><code>bnd</code> is your guide</h2>

<p>Just as it is possible for computations of type <code>One</code> it is possible for computations of type <code>Try</code>
to define a method <code>bnd</code> that can be used to <em>compose computations</em></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">implicit</span> <span class="k">class</span> <span class="nc">TryOps</span><span class="o">[</span><span class="kt">Z</span><span class="o">](</span><span class="n">tz</span><span class="k">:</span> <span class="kt">Try</span><span class="o">[</span><span class="kt">Z</span><span class="o">])</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">bnd</span><span class="o">[</span><span class="kt">Y</span><span class="o">](</span><span class="n">z2ty</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=&gt;</span> <span class="nc">Try</span><span class="o">[</span><span class="kt">Y</span><span class="o">])</span><span class="k">:</span> <span class="kt">Try</span><span class="o">[</span><span class="kt">Y</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>      <span class="n">tz</span> <span class="k">match</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">case</span> <span class="nc">Success</span><span class="o">(</span><span class="n">z</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>          <span class="n">z</span> <span class="n">bind</span> <span class="n">z2ty</span>
</span><span class='line'>        <span class="k">case</span> <span class="nc">Failure</span><span class="o">(</span><span class="n">t</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>          <span class="nc">Failure</span><span class="o">(</span><span class="n">t</span><span class="o">)</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="c1">// ...</span>
</span></code></pre></td></tr></table></div></figure>


<p>An important requirement for <code>z2ty</code> is that it <em>must not throw exceptions</em>.
Using <code>mkTry</code>, it is easy to fulfill this requirement.</p>

<p>With <code>bnd</code> in your toolbox, you are not on your own any more to deal with materialized failure.
Indeed, the method <code>bnd</code> is your trustworthy guide that</p>

<ul>
<li><em>leads you through the successful execution path</em></li>
<li><em>does the failure related boilerplate work for you</em></li>
</ul>


<h2>DSL for declaring computations of type <code>Try</code> (Part 1)</h2>

<p>By now we have defined <code>mkTry</code> and <code>bnd</code></p>

<ul>
<li>They constitute <em>a declarative DSL for describing computations</em> of type <code>Try</code></li>
</ul>


<p>We have also defined <code>execute</code></p>

<ul>
<li>It constitutes <em>an imperative DSL for executing computations</em> of type <code>Try</code></li>
</ul>


<p>This section contains some examples on how to make use of those DSL&rsquo;s.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="k">:</span><span class="kt">paste</span>
</span><span class='line'><span class="c1">// Entering paste mode (ctrl-D to finish)</span>
</span><span class='line'>
</span><span class='line'><span class="k">lazy</span> <span class="k">val</span> <span class="n">tryFooBar01</span><span class="k">:</span> <span class="kt">Try</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>  <span class="n">mkTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="-Symbol">&#39;F</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span> <span class="n">bnd</span> <span class="o">{</span> <span class="n">s</span> <span class="k">=&gt;</span>
</span><span class='line'>    <span class="n">mkTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="-Symbol">&#39;B</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span> <span class="n">bnd</span> <span class="o">{</span> <span class="n">t</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="n">mkTry</span><span class="o">(</span><span class="n">add</span><span class="o">(</span><span class="n">s</span><span class="o">)(</span><span class="n">t</span><span class="o">))</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">lazy</span> <span class="k">val</span> <span class="n">tryFooBar02</span><span class="k">:</span> <span class="kt">Try</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>  <span class="n">mkTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="-Symbol">&#39;F</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span> <span class="n">bnd</span> <span class="o">{</span> <span class="n">s</span> <span class="k">=&gt;</span>
</span><span class='line'>    <span class="n">mkTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="-Symbol">&#39;B</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span> <span class="n">bnd</span> <span class="o">{</span> <span class="n">t</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="n">mkTry</span><span class="o">(</span><span class="n">add</span><span class="o">(</span><span class="n">s</span><span class="o">)(</span><span class="n">t</span><span class="o">))</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">lazy</span> <span class="k">val</span> <span class="n">tryFooBar03</span><span class="k">:</span> <span class="kt">Try</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>  <span class="n">mkTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="-Symbol">&#39;F</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span> <span class="n">bnd</span> <span class="o">{</span> <span class="n">s</span> <span class="k">=&gt;</span>
</span><span class='line'>    <span class="n">mkTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="-Symbol">&#39;B</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span> <span class="n">bnd</span> <span class="o">{</span> <span class="n">t</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="n">mkTry</span><span class="o">(</span><span class="n">add</span><span class="o">(</span><span class="n">s</span><span class="o">)(</span><span class="n">t</span><span class="o">))</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">lazy</span> <span class="k">val</span> <span class="n">tryFooBar04</span><span class="k">:</span> <span class="kt">Try</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>  <span class="n">mkTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="-Symbol">&#39;F</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span> <span class="n">bnd</span> <span class="o">{</span> <span class="n">s</span> <span class="k">=&gt;</span>
</span><span class='line'>    <span class="n">mkTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="-Symbol">&#39;B</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span> <span class="n">bnd</span> <span class="o">{</span> <span class="n">t</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="n">mkTry</span><span class="o">(</span><span class="n">add</span><span class="o">(</span><span class="n">s</span><span class="o">)(</span><span class="n">t</span><span class="o">))</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Exiting paste mode, now interpreting.</span>
</span><span class='line'>
</span><span class='line'><span class="n">tryFooBar01</span><span class="k">:</span> <span class="kt">scala.util.Try</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">&lt;</span><span class="k">lazy</span><span class="o">&gt;</span>
</span><span class='line'><span class="n">tryFooBar02</span><span class="k">:</span> <span class="kt">scala.util.Try</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">&lt;</span><span class="k">lazy</span><span class="o">&gt;</span>
</span><span class='line'><span class="n">tryFooBar03</span><span class="k">:</span> <span class="kt">scala.util.Try</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">&lt;</span><span class="k">lazy</span><span class="o">&gt;</span>
</span><span class='line'><span class="n">tryFooBar04</span><span class="k">:</span> <span class="kt">scala.util.Try</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">&lt;</span><span class="k">lazy</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can now, so to speak, try to print <code>fooOkbarOk</code> in a synchronous way</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="o">{</span> <span class="n">execute</span><span class="o">(</span><span class="n">tryFooBar01</span><span class="o">)</span> <span class="o">;</span> <span class="n">work</span><span class="o">(</span><span class="-Symbol">&#39;M</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span>
</span><span class='line'><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">fooOkbarOkM142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span>
</span><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="o">{</span> <span class="n">execute</span><span class="o">(</span><span class="n">tryFooBar02</span><span class="o">)</span> <span class="o">;</span> <span class="n">work</span><span class="o">(</span><span class="-Symbol">&#39;M</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span>
</span><span class='line'><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">barKoM142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span>
</span><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="o">{</span> <span class="n">execute</span><span class="o">(</span><span class="n">tryFooBar03</span><span class="o">)</span> <span class="o">;</span> <span class="n">work</span><span class="o">(</span><span class="-Symbol">&#39;M</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">fooKoM142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span>
</span><span class='line'><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span>
</span><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="o">{</span> <span class="n">execute</span><span class="o">(</span><span class="n">tryFooBar04</span><span class="o">)</span> <span class="o">;</span> <span class="n">work</span><span class="o">(</span><span class="-Symbol">&#39;M</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">fooKoM142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span>
</span><span class='line'><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>So now that failure is dealt with for you, you are perfectly happy, right?
Well, maybe not.
<code>bnd</code> deals with failure in a somewhat specific way using a <em>fail fast</em> strategy.
Maybe what you want is a <em>fail slow</em> strategy that <em>accumulates</em> information about what went wrong along the way.</p>

<p>This is where <code>and</code> comes in.</p>

<h2><code>and</code> may be a better guide</h2>

<p>Just as it is possible for computations of type <code>One</code> it is possible for computations of type <code>Try</code>
to define a method <code>and</code> that can be used to <em>compose computations</em></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="c1">// ...</span>
</span><span class='line'><span class="k">def</span> <span class="n">and</span><span class="o">[</span><span class="kt">Y</span><span class="o">](</span><span class="n">t_z2y</span><span class="k">:</span> <span class="kt">Try</span><span class="o">[</span><span class="kt">Z</span> <span class="k">=&gt;</span> <span class="kt">Y</span><span class="o">])</span><span class="k">:</span> <span class="kt">Try</span><span class="o">[</span><span class="kt">Y</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>  <span class="o">(</span><span class="n">tz</span><span class="o">,</span> <span class="n">t_z2y</span><span class="o">)</span> <span class="k">match</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">case</span> <span class="o">(</span><span class="nc">Success</span><span class="o">(</span><span class="n">z</span><span class="o">),</span> <span class="nc">Success</span><span class="o">(</span><span class="n">z2y</span><span class="o">))</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="nc">Try</span> <span class="o">{</span> <span class="n">z</span> <span class="n">bind</span> <span class="n">z2y</span> <span class="o">}</span>
</span><span class='line'>    <span class="k">case</span> <span class="o">(</span><span class="nc">Success</span><span class="o">(</span><span class="k">_</span><span class="o">),</span> <span class="nc">Failure</span><span class="o">(</span><span class="n">t</span><span class="o">))</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="nc">Failure</span><span class="o">(</span><span class="n">t</span><span class="o">)</span>
</span><span class='line'>    <span class="k">case</span> <span class="o">(</span><span class="nc">Failure</span><span class="o">(</span><span class="n">t</span><span class="o">),</span> <span class="nc">Success</span><span class="o">(</span><span class="k">_</span><span class="o">))</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="nc">Failure</span><span class="o">(</span><span class="n">t</span><span class="o">)</span>
</span><span class='line'>    <span class="k">case</span> <span class="o">(</span><span class="nc">Failure</span><span class="o">(</span><span class="n">t1</span><span class="o">),</span> <span class="nc">Failure</span><span class="o">(</span><span class="n">t2</span><span class="o">))</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="nc">Failure</span><span class="o">(</span><span class="k">new</span> <span class="nc">Throwable</span><span class="o">(</span>
</span><span class='line'>          <span class="n">t1</span><span class="o">.</span><span class="n">getMessage</span> <span class="o">+</span>
</span><span class='line'>          <span class="s">&quot; and &quot;</span> <span class="o">+</span>
</span><span class='line'>          <span class="n">t2</span><span class="o">.</span><span class="n">getMessage</span><span class="o">))</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Instead of relying on the default implementation of <code>and</code>
(that would use a fail fast strategy), you can take advantage of
the possibility to define <code>and</code> in another way to let it use a fail slow strategy
and accumulate error messages. All this is possible since <code>and</code>
is more abstract as <code>bnd</code> and, as such, allows for more implementation flexibility.</p>

<p>By the way: it is absolutely not the case that this is the one and only way
to use a fail slow strategy and accumulate information about what went wrong.
It is better to make use of a more powerful type, like the <code>Validation</code> type of ScalaZ.
The point we want to make is that, when going for <code>and</code> as a guide,
you have more failure handling implementation flexibility for letting
<code>and</code> guide you along your way to a possible result.</p>

<h2>DSL for declaring computations of type <code>Try</code> (Part 2)</h2>

<p>By now we have defined <code>mkTry</code>, <code>bnd</code> and <code>and</code></p>

<ul>
<li>They constitute <em>a declarative DSL for describing computations</em> of type <code>Try</code></li>
</ul>


<p>We have also defined <code>execute</code></p>

<ul>
<li>It constitutes <em>an imperative DSL for executing computations</em> of type <code>Try</code></li>
</ul>


<p>This section contains some examples on how to make use of those DSL&rsquo;s.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">lazy</span> <span class="k">val</span> <span class="n">tryFooBar05</span><span class="k">:</span> <span class="kt">Try</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>  <span class="n">mkTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="-Symbol">&#39;B</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span> <span class="n">and</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">mkTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="-Symbol">&#39;F</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span> <span class="n">and</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">mkTry</span><span class="o">(</span><span class="n">add</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">lazy</span> <span class="k">val</span> <span class="n">tryFooBar06</span><span class="k">:</span> <span class="kt">Try</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>  <span class="n">mkTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="-Symbol">&#39;B</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span> <span class="n">and</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">mkTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="-Symbol">&#39;F</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span> <span class="n">and</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">mkTry</span><span class="o">(</span><span class="n">add</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">lazy</span> <span class="k">val</span> <span class="n">tryFooBar07</span><span class="k">:</span> <span class="kt">Try</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>  <span class="n">mkTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="-Symbol">&#39;B</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span> <span class="n">and</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">mkTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="-Symbol">&#39;F</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span> <span class="n">and</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">mkTry</span><span class="o">(</span><span class="n">add</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">lazy</span> <span class="k">val</span> <span class="n">tryFooBar08</span><span class="k">:</span> <span class="kt">Try</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>  <span class="n">mkTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="-Symbol">&#39;B</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span> <span class="n">and</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">mkTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="-Symbol">&#39;F</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span> <span class="n">and</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">mkTry</span><span class="o">(</span><span class="n">add</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Exiting paste mode, now interpreting.</span>
</span><span class='line'>
</span><span class='line'><span class="n">tryFooBar05</span><span class="k">:</span> <span class="kt">scala.util.Try</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">&lt;</span><span class="k">lazy</span><span class="o">&gt;</span>
</span><span class='line'><span class="n">tryFooBar06</span><span class="k">:</span> <span class="kt">scala.util.Try</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">&lt;</span><span class="k">lazy</span><span class="o">&gt;</span>
</span><span class='line'><span class="n">tryFooBar07</span><span class="k">:</span> <span class="kt">scala.util.Try</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">&lt;</span><span class="k">lazy</span><span class="o">&gt;</span>
</span><span class='line'><span class="n">tryFooBar08</span><span class="k">:</span> <span class="kt">scala.util.Try</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">&lt;</span><span class="k">lazy</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can now, so to speak, try to print <code>fooOkbarOk</code> in a synchronous way</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="o">{</span> <span class="n">execute</span><span class="o">(</span><span class="n">tryFooBar05</span><span class="o">)</span> <span class="o">;</span> <span class="n">work</span><span class="o">(</span><span class="-Symbol">&#39;M</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span>
</span><span class='line'><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">fooOkbarOkM142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span>
</span><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="o">{</span> <span class="n">execute</span><span class="o">(</span><span class="n">tryFooBar06</span><span class="o">)</span> <span class="o">;</span> <span class="n">work</span><span class="o">(</span><span class="-Symbol">&#39;M</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span>
</span><span class='line'><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">fooKoM142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span>
</span><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="o">{</span> <span class="n">execute</span><span class="o">(</span><span class="n">tryFooBar07</span><span class="o">)</span> <span class="o">;</span> <span class="n">work</span><span class="o">(</span><span class="-Symbol">&#39;M</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span>
</span><span class='line'><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">barKoM142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span>
</span><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="o">{</span> <span class="n">execute</span><span class="o">(</span><span class="n">tryFooBar08</span><span class="o">)</span> <span class="o">;</span> <span class="n">work</span><span class="o">(</span><span class="-Symbol">&#39;M</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">B142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span>
</span><span class='line'><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">F142</span><span class="o">.</span><span class="n">barKo</span> <span class="n">and</span> <span class="n">fooKoM142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>So far so good as far as <em>failure</em> is concerned. But what about <em>latency</em>?
All code we have shown so far uses <em>synchronous, blocking</em> computations.</p>

<h2>Latency</h2>

<p>You all know that making use of <em>synchronous, blocking</em> computations
is not the way to deal with latency.
In Java (and many other languages for that matter) <em>asynchronous, non-blocking</em> computations
are used instead to deal with latency.
Asynchronous computations are often modeled using <em>callbacks</em>.</p>

<p>When asking programmers if they <em>like</em> callbacks, many of them say they <em>hate</em> them.</p>

<p>Why?</p>

<p>Well, because, when trying to deal with latency using callbacks,
programmers are basically <em>left on their own</em>.
In a way, when using callbacks, <em>they end up in callback hell</em>.</p>

<p>There must be a better way to deal with latency.</p>

<h2>Computations of type <code>Future</code></h2>

<p>A value of type <code>Try[Z]</code> that is defined as a <code>def</code>
is essentially the same as a value of type <code>Unit =&gt; Try[Z]</code>.
The <em>dual</em> of such a value, obtained by reversing the arrow <code>=&gt;</code>,
is a value of type <code>Try[Z] =&gt; Unit</code>. This dual is formalized by the
following type definition</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">type</span> <span class="kt">Callback</span><span class="o">[</span><span class="kt">-Z</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Try</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="nc">Unit</span>
</span></code></pre></td></tr></table></div></figure>


<p>In a way (as illustrated in the following section) a <code>Future[Z]</code> value is the <em>dual</em> of a <code>Callback[Z]</code> value,
and, as such, the <em>bi-dual</em> of a <code>Try[Z]</code> value.</p>

<p>More precisely, in a way, <code>Future[Z]</code> is the same as <code>Callback[Z] =&gt; Unit</code>,
which is the same as <code>(Try[Z] =&gt; Unit) =&gt; Unit</code>.</p>

<p>This <em>bi-duality</em> turns out to transform synchronous <code>Try</code> computations
into asynchronous <code>Future</code> computations.</p>

<h2>Materializing (failure and) latency using <code>mkFuture</code></h2>

<p>A first step towards dealing with (failure and) latency is to write,
once and for all, code that <em>materializes (failure and) latency at compile time</em></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">def</span> <span class="n">mkFuture</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span>
</span><span class='line'>    <span class="o">(</span><span class="n">cz2u</span><span class="k">:</span> <span class="kt">Callback</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="nc">Unit</span><span class="o">)</span>
</span><span class='line'>    <span class="o">(</span><span class="k">implicit</span> <span class="n">executionContext</span><span class="k">:</span> <span class="kt">ExecutionContext</span><span class="o">)</span>
</span><span class='line'>    <span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">pz</span> <span class="k">=</span> <span class="nc">Promise</span><span class="o">[</span><span class="kt">Z</span><span class="o">]()</span>
</span><span class='line'>    <span class="n">executionContext</span><span class="o">.</span><span class="n">prepare</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="k">new</span> <span class="nc">Runnable</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">def</span> <span class="n">run</span> <span class="o">{</span> <span class="o">{</span> <span class="o">(</span><span class="n">tz</span><span class="k">:</span> <span class="kt">Try</span><span class="o">[</span><span class="kt">Z</span><span class="o">])</span> <span class="k">=&gt;</span> <span class="n">pz</span><span class="o">.</span><span class="n">complete</span><span class="o">(</span><span class="n">tz</span><span class="o">)</span> <span class="o">;</span> <span class="o">()</span> <span class="o">}</span> <span class="n">bind</span> <span class="n">cz2u</span> <span class="o">}</span>
</span><span class='line'>    <span class="o">})</span>
</span><span class='line'>    <span class="n">pz</span><span class="o">.</span><span class="n">future</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The code above uses the <code>Promise[Z]</code> class in its implementation.</p>

<p>You do not need to fully understand the <em>definition</em> of <code>mkFuture</code>.
Think of it as the <em>dual</em> of <em>fulfilling a promise</em> in a separate thead,
and returning that promise as a future.</p>

<p>In a way a <code>Promise[Z]</code> is both a <code>Callback[-Z]</code>,
since it has a method <code>complete</code> that has a parameter of type <code>Try[Z]</code>,
and a <code>Future[+Z]</code>,
since it has a variable <code>future</code> of type <code>Future[Z]</code>.</p>

<p>A promise is something that</p>

<ul>
<li>can be fulfilled (written) only once, in a thread safe way</li>
<li>can be pushed (and read) many times.</li>
</ul>


<p>It is possible, and often useful, to define futures directly in terms of promises.
This blog post does not go into details.</p>

<p>This definition of computations in terms of <code>mkFuture</code> is, in a way,
more complex than needed. For the moment, we are dealing
with reactive computations with <em>one</em> value.
Reactive computations with <em>many</em> values will be defined
in the next blog post a in similar way.
We want to emphasize this analogy.</p>

<p>When considering <code>mkFuture</code> as the <em>only</em> way to
make a future, in a way, <code>Future[Z]</code> becomes the same as <code>Callback[Z] =&gt; Unit</code>.</p>

<p>A callback can be <em>registered</em> to a future as shown below</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">implicit</span> <span class="k">class</span> <span class="nc">FutureOps</span><span class="o">[</span><span class="kt">Z</span><span class="o">](</span><span class="n">fz</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Z</span><span class="o">])</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">register</span><span class="o">(</span><span class="n">callback</span><span class="k">:</span> <span class="kt">Callback</span><span class="o">[</span><span class="kt">Z</span><span class="o">])</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">fz</span><span class="o">.</span><span class="n">onComplete</span> <span class="o">{</span> <span class="n">tz</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">callback</span><span class="o">(</span><span class="n">tz</span><span class="o">)</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="c1">// ...</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>The <code>Future</code> class of the standard Scala library already has an <code>onComplete</code> method
that is equivalent to <code>register</code>. The definition of <code>register</code> is given for didactical reasons only.</p>

<p>It is important that you understand the <em>usage</em> of <code>mkFuture</code></p>

<ul>
<li>you can make a future by defining what it <em>pushes</em> to registered callbacks</li>
</ul>


<p>Not surprising, a computation of type <code>Try</code> can be transformed to a computation
of type <code>Future</code> using this idea</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">def</span> <span class="n">try2future</span><span class="o">[</span><span class="kt">Z</span><span class="o">](</span><span class="n">tz</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="nc">Try</span><span class="o">[</span><span class="kt">Z</span><span class="o">])</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>    <span class="n">mkFuture</span> <span class="o">{</span> <span class="n">cz</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="n">cz</span><span class="o">(</span><span class="n">tz</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <code>try2future</code> code makes use of a <em>call by name</em> parameter <code>tz</code>.</p>

<p>The example below illustrates how to use <code>try2future</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">def</span> <span class="n">mkFutureTry</span><span class="o">[</span><span class="kt">Z</span><span class="o">](</span><span class="n">block</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="n">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Z</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>    <span class="n">try2future</span><span class="o">(</span><span class="n">mkTry</span> <span class="o">{</span> <span class="n">block</span> <span class="o">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <code>mkTry</code> function for computations of type <code>Try</code> could naturally be reused.</p>

<p>The <code>mkFutureTry</code> code makes use of a <em>call by name</em> parameter <code>block</code>
which you can think of as code that
on the one hand, <em>can succeed</em> or <em>can fail</em> and,
on the other hand, <em>can take some time to be evaluated</em>.</p>

<p>How are computations of type <code>Future</code> described?</p>

<h2>Describing Computations of type <code>Future</code></h2>

<p>Here are two computations of type <code>Future</code> that are described using <code>mkFutureTry</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="k">lazy</span> <span class="k">val</span> <span class="n">okFutureTryFoo</span> <span class="k">=</span> <span class="n">mkFutureTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="-Symbol">&#39;F</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="n">okFutureTryFoo</span><span class="k">:</span> <span class="kt">scala.concurrent.Future</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">&lt;</span><span class="k">lazy</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="k">lazy</span> <span class="k">val</span> <span class="n">koFutureTryFoo</span> <span class="k">=</span> <span class="n">mkFutureTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="-Symbol">&#39;B</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="n">koFutureTryFoo</span><span class="k">:</span> <span class="kt">scala.concurrent.Future</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">&lt;</span><span class="k">lazy</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>How are computations of type <code>Future</code> <em>executed</em> once they are described?</p>

<h2>Executing Computations of type <code>Future</code></h2>

<p>For the purpose of this series of blog posts,
executing a computation of type <code>Future</code> can be as simple as registering a callback
that either prints the value of a successful result pushed to it or prints the message of an unsuccessful result
pushed to it</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'> <span class="k">def</span> <span class="n">register</span><span class="o">[</span><span class="kt">Z</span><span class="o">](</span><span class="n">fz</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Z</span><span class="o">])</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span>
</span><span class='line'>   <span class="n">fz</span><span class="o">.</span><span class="n">register</span> <span class="o">{</span> <span class="n">tz</span> <span class="k">=&gt;</span>
</span><span class='line'>     <span class="n">execute</span><span class="o">(</span><span class="n">tz</span><span class="o">)</span>
</span><span class='line'>   <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>We have called the method <code>register</code> instead of <code>execute</code>
because it corresponds to a <code>register</code> method of <code>Future</code></p>

<p>The <code>execute</code> function for computations of type <code>Try</code> could naturally be reused.</p>

<p>Below, the two computations of type <code>Future</code> are executed using <code>register</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="o">{</span> <span class="n">register</span><span class="o">(</span><span class="n">okFutureTryFoo</span><span class="o">)</span> <span class="o">;</span> <span class="n">work</span><span class="o">(</span><span class="-Symbol">&#39;M</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">120</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="n">F121</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">F121</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">F121</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">F121</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">F121</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">F121</span><span class="o">.</span><span class="n">F121</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">F121</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">F121</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span>
</span><span class='line'><span class="n">F121</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">fooOkM142</span><span class="o">.</span>
</span><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="o">{</span> <span class="n">register</span><span class="o">(</span><span class="n">okFutureTryFoo</span><span class="o">)</span> <span class="o">;</span> <span class="n">work</span><span class="o">(</span><span class="-Symbol">&#39;M</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">120</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="n">M142</span><span class="o">.</span><span class="n">fooOkM142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span>
</span><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="o">{</span> <span class="n">register</span><span class="o">(</span><span class="n">koFutureTryFoo</span><span class="o">)</span> <span class="o">;</span> <span class="n">work</span><span class="o">(</span><span class="-Symbol">&#39;M</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">120</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="n">M142</span><span class="o">.</span><span class="n">B121</span><span class="o">.</span><span class="n">B121</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">B121</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">B121</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">B121</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">B121</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">B121</span><span class="o">.</span><span class="n">B121</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">B121</span><span class="o">.</span><span class="n">M142</span>
</span><span class='line'><span class="o">.</span><span class="n">B121</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">fooKoM142</span><span class="o">.</span>
</span><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="o">{</span> <span class="n">register</span><span class="o">(</span><span class="n">koFutureTryFoo</span><span class="o">)</span> <span class="o">;</span> <span class="n">work</span><span class="o">(</span><span class="-Symbol">&#39;M</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">120</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="n">M142</span><span class="o">.</span><span class="n">fooKoM142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span>
</span><span class='line'><span class="n">scala</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>So, what does materialized (failure and) latency bring you?</p>

<h2><code>bnd</code> is your guide</h2>

<p>Just as it is possible for computations of type <code>Try</code> it is possible for computations of type <code>Future</code> to define a method <code>bnd</code> that can be used to <em>compose computations</em></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="c1">// ...</span>
</span><span class='line'><span class="k">def</span> <span class="n">bnd</span><span class="o">[</span><span class="kt">Y</span><span class="o">](</span><span class="n">z2fy</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=&gt;</span> <span class="nc">Future</span><span class="o">[</span><span class="kt">Y</span><span class="o">])</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Y</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">val</span> <span class="n">py</span> <span class="k">=</span> <span class="nc">Promise</span><span class="o">[</span><span class="kt">Y</span><span class="o">]()</span>
</span><span class='line'>  <span class="n">fz</span><span class="o">.</span><span class="n">register</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">case</span> <span class="nc">Success</span><span class="o">(</span><span class="n">z</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="o">(</span><span class="n">z</span> <span class="n">bind</span> <span class="n">z2fy</span><span class="o">).</span><span class="n">register</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">case</span> <span class="nc">Success</span><span class="o">(</span><span class="n">y</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">py</span><span class="o">.</span><span class="n">success</span><span class="o">(</span><span class="n">y</span><span class="o">)</span>
</span><span class='line'>        <span class="k">case</span> <span class="nc">Failure</span><span class="o">(</span><span class="n">t</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">py</span><span class="o">.</span><span class="n">failure</span><span class="o">(</span><span class="n">t</span><span class="o">)</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="k">case</span> <span class="nc">Failure</span><span class="o">(</span><span class="n">t</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="n">py</span><span class="o">.</span><span class="n">failure</span><span class="o">(</span><span class="n">t</span><span class="o">)</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  <span class="n">py</span><span class="o">.</span><span class="n">future</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>An important requirement for <code>z2fy</code> is that it must not throw exceptions. Using <code>mkFutureTry</code>, it is easy to fulfill this requirement.</p>

<p>With <code>bnd</code> in your toolbox, you are not on your own any more to deal with materialized (failure and) latency. Indeed, the method <code>bnd</code> is your trustworthy guide that</p>

<ul>
<li><em>leads you through the successful execution path</em></li>
<li><em>does the (failure and) latency related boilerplate work for you</em></li>
</ul>


<h2>DSL for declaring computations of type <code>Future</code> (Part 1)</h2>

<p>By now we have defined <code>mkFutureTry</code> and <code>bnd</code></p>

<ul>
<li>They constitute <em>a declarative DSL for describing computations</em> of type <code>Future</code></li>
</ul>


<p>We have also defined <code>register</code></p>

<ul>
<li>It constitutes <em>an imperative DSL for executing computations</em> of type <code>Future</code></li>
</ul>


<p>This section contains some examples on how to make use of those DSL&rsquo;s.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="k">:</span><span class="kt">paste</span>
</span><span class='line'><span class="c1">// Entering paste mode (ctrl-D to finish)</span>
</span><span class='line'>
</span><span class='line'><span class="k">lazy</span> <span class="k">val</span> <span class="n">tryFutureFooBar01</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>  <span class="n">mkFutureTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="-Symbol">&#39;F</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span> <span class="n">bnd</span> <span class="o">{</span> <span class="n">s</span> <span class="k">=&gt;</span>
</span><span class='line'>    <span class="n">mkFutureTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="-Symbol">&#39;B</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span> <span class="n">bnd</span> <span class="o">{</span> <span class="n">t</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="n">mkFutureTry</span><span class="o">(</span><span class="n">add</span><span class="o">(</span><span class="n">s</span><span class="o">)(</span><span class="n">t</span><span class="o">))</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">lazy</span> <span class="k">val</span> <span class="n">tryFutureFooBar02</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>  <span class="n">mkFutureTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="-Symbol">&#39;F</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span> <span class="n">bnd</span> <span class="o">{</span> <span class="n">s</span> <span class="k">=&gt;</span>
</span><span class='line'>    <span class="n">mkFutureTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="-Symbol">&#39;B</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span> <span class="n">bnd</span> <span class="o">{</span> <span class="n">t</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="n">mkFutureTry</span><span class="o">(</span><span class="n">add</span><span class="o">(</span><span class="n">s</span><span class="o">)(</span><span class="n">t</span><span class="o">))</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">lazy</span> <span class="k">val</span> <span class="n">tryFutureFooBar03</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>  <span class="n">mkFutureTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="-Symbol">&#39;F</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span> <span class="n">bnd</span> <span class="o">{</span> <span class="n">s</span> <span class="k">=&gt;</span>
</span><span class='line'>    <span class="n">mkFutureTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="-Symbol">&#39;B</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span> <span class="n">bnd</span> <span class="o">{</span> <span class="n">t</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="n">mkFutureTry</span><span class="o">(</span><span class="n">add</span><span class="o">(</span><span class="n">s</span><span class="o">)(</span><span class="n">t</span><span class="o">))</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">lazy</span> <span class="k">val</span> <span class="n">tryFutureFooBar04</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>  <span class="n">mkFutureTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="-Symbol">&#39;F</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span> <span class="n">bnd</span> <span class="o">{</span> <span class="n">s</span> <span class="k">=&gt;</span>
</span><span class='line'>    <span class="n">mkFutureTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="-Symbol">&#39;B</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span> <span class="n">bnd</span> <span class="o">{</span> <span class="n">t</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="n">mkFutureTry</span><span class="o">(</span><span class="n">add</span><span class="o">(</span><span class="n">s</span><span class="o">)(</span><span class="n">t</span><span class="o">))</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Exiting paste mode, now interpreting.</span>
</span><span class='line'>
</span><span class='line'><span class="n">tryFutureFooBar01</span><span class="k">:</span> <span class="kt">scala.concurrent.Future</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">&lt;</span><span class="k">lazy</span><span class="o">&gt;</span>
</span><span class='line'><span class="n">tryFutureFooBar02</span><span class="k">:</span> <span class="kt">scala.concurrent.Future</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">&lt;</span><span class="k">lazy</span><span class="o">&gt;</span>
</span><span class='line'><span class="n">tryFutureFooBar03</span><span class="k">:</span> <span class="kt">scala.concurrent.Future</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">&lt;</span><span class="k">lazy</span><span class="o">&gt;</span>
</span><span class='line'><span class="n">tryFutureFooBar04</span><span class="k">:</span> <span class="kt">scala.concurrent.Future</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">&lt;</span><span class="k">lazy</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can now, so to speak, try to print <code>fooOkbarOk</code> in an asynchronous way</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="o">{</span> <span class="n">register</span><span class="o">(</span><span class="n">tryFutureFooBar01</span><span class="o">)</span> <span class="o">;</span> <span class="n">work</span><span class="o">(</span><span class="-Symbol">&#39;M</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">300</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="n">F149</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">F149</span><span class="o">.</span><span class="n">F149</span><span class="o">.</span><span class="n">F149</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">F149</span><span class="o">.</span><span class="n">F149</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">F149</span><span class="o">.</span><span class="n">F149</span><span class="o">.</span><span class="n">F149</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">F149</span><span class="o">.</span><span class="n">B151</span><span class="o">.</span><span class="n">B151</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span>
</span><span class='line'><span class="n">B151</span><span class="o">.</span><span class="n">B151</span><span class="o">.</span><span class="n">B151</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">B151</span><span class="o">.</span><span class="n">B151</span><span class="o">.</span><span class="n">B151</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">B151</span><span class="o">.</span><span class="n">B151</span><span class="o">.</span><span class="n">fooOkbarOkM142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span>
</span><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="o">{</span> <span class="n">register</span><span class="o">(</span><span class="n">tryFutureFooBar02</span><span class="o">)</span> <span class="o">;</span> <span class="n">work</span><span class="o">(</span><span class="-Symbol">&#39;M</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">300</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="n">F152</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">F152</span><span class="o">.</span><span class="n">F152</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">F152</span><span class="o">.</span><span class="n">F152</span><span class="o">.</span><span class="n">F152</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">F152</span><span class="o">.</span><span class="n">F152</span><span class="o">.</span><span class="n">F152</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">F152</span><span class="o">.</span><span class="n">B151</span><span class="o">.</span><span class="n">B151</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span>
</span><span class='line'><span class="n">B151</span><span class="o">.</span><span class="n">B151</span><span class="o">.</span><span class="n">B151</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">B151</span><span class="o">.</span><span class="n">B151</span><span class="o">.</span><span class="n">B151</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">B151</span><span class="o">.</span><span class="n">B151</span><span class="o">.</span><span class="n">barKoM142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span>
</span><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="o">{</span> <span class="n">register</span><span class="o">(</span><span class="n">tryFutureFooBar03</span><span class="o">)</span> <span class="o">;</span> <span class="n">work</span><span class="o">(</span><span class="-Symbol">&#39;M</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">300</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="n">F151</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">F151</span><span class="o">.</span><span class="n">F151</span><span class="o">.</span><span class="n">F151</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">F151</span><span class="o">.</span><span class="n">F151</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">F151</span><span class="o">.</span><span class="n">F151</span><span class="o">.</span><span class="n">F151</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">F151</span><span class="o">.</span><span class="n">fooKoM142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span>
</span><span class='line'><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span>
</span><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="o">{</span> <span class="n">register</span><span class="o">(</span><span class="n">tryFutureFooBar04</span><span class="o">)</span> <span class="o">;</span> <span class="n">work</span><span class="o">(</span><span class="-Symbol">&#39;M</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">300</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="n">F151</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">F151</span><span class="o">.</span><span class="n">F151</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">F151</span><span class="o">.</span><span class="n">F151</span><span class="o">.</span><span class="n">F151</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">F151</span><span class="o">.</span><span class="n">F151</span><span class="o">.</span><span class="n">F151</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">F151</span><span class="o">.</span><span class="n">fooKoM142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span>
</span><span class='line'><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span><span class="n">M142</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>So now that latency is also dealt with for you, you are perfectly happy, right?
Well, maybe not.
<code>bnd</code> deals with latency in a somewhat specific (not to say sub-optimal) way using <em>sequential</em> composition. Maybe what you want is a <em>parallel</em> composition.</p>

<h2><code>and</code> may be a better guide</h2>

<p>Just as it is possible for computations of type <code>Try</code> it is possible for computations of type <code>Future</code>
to define a method <code>and</code> that can be used to <em>compose computations</em></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">def</span> <span class="n">and</span><span class="o">[</span><span class="kt">Y</span><span class="o">](</span><span class="n">f_z2y</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Z</span> <span class="k">=&gt;</span> <span class="kt">Y</span><span class="o">])</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Y</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">val</span> <span class="n">py</span> <span class="k">=</span> <span class="nc">Promise</span><span class="o">[</span><span class="kt">Y</span><span class="o">]()</span>
</span><span class='line'>  <span class="n">fz</span><span class="o">.</span><span class="n">register</span> <span class="o">{</span> <span class="n">tz</span> <span class="k">=&gt;</span>
</span><span class='line'>    <span class="n">f_z2y</span><span class="o">.</span><span class="n">register</span> <span class="o">{</span> <span class="n">t_z2y</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="n">py</span><span class="o">.</span><span class="n">complete</span><span class="o">(</span><span class="n">tz</span> <span class="n">and</span> <span class="n">t_z2y</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  <span class="n">py</span><span class="o">.</span><span class="n">future</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <code>and</code> method for computations of type <code>Try</code> could naturally be reused.</p>

<p>Instead of relying on the default implementation of <code>and</code>
(that would use sequential composition), you can take advantage of
the possibility to define <code>and</code> in another way to let it use parallel composition
All this is possible since <code>and</code>
is more abstract as <code>bnd</code> and, as such, allows for more implementation flexibility.</p>

<p>The point we want to make is that, when going for <code>and</code> as a guide,
you have more latency handling implementation flexibility for letting
<code>and</code> guide you along your way to a possible result.</p>

<h2>DSL for declaring computations of type <code>Try</code> (Part 2)</h2>

<p>By now we have defined <code>mkFutureTry</code>, <code>bnd</code> and <code>and</code></p>

<ul>
<li>They constitute <em>a declarative DSL for describing computations</em> of type <code>Try</code></li>
</ul>


<p>We have also defined <code>register</code></p>

<ul>
<li>It constitutes <em>an imperative DSL for executing computations</em> of type <code>Try</code></li>
</ul>


<p>This section contains some examples on how to make use of those DSL&rsquo;s.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="c1">// Entering paste mode (ctrl-D to finish)</span>
</span><span class='line'>
</span><span class='line'><span class="k">lazy</span> <span class="k">val</span> <span class="n">tryFutureFooBar05</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>  <span class="n">mkFutureTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="-Symbol">&#39;B</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">50</span><span class="o">)</span> <span class="o">}</span> <span class="n">and</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">mkFutureTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="-Symbol">&#39;F</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span> <span class="n">and</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">mkFutureTry</span><span class="o">(</span><span class="n">add</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">lazy</span> <span class="k">val</span> <span class="n">tryFutureFooBar06</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>  <span class="n">mkFutureTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="-Symbol">&#39;B</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">50</span><span class="o">)</span> <span class="o">}</span> <span class="n">and</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">mkFutureTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="-Symbol">&#39;F</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span> <span class="n">and</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">mkFutureTry</span><span class="o">(</span><span class="n">add</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">lazy</span> <span class="k">val</span> <span class="n">tryFutureFooBar07</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>  <span class="n">mkFutureTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="-Symbol">&#39;B</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">50</span><span class="o">)</span> <span class="o">}</span> <span class="n">and</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">mkFutureTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="-Symbol">&#39;F</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span> <span class="n">and</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">mkFutureTry</span><span class="o">(</span><span class="n">add</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">lazy</span> <span class="k">val</span> <span class="n">tryFutureFooBar08</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>  <span class="n">mkFutureTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="-Symbol">&#39;B</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">50</span><span class="o">)</span> <span class="o">}</span> <span class="n">and</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">mkFutureTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="-Symbol">&#39;F</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span> <span class="n">and</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">mkFutureTry</span><span class="o">(</span><span class="n">add</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Exiting paste mode, now interpreting.</span>
</span><span class='line'>
</span><span class='line'><span class="n">tryFutureFooBar05</span><span class="k">:</span> <span class="kt">scala.concurrent.Future</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">&lt;</span><span class="k">lazy</span><span class="o">&gt;</span>
</span><span class='line'><span class="n">tryFutureFooBar06</span><span class="k">:</span> <span class="kt">scala.concurrent.Future</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">&lt;</span><span class="k">lazy</span><span class="o">&gt;</span>
</span><span class='line'><span class="n">tryFutureFooBar07</span><span class="k">:</span> <span class="kt">scala.concurrent.Future</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">&lt;</span><span class="k">lazy</span><span class="o">&gt;</span>
</span><span class='line'><span class="n">tryFutureFooBar08</span><span class="k">:</span> <span class="kt">scala.concurrent.Future</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">&lt;</span><span class="k">lazy</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can now, so to speak, try to print <code>fooOkbarOk</code> in an asynchronous way</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="o">{</span> <span class="n">register</span><span class="o">(</span><span class="n">tryFutureFooBar05</span><span class="o">)</span> <span class="o">;</span> <span class="n">work</span><span class="o">(</span><span class="-Symbol">&#39;W</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">150</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="n">B149</span><span class="o">.</span><span class="n">F154</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">B149</span><span class="o">.</span><span class="n">B149</span><span class="o">.</span><span class="n">F154</span><span class="o">.</span><span class="n">B149</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">F154</span><span class="o">.</span><span class="n">B149</span><span class="o">.</span><span class="n">B149</span><span class="o">.</span><span class="n">F154</span><span class="o">.</span><span class="n">B149</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">B149</span><span class="o">.</span><span class="n">F154</span><span class="o">.</span><span class="n">B149</span><span class="o">.</span>
</span><span class='line'><span class="n">W142</span><span class="o">.</span><span class="n">B149</span><span class="o">.</span><span class="n">F154</span><span class="o">.</span><span class="n">F154</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">F154</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">F154</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">F154</span><span class="o">.</span><span class="n">fooOkbarOkW142</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span>
</span><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="o">{</span> <span class="n">register</span><span class="o">(</span><span class="n">tryFutureFooBar06</span><span class="o">)</span> <span class="o">;</span> <span class="n">work</span><span class="o">(</span><span class="-Symbol">&#39;W</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">150</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="n">B154</span><span class="o">.</span><span class="n">F155</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">B154</span><span class="o">.</span><span class="n">B154</span><span class="o">.</span><span class="n">F155</span><span class="o">.</span><span class="n">B154</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">F155</span><span class="o">.</span><span class="n">B154</span><span class="o">.</span><span class="n">B154</span><span class="o">.</span><span class="n">F155</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">B154</span><span class="o">.</span><span class="n">B154</span><span class="o">.</span><span class="n">F155</span><span class="o">.</span><span class="n">B154</span><span class="o">.</span>
</span><span class='line'><span class="n">W142</span><span class="o">.</span><span class="n">B154</span><span class="o">.</span><span class="n">F155</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">F155</span><span class="o">.</span><span class="n">F155</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">F155</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">F155</span><span class="o">.</span><span class="n">fooKoW142</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span>
</span><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="o">{</span> <span class="n">register</span><span class="o">(</span><span class="n">tryFutureFooBar07</span><span class="o">)</span> <span class="o">;</span> <span class="n">work</span><span class="o">(</span><span class="-Symbol">&#39;W</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">150</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="n">B154</span><span class="o">.</span><span class="n">F149</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">B154</span><span class="o">.</span><span class="n">B154</span><span class="o">.</span><span class="n">F149</span><span class="o">.</span><span class="n">B154</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">F149</span><span class="o">.</span><span class="n">B154</span><span class="o">.</span><span class="n">B154</span><span class="o">.</span><span class="n">F149</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">B154</span><span class="o">.</span><span class="n">B154</span><span class="o">.</span><span class="n">F149</span><span class="o">.</span><span class="n">B154</span>
</span><span class='line'><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">B154</span><span class="o">.</span><span class="n">F149</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">F149</span><span class="o">.</span><span class="n">F149</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">F149</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">F149</span><span class="o">.</span><span class="n">barKoW142</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span>
</span><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="o">{</span> <span class="n">register</span><span class="o">(</span><span class="n">tryFutureFooBar08</span><span class="o">)</span> <span class="o">;</span> <span class="n">work</span><span class="o">(</span><span class="-Symbol">&#39;W</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">150</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="n">B149</span><span class="o">.</span><span class="n">F155</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">B149</span><span class="o">.</span><span class="n">B149</span><span class="o">.</span><span class="n">F155</span><span class="o">.</span><span class="n">B149</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">F155</span><span class="o">.</span><span class="n">B149</span><span class="o">.</span><span class="n">B149</span><span class="o">.</span><span class="n">F155</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">B149</span><span class="o">.</span><span class="n">B149</span><span class="o">.</span><span class="n">F155</span><span class="o">.</span><span class="n">B149</span><span class="o">.</span>
</span><span class='line'><span class="n">W142</span><span class="o">.</span><span class="n">B149</span><span class="o">.</span><span class="n">F155</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">F155</span><span class="o">.</span><span class="n">F155</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">F155</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">F155</span><span class="o">.</span><span class="n">barKo</span> <span class="n">and</span> <span class="n">fooKoW142</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>In the examples above,
the <code>block</code> using <code>"bar"</code> is executed faster than
the <code>block</code> using <code>"foo"</code>.
So what about the opposite?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="c1">// Entering paste mode (ctrl-D to finish)</span>
</span><span class='line'>
</span><span class='line'><span class="k">lazy</span> <span class="k">val</span> <span class="n">tryFutureFooBar09</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>  <span class="n">mkFutureTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="-Symbol">&#39;B</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span> <span class="n">and</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">mkFutureTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="-Symbol">&#39;F</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">50</span><span class="o">)</span> <span class="o">}</span> <span class="n">and</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">mkFutureTry</span><span class="o">(</span><span class="n">add</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">lazy</span> <span class="k">val</span> <span class="n">tryFutureFooBar10</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>  <span class="n">mkFutureTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="-Symbol">&#39;B</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span> <span class="n">and</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">mkFutureTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="-Symbol">&#39;F</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">50</span><span class="o">)</span> <span class="o">}</span> <span class="n">and</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">mkFutureTry</span><span class="o">(</span><span class="n">add</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">lazy</span> <span class="k">val</span> <span class="n">tryFutureFooBar11</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>  <span class="n">mkFutureTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="-Symbol">&#39;B</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span> <span class="n">and</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">mkFutureTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="-Symbol">&#39;F</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">50</span><span class="o">)</span> <span class="o">}</span> <span class="n">and</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">mkFutureTry</span><span class="o">(</span><span class="n">add</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">lazy</span> <span class="k">val</span> <span class="n">tryFutureFooBar12</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>  <span class="n">mkFutureTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="-Symbol">&#39;B</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">}</span> <span class="n">and</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">mkFutureTry</span> <span class="o">{</span> <span class="n">block</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="-Symbol">&#39;F</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">50</span><span class="o">)</span> <span class="o">}</span> <span class="n">and</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">mkFutureTry</span><span class="o">(</span><span class="n">add</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Exiting paste mode, now interpreting.</span>
</span><span class='line'>
</span><span class='line'><span class="n">tryFutureFooBar09</span><span class="k">:</span> <span class="kt">scala.concurrent.Future</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">&lt;</span><span class="k">lazy</span><span class="o">&gt;</span>
</span><span class='line'><span class="n">tryFutureFooBar10</span><span class="k">:</span> <span class="kt">scala.concurrent.Future</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">&lt;</span><span class="k">lazy</span><span class="o">&gt;</span>
</span><span class='line'><span class="n">tryFutureFooBar11</span><span class="k">:</span> <span class="kt">scala.concurrent.Future</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">&lt;</span><span class="k">lazy</span><span class="o">&gt;</span>
</span><span class='line'><span class="n">tryFutureFooBar12</span><span class="k">:</span> <span class="kt">scala.concurrent.Future</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">&lt;</span><span class="k">lazy</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can now, again, so to speak, try to print <code>fooOkbarOk</code> in an asynchronous way</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="o">{</span> <span class="n">register</span><span class="o">(</span><span class="n">tryFutureFooBar09</span><span class="o">)</span> <span class="o">;</span> <span class="n">work</span><span class="o">(</span><span class="-Symbol">&#39;W</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">150</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="n">B155</span><span class="o">.</span><span class="n">F157</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">F157</span><span class="o">.</span><span class="n">B155</span><span class="o">.</span><span class="n">F157</span><span class="o">.</span><span class="n">F157</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">B155</span><span class="o">.</span><span class="n">F157</span><span class="o">.</span><span class="n">F157</span><span class="o">.</span><span class="n">B155</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">F157</span><span class="o">.</span><span class="n">F157</span><span class="o">.</span><span class="n">B155</span><span class="o">.</span><span class="n">F157</span><span class="o">.</span>
</span><span class='line'><span class="n">W142</span><span class="o">.</span><span class="n">F157</span><span class="o">.</span><span class="n">B155</span><span class="o">.</span><span class="n">B155</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">B155</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">B155</span><span class="o">.</span><span class="n">B155</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">fooOkbarOkW142</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span>
</span><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="o">{</span> <span class="n">register</span><span class="o">(</span><span class="n">tryFutureFooBar10</span><span class="o">)</span> <span class="o">;</span> <span class="n">work</span><span class="o">(</span><span class="-Symbol">&#39;W</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">150</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="n">B155</span><span class="o">.</span><span class="n">F159</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">F159</span><span class="o">.</span><span class="n">B155</span><span class="o">.</span><span class="n">F159</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">F159</span><span class="o">.</span><span class="n">B155</span><span class="o">.</span><span class="n">F159</span><span class="o">.</span><span class="n">F159</span><span class="o">.</span><span class="n">B155</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">F159</span><span class="o">.</span><span class="n">F159</span><span class="o">.</span><span class="n">B155</span><span class="o">.</span><span class="n">F159</span><span class="o">.</span>
</span><span class='line'><span class="n">W142</span><span class="o">.</span><span class="n">F159</span><span class="o">.</span><span class="n">B155</span><span class="o">.</span><span class="n">B155</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">B155</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">B155</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">B155</span><span class="o">.</span><span class="n">fooKoW142</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span>
</span><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="o">{</span> <span class="n">register</span><span class="o">(</span><span class="n">tryFutureFooBar11</span><span class="o">)</span> <span class="o">;</span> <span class="n">work</span><span class="o">(</span><span class="-Symbol">&#39;W</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">150</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="n">B155</span><span class="o">.</span><span class="n">F158</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">F158</span><span class="o">.</span><span class="n">B155</span><span class="o">.</span><span class="n">F158</span><span class="o">.</span><span class="n">F158</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">B155</span><span class="o">.</span><span class="n">F158</span><span class="o">.</span><span class="n">F158</span><span class="o">.</span><span class="n">B155</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">F158</span><span class="o">.</span><span class="n">F158</span><span class="o">.</span><span class="n">B155</span><span class="o">.</span><span class="n">F158</span><span class="o">.</span>
</span><span class='line'><span class="n">W142</span><span class="o">.</span><span class="n">F158</span><span class="o">.</span><span class="n">B155</span><span class="o">.</span><span class="n">B155</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">B155</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">B155</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">B155</span><span class="o">.</span><span class="n">barKoW142</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span>
</span><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="o">{</span> <span class="n">register</span><span class="o">(</span><span class="n">tryFutureFooBar12</span><span class="o">)</span> <span class="o">;</span> <span class="n">work</span><span class="o">(</span><span class="-Symbol">&#39;W</span><span class="err">&#39;</span><span class="o">,</span> <span class="mi">150</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="n">B155</span><span class="o">.</span><span class="n">F158</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">F158</span><span class="o">.</span><span class="n">B155</span><span class="o">.</span><span class="n">F158</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">F158</span><span class="o">.</span><span class="n">B155</span><span class="o">.</span><span class="n">F158</span><span class="o">.</span><span class="n">F158</span><span class="o">.</span><span class="n">B155</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">F158</span><span class="o">.</span><span class="n">F158</span><span class="o">.</span><span class="n">B155</span><span class="o">.</span><span class="n">F158</span><span class="o">.</span>
</span><span class='line'><span class="n">W142</span><span class="o">.</span><span class="n">F158</span><span class="o">.</span><span class="n">B155</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">B155</span><span class="o">.</span><span class="n">B155</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">B155</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">B155</span><span class="o">.</span><span class="n">barKo</span> <span class="n">and</span> <span class="n">fooKoW142</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span><span class="n">W142</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>In the examples above,
the <code>block</code> using <code>"foo"</code> is executed faster than
the <code>block</code> using <code>"bar"</code>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Functional Programming in Scala]]></title>
    <link href="http://www.strongtyped.io/blog/2014/05/11/functional-programming-in-scala/"/>
    <updated>2014-05-11T06:21:00+02:00</updated>
    <id>http://www.strongtyped.io/blog/2014/05/11/functional-programming-in-scala</id>
    <content type="html"><![CDATA[<p>This blog post is the first one of a series of blog posts about <em>Functional Programming in Scala</em>.
It is also a teaser for series of blog posts of about <em>Reactive Programming in Scala</em>.</p>

<p><strong>Warning:</strong>
Functional Programming and Reactive Programming are profound topics.
Hopefully, you will be rewarded for your effort to read the blog posts.</p>

<!-- more -->


<h2>Binding</h2>

<p>You are, most probably, used to think of</p>

<ul>
<li><em>functions</em> in terms of <em>applying</em> them to <em>values</em></li>
</ul>


<p>but, of course, you can also think of</p>

<ul>
<li><em>values</em> in terms of <em>binding</em> them to <em>functions</em></li>
</ul>


<p>The method <code>bind</code> below, defined in terms of <code>apply</code>, formalizes binding</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">implicit</span> <span class="k">class</span> <span class="nc">AnyOps</span><span class="o">[</span><span class="kt">Z</span><span class="o">](</span><span class="n">z</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">bind</span><span class="o">[</span><span class="kt">Y</span><span class="o">](</span><span class="n">z2y</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=&gt;</span> <span class="n">Y</span><span class="o">)</span><span class="k">:</span> <span class="kt">Y</span> <span class="o">=</span>
</span><span class='line'>      <span class="n">z2y</span> <span class="n">apply</span> <span class="n">z</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Strictly speaking it is not necessary at all to introduce binding in Scala,
but, sometimes, <code>bind</code> is more convenient to use than <code>apply</code>, as illustrated below</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="mi">1</span> <span class="n">bind</span> <span class="o">{</span> <span class="n">z</span> <span class="k">=&gt;</span> <span class="n">z</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">}</span> <span class="n">bind</span> <span class="o">{</span> <span class="n">z</span> <span class="k">=&gt;</span> <span class="n">z</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">}</span>
</span><span class='line'><span class="n">res0</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">3</span>
</span><span class='line'>
</span><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="o">{</span> <span class="o">(</span><span class="n">z</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">z</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">}</span> <span class="n">apply</span> <span class="o">({</span> <span class="o">(</span><span class="n">z</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">z</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">}</span> <span class="n">apply</span> <span class="mi">1</span><span class="o">)</span>
</span><span class='line'><span class="n">res1</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">3</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>The method <code>bind</code> naturally associates to the <em>left</em>, while
the method <code>apply</code> associates to the <em>right</em>,
requiring the usage of <em>parantheses</em>.</p></li>
<li><p>The Scala type inferencer naturally infers the type of expressions using <code>bind</code>, while
it does not infer the type of expressions using <code>apply</code>,
requiring the usage of <em>type annotations</em>.</p></li>
</ul>


<h2>Functional Programming</h2>

<p>Here is some quote about Functional Programming</p>

<p><em>Functional Programming strictly separates</em></p>

<ul>
<li><em>the declarative description of computations</em></li>
<li><em>the imperative execution of computations</em></li>
</ul>


<p>So, what are the computations in this quote all about?</p>

<h2>Computations of type <code>One</code></h2>

<p>Let&rsquo;s get started with <em>pure computations</em> that, when <em>executed</em>, result in <em>exactly one value</em>
as defined by the following <code>case class</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">case</span> <span class="k">class</span> <span class="nc">One</span><span class="o">[</span><span class="kt">+Z</span><span class="o">](</span><span class="n">z</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Computations resulting in exactly one value are also referred to as computations of type <code>One</code>.</p>

<p>When there is no danger of confusion, any kind of computation is simply referred to as a computation.</p>

<h2>Constructing computations using <code>mkOne</code></h2>

<p>Computations of type <code>One</code> can be <em>constructed</em> using <code>mkOne</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">def</span> <span class="n">mkOne</span><span class="o">[</span><span class="kt">Z</span><span class="o">](</span><span class="n">z</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span> <span class="k">=</span> <span class="nc">One</span><span class="o">(</span><span class="n">z</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Agreed, introducing <code>mkOne</code> is somewhat of an overkill,
but it is consistent with the way other kinds of computations are constructed
in this series of posts.</p>

<p>How are computations of type <code>One</code> <em>described</em>?</p>

<h2>Describing Computations of type <code>One</code></h2>

<p>Here is a computation of type <code>One</code> that is described using <code>mkOne</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="k">lazy</span> <span class="k">val</span> <span class="n">oneFoo</span> <span class="k">=</span> <span class="n">mkOne</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">)</span>
</span><span class='line'><span class="n">oneFoo</span><span class="k">:</span> <span class="kt">Fp.One</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">&lt;</span><span class="k">lazy</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>A <code>lazy val</code> is used to separate the description of the computation from its execution.</p>

<p>How are computations of type <code>One</code> <em>executed</em> once they are described?</p>

<h2>Executing Computations of type <code>One</code></h2>

<p>For the purpose of this series of blog posts,
executing a computation of type <code>One</code> can be as simple as <em>printing its value</em>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">def</span> <span class="n">execute</span><span class="o">[</span><span class="kt">Z</span><span class="o">](</span><span class="n">oz</span><span class="k">:</span> <span class="kt">One</span><span class="o">[</span><span class="kt">Z</span><span class="o">])</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span>
</span><span class='line'>    <span class="n">oz</span> <span class="k">match</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="nc">One</span><span class="o">(</span><span class="n">z</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">println</span><span class="o">(</span><span class="n">z</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Below, the computation of type <code>One</code> is executed using <code>execute</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="n">execute</span><span class="o">(</span><span class="n">oneFoo</span><span class="o">)</span>
</span><span class='line'><span class="n">foo</span>
</span></code></pre></td></tr></table></div></figure>


<p>The computation <code>oneFoo</code> is defined as a <code>lazy val</code>.
<code>mkOne("foo")</code> is evaluated <em>the first time</em> that <code>oneFoo</code> is executed.
When <code>oneFoo</code> would have been defined as a <code>def</code>, then
<code>mkOne("foo")</code> would be evaluated <em>every time</em> that <code>oneFoo</code> is executed.
For <code>oneFoo</code> the difference does not matter
(apart from the fact that a <code>lazy val</code> is more time efficient and less space efficient than a <code>def</code>).
Sometimes the difference between a <code>lazy val</code> computation and a <code>def</code> computation <em>does</em> matter.</p>

<p>Declaring simple computations like <code>oneFoo</code> and executing them as <code>execute(oneFoo)</code> is,
of course, not the end of the story about computations of type <code>One</code>.</p>

<p>Is there not a way to <em>compose</em> computations of type <code>One</code>?</p>

<h2>Composing Pure Computations of type <code>One</code></h2>

<p>The implicit class below defines two methods, <code>bnd</code> and <code>and</code>, that can be used to
describe <em>more complex</em> computations by, somehow, <em>composing</em> them from <em>simpler</em> ones.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">implicit</span> <span class="k">class</span> <span class="nc">OneOps</span><span class="o">[</span><span class="kt">Z</span><span class="o">](</span><span class="n">oz</span><span class="k">:</span> <span class="kt">One</span><span class="o">[</span><span class="kt">Z</span><span class="o">])</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">bnd</span><span class="o">[</span><span class="kt">Y</span><span class="o">](</span><span class="n">z2oy</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=&gt;</span> <span class="nc">One</span><span class="o">[</span><span class="kt">Y</span><span class="o">])</span><span class="k">:</span> <span class="kt">One</span><span class="o">[</span><span class="kt">Y</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>      <span class="n">oz</span><span class="o">.</span><span class="n">z</span> <span class="n">bind</span> <span class="n">z2oy</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">and</span><span class="o">[</span><span class="kt">Y</span><span class="o">](</span><span class="n">o_z2y</span><span class="k">:</span> <span class="kt">One</span><span class="o">[</span><span class="kt">Z</span> <span class="k">=&gt;</span> <span class="kt">Y</span><span class="o">])</span><span class="k">:</span> <span class="kt">One</span><span class="o">[</span><span class="kt">Y</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>      <span class="n">mkOne</span><span class="o">(</span><span class="n">oz</span><span class="o">.</span><span class="n">z</span> <span class="n">bind</span> <span class="n">o_z2y</span><span class="o">.</span><span class="n">z</span><span class="o">)</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Although, strictly speaking, not necessary, <code>bnd</code> and <code>and</code> are defined in terms of <code>bind</code>.</p>

<h2>DSL for computations of type <code>One</code></h2>

<p>By now we have defined <code>mkOne</code>, <code>bnd</code> and <code>and</code></p>

<ul>
<li>They constitute a <em>declarative DSL for describing computations</em> of type <code>One</code></li>
</ul>


<p>We have also defined <code>execute</code></p>

<ul>
<li>It constitutes <em>an imperative DSL for executing computations</em> of type <code>One</code></li>
</ul>


<p>This section contains some examples on how to make use of those DSL&rsquo;s.</p>

<p>All examples make use of the following <code>add</code> function on strings</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">def</span> <span class="n">add</span><span class="o">(</span><span class="n">z</span><span class="k">:</span> <span class="kt">String</span><span class="o">)(</span><span class="n">y</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=</span> <span class="n">z</span> <span class="o">+</span> <span class="n">y</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>add</code> is a <em>curried</em> version of the <code>+</code> operator on strings.</p>

<p>Let&rsquo;s start with a computation using <code>bnd</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="k">:</span><span class="kt">paste</span>
</span><span class='line'><span class="c1">// Entering paste mode (ctrl-D to finish)</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">lazy</span> <span class="k">val</span> <span class="n">oneFooBar01</span><span class="k">:</span> <span class="kt">One</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>    <span class="n">mkOne</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">)</span> <span class="n">bnd</span> <span class="o">{</span> <span class="n">z</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="n">mkOne</span><span class="o">(</span><span class="s">&quot;bar&quot;</span><span class="o">)</span> <span class="n">bnd</span> <span class="o">{</span> <span class="n">y</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">mkOne</span><span class="o">(</span><span class="n">add</span><span class="o">(</span><span class="n">z</span><span class="o">)(</span><span class="n">y</span><span class="o">))</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Exiting paste mode, now interpreting.</span>
</span><span class='line'>
</span><span class='line'><span class="n">oneFooBar01</span><span class="k">:</span> <span class="kt">Fp.One</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">&lt;</span><span class="k">lazy</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="n">execute</span><span class="o">(</span><span class="n">oneFooBar01</span><span class="o">)</span>
</span><span class='line'><span class="n">foobar</span>
</span></code></pre></td></tr></table></div></figure>


<p>The declaration of <code>oneFooBar01</code> can, informally, be explained as follows</p>

<ul>
<li>evaluate the expression <code>"foo"</code> and bind the resulting value to the variable <code>z</code>, and then</li>
<li>evaluate the expression <code>"bar"</code> and bind the resulting value to the variable <code>y</code>, and then</li>
<li>result in the value obtained by adding <code>z</code> and <code>y</code></li>
</ul>


<p>Let&rsquo;s continue with a computation using <code>and</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="k">:</span><span class="kt">paste</span>
</span><span class='line'><span class="c1">// Entering paste mode (ctrl-D to finish)</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">lazy</span> <span class="k">val</span> <span class="n">oneFooBar02</span><span class="k">:</span> <span class="kt">One</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>    <span class="n">mkOne</span><span class="o">(</span><span class="s">&quot;bar&quot;</span><span class="o">)</span> <span class="n">and</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">mkOne</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">)</span> <span class="n">and</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">mkOne</span><span class="o">(</span><span class="n">z</span> <span class="k">=&gt;</span> <span class="n">y</span> <span class="k">=&gt;</span> <span class="n">add</span><span class="o">(</span><span class="n">z</span><span class="o">)(</span><span class="n">y</span><span class="o">))</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Exiting paste mode, now interpreting.</span>
</span><span class='line'>
</span><span class='line'><span class="n">oneFooBar02</span><span class="k">:</span> <span class="kt">Fp.One</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">&lt;</span><span class="k">lazy</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="n">execute</span><span class="o">(</span><span class="n">oneFooBar02</span><span class="o">)</span>
</span><span class='line'><span class="n">foobar</span>
</span></code></pre></td></tr></table></div></figure>


<p>The declaration of <code>oneFooBar02</code> can, informally, be explained as follows</p>

<ul>
<li>evaluate the expression <code>"bar"</code>, and evaluate the expression <code>"foo"</code>, and then</li>
<li>bind the resulting values to the variables <code>y</code> and <code>z</code>, and then</li>
<li>result in the value obtained by adding <code>z</code> and <code>y</code></li>
</ul>


<p>Let&rsquo;s finish with a simplified version of the computation using <code>and</code> above
in which there are no variables used any more</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="k">:</span><span class="kt">paste</span>
</span><span class='line'><span class="c1">// Entering paste mode (ctrl-D to finish)</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">lazy</span> <span class="k">val</span> <span class="n">oneFooBar03</span><span class="k">:</span> <span class="kt">One</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>    <span class="n">mkOne</span><span class="o">(</span><span class="s">&quot;bar&quot;</span><span class="o">)</span> <span class="n">and</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">mkOne</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">)</span> <span class="n">and</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">mkOne</span><span class="o">(</span><span class="n">add</span><span class="o">)</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Exiting paste mode, now interpreting.</span>
</span><span class='line'>
</span><span class='line'><span class="n">oneFooBar03</span><span class="k">:</span> <span class="kt">Fp.One</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">&lt;</span><span class="k">lazy</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="n">execute</span><span class="o">(</span><span class="n">oneFooBar03</span><span class="o">)</span>
</span><span class='line'><span class="n">foobar</span>
</span></code></pre></td></tr></table></div></figure>


<p>The declaration of <code>oneFooBar03</code> can, informally, be explained as follows</p>

<ul>
<li>evaluate the expression <code>"bar"</code>, and evaluate the expression <code>"foo"</code>, and then</li>
<li>result in the value obtained by adding their resulting values</li>
</ul>


<p>You may ask yourself: <em>this looks like much ado about nothing</em>.
We might as well have written the following code</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">val</span> <span class="n">z</span> <span class="k">=</span> <span class="s">&quot;foo&quot;</span>
</span><span class='line'>  <span class="k">val</span> <span class="n">z</span> <span class="k">=</span> <span class="s">&quot;bar&quot;</span>
</span><span class='line'>  <span class="n">add</span><span class="o">(</span><span class="n">z</span><span class="o">)(</span><span class="n">y</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Well, in a way you are right: for pure computations resulting in exactly one value,
introducing <code>mkOne</code>, <code>bnd</code> and <code>and</code> <em>is</em> much ado about nothing.
For more interesting kinds of computations, the situation is completely different.</p>

<p>Nevertheless it is already possible to formulate some interesting remarks.</p>

<h2>Some remarks</h2>

<p>First, a somewhat philosophical (and highly subjective) remark about <em>syntax</em>.</p>

<p>In <em>some</em> way, the DSL based code reads more natural <em>from left to right</em>
than the language based code. When initializing <code>z</code> with <code>"foo"</code> using <code>val z = "foo"</code>,
<em>first</em> the expression <code>"foo"</code> on the <em>right</em> hand side of <code>=</code> is evaluated and
<em>second</em> the variable <code>z</code> on the <em>left</em> hand side of <code>=</code> is initialized with the resulting value.
Not very left to right indeed (in fact <em>right to left</em> instead).
Agreed, in <em>another</em> way, the DSL based code reads less natural because of all those curly braces.
Their nesting is usually limited since it is not a good programming practice to define
computations using large pieces of code (good programmers write small pieces code).
The curly braces also have an advantage: they clearly delimit the scope of the variables that are introduced.
<em>Every disadvantage has its advantage</em> (a quote of the Dutch soccer player Johan Cruijff).</p>

<p>Second, a remark about <em>semantics</em>.</p>

<p>The semantics of the language based code is defined by the <em>language specification</em>.
The semantics of the DSL based code is defined by <em>you</em> (in terms of the semantics of <code>bnd</code> and <code>and</code>).
This provides you with more flexibility.
Agreed, again, in the case of pure computations resulting in exactly one value,
there is not really a lot of flexibility for you to define <code>bnd</code> and <code>and</code> in a meaningful way.
For more interesting kinds of computations, the situation is completely different.</p>

<h2>About abstraction</h2>

<p>The method <code>bnd</code> is more <em>specific</em> (<em>concrete</em>) than <code>and</code>
(the method <code>and</code> is more <em>general</em> (<em>abstract</em>) than <code>bnd</code>).</p>

<p>The method <code>and</code> is more abstract than <code>bnd</code> simply because the method <code>and</code> can be defined in terms of <code>bnd</code>
(the definition of <code>and</code> in terms of <code>bnd</code> is referred to as the <em>default</em> definition of <code>and</code>)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">def</span> <span class="n">and</span><span class="o">[</span><span class="kt">Y</span><span class="o">](</span><span class="n">o_z2y</span><span class="k">:</span> <span class="kt">One</span><span class="o">[</span><span class="kt">Z</span> <span class="k">=&gt;</span> <span class="kt">Y</span><span class="o">])</span><span class="k">:</span> <span class="kt">One</span><span class="o">[</span><span class="kt">Y</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>  <span class="n">oz</span> <span class="n">bnd</span> <span class="o">{</span> <span class="n">z</span> <span class="k">=&gt;</span>
</span><span class='line'>    <span class="n">o_z2y</span> <span class="n">bnd</span> <span class="o">{</span> <span class="n">z2y</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="n">mkOne</span><span class="o">(</span><span class="n">z</span> <span class="n">bind</span> <span class="n">z2y</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>For pure computations resulting in exactly one value, the two definitions are equivalent.
For more interesting kinds of computations,
<code>and</code> can be given a definition that is <em>not</em> equivalent with the default definition.</p>

<h2>About power of expression</h2>

<p>The method <code>bnd</code> is <em>more powerful</em> than <code>and</code>
(the method <code>and</code> is <em>less powerful</em> than <code>bnd</code>).</p>

<p>Below is an example that illustrates that the method <code>bnd</code> is more powerful than <code>and</code>:
when using <code>bnd</code> the variable <code>z</code> is <em>immediately in scope</em>, and can be used in the rest of the code,
for example, to decide, based on <code>z</code>, how to proceed</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="k">:</span><span class="kt">paste</span>
</span><span class='line'><span class="c1">// Entering paste mode (ctrl-D to finish)</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">decideBasedOn</span><span class="o">(</span><span class="n">s</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">One</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
</span><span class='line'>    <span class="n">mkOne</span><span class="o">(</span><span class="n">s</span><span class="o">)</span> <span class="n">bnd</span> <span class="o">{</span> <span class="n">s</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="n">s</span> <span class="k">match</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">case</span> <span class="s">&quot;foo&quot;</span> <span class="k">=&gt;</span> <span class="n">mkOne</span><span class="o">(</span><span class="s">&quot;bar&quot;</span><span class="o">)</span> <span class="n">bnd</span> <span class="o">{</span> <span class="n">t</span> <span class="k">=&gt;</span>
</span><span class='line'>          <span class="n">mkOne</span><span class="o">(</span><span class="n">add</span><span class="o">(</span><span class="n">s</span><span class="o">)(</span><span class="n">t</span><span class="o">))</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="k">case</span> <span class="s">&quot;bar&quot;</span> <span class="k">=&gt;</span> <span class="n">mkOne</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">)</span> <span class="n">bnd</span> <span class="o">{</span> <span class="n">t</span> <span class="k">=&gt;</span>
</span><span class='line'>          <span class="n">mkOne</span><span class="o">(</span><span class="n">add</span><span class="o">(</span><span class="n">s</span><span class="o">)(</span><span class="n">t</span><span class="o">))</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="k">case</span> <span class="k">_</span> <span class="k">=&gt;</span> <span class="n">mkOne</span><span class="o">(</span><span class="s">&quot;bogus&quot;</span><span class="o">)</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Exiting paste mode, now interpreting.</span>
</span><span class='line'>
</span><span class='line'><span class="n">decideBasedOn</span><span class="k">:</span> <span class="o">(</span><span class="kt">string:</span> <span class="kt">String</span><span class="o">)</span><span class="kt">Fp.One</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="n">execute</span><span class="o">(</span><span class="n">decideBasedOn</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">))</span>
</span><span class='line'><span class="n">foobar</span>
</span><span class='line'>
</span><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="n">execute</span><span class="o">(</span><span class="n">decideBasedOn</span><span class="o">(</span><span class="s">&quot;bar&quot;</span><span class="o">))</span>
</span><span class='line'><span class="n">barfoo</span>
</span><span class='line'>
</span><span class='line'><span class="n">scala</span><span class="o">&gt;</span> <span class="n">execute</span><span class="o">(</span><span class="n">decideBasedOn</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">))</span>
</span><span class='line'><span class="n">bogus</span>
</span></code></pre></td></tr></table></div></figure>


<p>The bottom line of all this is that, for most computations, the choice is yours</p>

<ul>
<li>you can go for less abstract, more powerful composition (and less implementation flexibility)</li>
<li>you can go for more abstract, less powerful composition (and more implementation flexibility)</li>
</ul>


<p>It is all about choosing the <em>right level of abstraction</em>.
As a programmer, you should <em>value abstraction</em>:
it is a tool to <em>manage complexity</em>.</p>

<p>Consider the difference between using <code>bnd</code> and <code>and</code></p>

<ul>
<li>the description of <code>oneFooBar01</code> requires the usage of variables</li>
<li>the description of <code>oneFooBar03</code> does not require the usage of variables</li>
</ul>


<p>You may ask yourself: <em>are there any other ways to compose computations</em>?</p>

<h2>Other ways to compose computations</h2>

<p>The answer is <em>yes</em>, there is one other popular way to compose computations</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">type</span> <span class="o">==&gt;[</span><span class="kt">-Z</span>, <span class="kt">+Y</span><span class="o">]</span> <span class="k">=</span> <span class="n">Z</span> <span class="k">=&gt;</span> <span class="nc">One</span><span class="o">[</span><span class="kt">Y</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">implicit</span> <span class="k">class</span> <span class="nc">OneArrowOps</span><span class="o">[</span><span class="kt">Z</span>, <span class="kt">Y</span><span class="o">](</span><span class="n">oa_z2y</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span><span class="k">=&gt;</span> <span class="n">Y</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">def</span> <span class="o">&gt;&gt;&gt;[</span><span class="kt">X</span><span class="o">](</span><span class="n">oa_y2x</span><span class="k">:</span> <span class="kt">Y</span> <span class="o">=</span><span class="k">=&gt;</span> <span class="n">X</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span><span class="k">=&gt;</span> <span class="n">X</span> <span class="k">=</span>
</span><span class='line'>      <span class="n">z</span> <span class="k">=&gt;</span> <span class="n">z</span> <span class="n">bind</span> <span class="n">oa_z2y</span> <span class="n">bnd</span> <span class="n">oa_y2x</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>On the one hand, since <code>&gt;&gt;&gt;</code> can be defined in terms of <code>bnd</code> (as shown above)
<code>&gt;&gt;&gt;</code> is more abstract (and less powerful) than <code>bnd</code>.</p>

<p>On the other hand, since, in a way, <code>and</code> can be defined in terms of <code>&gt;&gt;&gt;</code> (not shown in this post)
<code>and</code> is more abstract (and less powerful) than <code>&gt;&gt;&gt;</code>.</p>

<p>The first series blog posts about functional programming
is not dealing with this third kind of computation composition.</p>

<h2>Reactive Programming</h2>

<p>So far we worked with pure computations resulting in exactly one value.
But, of course, there are also more interesting kinds of computations.</p>

<p><em>Reactive Programming</em>, deals with two important <em>computational features</em>: <em>failure</em> and <em>latency</em>.
Both should be dealt with for realizing <em>responsiveness</em>.</p>

<p><code>and</code> can be defined to deal with them in another way as <code>bnd</code>.</p>
]]></content>
  </entry>
  
</feed>
